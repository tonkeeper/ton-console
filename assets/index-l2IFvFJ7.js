import{W,an as X,Z as Y,aZ as L,ao as ee,a_ as te,a$ as se,b0 as ne,b1 as ae,b2 as V,b3 as re,av as H,b4 as oe,b5 as ie,r as j,b6 as Q,j as e,ae as le,ax as q,b7 as D,b8 as ce,b9 as U,ba as ue,bb as de,o as d,az as E,F as f,S as me,bc as xe,bd as he,be as pe,aA as ye,aB as fe,aC as be,aE as je,aD as ge,aF as we,_ as Ae,$ as Se,bf as Ce,bg as Te,B as A,aG as ve,b as k,l as _,bh as Be,m as Re,n as Fe,bi as w,O as ke,k as Ie,D as Ne,bj as Oe,bk as Pe,L as Me}from"./index-BCN26Ft_.js";import{U as qe}from"./usd-currency-amount-OKdR9Ymz.js";import{R as De}from"./RefillModal-peJOgeto.js";import{t as Ue}from"./explorer-Cg_jVVyy.js";import"./RefillModalContent-DlFbo1-1.js";import"./v-stack-DE1rRJbv.js";function Ee(n){return{tonSupply:new V(n.balance),tonRate:n.usd_per_testnet_ton}}async function $(n,a=0){return se.blockchain.getBlockchainTransactionByMessageHash(n).then(s=>s.hash).catch(s=>{if(ne(s,"message")&&s.message==="transaction not found"){if(a>20)throw new Error("Tx not found");return new Promise(t=>setTimeout(t,1500)).then(()=>$(n,a+1))}throw s})}function _e(){const n=W();return X({queryKey:["faucet-supply-rate",n||void 0],queryFn:async()=>{const{data:a,error:s}=await ae();if(s)throw s;return Ee(a)},enabled:!!n,refetchInterval:30*1e3,staleTime:30*1e3})}function We(){const n=Y(),a=W(),s=L();return ee({mutationFn:async t=>{const r=a;if(!r)throw new Error("Project not selected");const{data:c,error:o}=await te({query:{project_id:r},body:{address:t.receiverAddress,coins:t.amount.weiAmount.toNumber()}});if(o)throw o;const i=await $(c.hash);return await n.invalidateQueries({queryKey:["faucet-supply-rate",r]}),{amount:t.amount,link:Ue.transactionLink(i),_projectId:r}},onSuccess:t=>{s({title:"Successfully bought testnet assets",status:"success",isClosable:!0,duration:3e3})},onError:t=>{var i,m;let r="Unknown error",c="Unknown api error happened. Try again later";const o=t;((m=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:m.code)===3&&(r="Only one request per minute is allowed",c="Please wait few minutes and try again"),s({title:r,description:c,status:"error",isClosable:!0,duration:3e3})}})}const Ve=({id:n,onSubmit:a,disableDefaultFocus:s,tonLimit:t,isDisabled:r,...c})=>{var b;const o=l=>{a({amount:V.fromRelativeAmount(l.tonAmount),receiverAddress:he.Address.parse(l.address).toRawString()})},i=re();let{handleSubmit:m,register:g,setFocus:y,formState:{errors:u}}=H({defaultValues:{tonAmount:void 0}});i&&({handleSubmit:m,register:g,setFocus:y,formState:{errors:u}}=i);const{ref:x}=oe({...ie,min:0,max:t==null?void 0:t.amount.toNumber()});j.useEffect(()=>{s||y("tonAmount")},[s,y]);const{ref:v,...B}=g("tonAmount",{required:"This is required",validate:l=>{if(!Q(l))return"Wrong amount format";if(Number(l)<1)return"Amount must be greater than 1";if(!t)return"Wait until total supply will be loaded";if(t.amount.lt(l))return`Not enough testnet coins supply. Max is ${t.amount.toNumber()}`}});return e.jsx(le.form,{id:n,onSubmit:m(o),noValidate:!0,...c,children:e.jsxs("fieldset",{disabled:r,children:[e.jsxs(q,{mb:"4",isInvalid:!!u.tonAmount,isRequired:!0,children:[e.jsx(D,{htmlFor:"tonAmount",children:"Amount"}),e.jsxs(ce,{children:[e.jsx(U,{ref:ue(x,v),pr:"130px",autoComplete:"off",id:"tonAmount",placeholder:"1",...B}),e.jsx(de,{w:"130px",children:e.jsx(d,{textStyle:"body2",color:"text.secondary",children:"TON (testnet)"})})]}),e.jsx(E,{pos:"static",children:u.tonAmount&&u.tonAmount.message}),e.jsxs(f,{textStyle:"body3",gap:"1",mt:(b=u.tonAmount)!=null&&b.message?"1":"2",children:[e.jsx(d,{color:"text.secondary",children:"Max.available for buy:"}),e.jsxs(me,{minW:"80px",h:"18px",isLoaded:!!t,children:[t==null?void 0:t.stringCurrencyAmount," (testnet)"]})]})]}),e.jsxs(q,{mb:"0",isInvalid:!!u.address,isRequired:!0,children:[e.jsx(D,{htmlFor:"address",children:"Recipient testnet address"}),e.jsx(U,{autoComplete:"off",id:"address",placeholder:"Address",...g("address",{required:"This is required",validate:l=>{if(!xe(l,{acceptTestnet:!0,acceptRaw:!0}))return"Wrong address"}})}),e.jsx(E,{pos:"static",children:u.address&&u.address.message})]})]})})},He=({isOpen:n,onClose:a,amount:s,receiverAddress:t,price:r,isLoading:c,onConfirm:o})=>{const i=t?pe(t):"",m=j.useCallback(()=>{o&&s&&t&&o({amount:s,receiverAddress:t})},[o,s,t]);return e.jsxs(ye,{isOpen:n,onClose:a,scrollBehavior:"inside",children:[e.jsx(fe,{}),e.jsxs(be,{children:[e.jsx(je,{}),e.jsx(ge,{children:"Payment Details"}),e.jsx(we,{children:e.jsx(Ae,{children:e.jsxs(Se,{textStyle:"body2",flexDir:"column",gap:"3",display:"flex",px:"6",py:"5",children:[e.jsxs(f,{align:"center",justify:"space-between",children:[e.jsx(d,{color:"text.secondary",children:"Amount"}),e.jsxs(d,{children:[s==null?void 0:s.stringCurrencyAmount," (testnet)"]})]}),e.jsxs(f,{align:"center",justify:"space-between",children:[e.jsx(d,{color:"text.secondary",children:"Recipient testnet address"}),e.jsx(d,{children:e.jsx(Ce,{canBeShown:!0,host:e.jsx(d,{children:Te(i)}),children:i})})]}),e.jsxs(f,{align:"flex-start",justify:"space-between",children:[e.jsx(d,{color:"text.secondary",children:"Price"}),r&&e.jsxs(A,{textAlign:"right",children:[e.jsx(d,{children:r.stringCurrencyAmount}),e.jsx(A,{color:"text.secondary",children:"USD"})]})]})]})})}),e.jsxs(ve,{gap:"3",children:[e.jsx(k,{flex:1,onClick:a,variant:"secondary",children:"Cancel"}),e.jsx(k,{flex:1,isLoading:c,onClick:m,variant:"primary",children:"Confirm Purchase"})]})]})]})},Qe=1e6,$e=1e9,Ye=()=>{const{isOpen:n,onClose:a,onOpen:s}=_(),{isOpen:t,onClose:r,onOpen:c}=_(),[o,i]=j.useState(""),[m,g]=j.useState(void 0),[y,u]=j.useState(null),{data:x,refetch:v}=_e(),{mutate:B,isPending:b}=We();Be(v);const l=j.useId(),I=H(),{data:p}=Re(),{data:N}=Fe(),{watch:G}=I,S=G("tonAmount"),R=(x==null?void 0:x.tonRate)??0,K=new w(R),F=N!==void 0?new w(N):null;let h;x&&Q(S)&&Number(S)&&Number(S)>=.01&&(h=new qe(new w(Number(S)).multipliedBy(K)));const O=p!=null&&p.usdt?new w(p.usdt.amount.toString()).dividedBy(Qe):null,P=p!=null&&p.ton?new w(p.ton.amount.toString()).dividedBy($e):null,M=P&&F&&F.gt(0)?P.multipliedBy(F):null,Z=C=>{i(C.receiverAddress),g(C.amount);const T=!!(h&&O&&O.gte(h.amount)),J=!!(h&&M&&M.gte(h.amount));if(h&&(T||J))return s();c()},z=C=>{B(C,{onSuccess:T=>{u({amount:T.amount,link:T.link}),a()}})};return e.jsxs(ke,{h:"fit-content",children:[e.jsxs(f,{justify:"space-between",align:"center",gap:"4",flexWrap:"wrap",maxW:"512px",children:[e.jsx(Ie,{mb:"2",children:"Testnet Assets"}),e.jsx(d,{textStyle:"label2",color:"text.tertiary",alignContent:"center",children:"Promo balance cannot be used to purchase assets"})]}),e.jsx(Ne,{w:"auto",mx:"-6",mb:"4"}),e.jsxs(A,{maxW:"512px",children:[e.jsx(Oe,{...I,children:e.jsx(Ve,{id:l,tonLimit:(x==null?void 0:x.tonSupply)||void 0,onSubmit:Z,isDisabled:b,mb:"6",w:"100%"})}),e.jsxs(f,{align:"center",gap:"4",justify:"space-between",w:"100%",children:[e.jsx(f,{align:"center",gap:"4",flexWrap:"wrap",children:e.jsx(k,{form:l,isLoading:b,type:"submit",children:h?`Buy for ${h.stringCurrencyAmount}`:"Buy Testnet TON"})}),R>0&&e.jsxs(A,{textStyle:"label2",color:"text.secondary",textAlign:"right",children:["1 testnet TON = $",Pe(R,{decimalPlaces:2})]}),y&&e.jsxs(A,{textStyle:"label2",color:"text.secondary",textAlign:"right",ml:"auto",children:["Bought ",y.amount.stringAmount," testnet TON"," ",e.jsx(Me,{textStyle:"label2",color:"text.accent",href:y.link,isExternal:!0,children:"View in explorer"})]})]})]}),e.jsx(He,{isOpen:n,onClose:a,price:h,amount:m,receiverAddress:o,onConfirm:z,isLoading:b}),e.jsx(De,{isOpen:t,onClose:r})]})};export{Ye as default};
