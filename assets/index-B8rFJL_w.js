import{cV as Z,q as B,d0 as $,ck as J,c_ as q,r as b,af as W,j as e,ae as f,d1 as G,X as ee,dm as D,T as m,b3 as se,ax as P,b7 as O,bF as te,bG as ne,bH as oe,bI as R,B as v,b9 as re,dn as ae,az as ie,bd as E,dg as L,av as ce,aA as le,aB as de,aC as ue,aD as xe,aE as he,aF as me,bj as be,aG as pe,b as w,bM as je,G as U,s as fe,v as ge,w as z,x as S,y as ye,z as k,F as h,N as Se,Q as ke,V as Ce,R as we,U as V,bO as _e,k as C,I as ve,l as Ie,bZ as Be,C as Le,bm as Te,dh as Me,O as Ne,L as H,E as Fe,D as T}from"./index-BCN26Ft_.js";import{d as We,e as Ee,f as Q,b as Ae,g as De}from"./queries-C0jQ22JL.js";import{u as Pe}from"./useSearchParams-BuN13fRl.js";import{D as Oe}from"./DeleteIcon24-Bd3bueMl.js";import{c as Y}from"./create-icon-DGbTGMWV.js";import{T as Re}from"./table-container-B5le7CdA.js";import{C as ze}from"./CreateIcon96-DLe490jy.js";import{S as M}from"./Card-DjvQip0-.js";import"./card-header-CLcn9s-r.js";const[Ve,A]=Z({name:"BreadcrumbStylesContext",errorMessage:`useBreadcrumbStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Breadcrumb />" `}),K=B(function(n,t){const r=$("Breadcrumb",n),c=J(n),{children:d,spacing:a="0.5rem",separator:l="/",className:u,listProps:x,...i}=c,o=q(d),j=o.length,g=o.map((p,_)=>b.cloneElement(p,{separator:l,spacing:a,isLastChild:j===_+1})),y=W("chakra-breadcrumb",u);return e.jsx(f.nav,{ref:t,"aria-label":"breadcrumb",className:y,__css:r.container,...i,children:e.jsx(Ve,{value:r,children:e.jsx(f.ol,{className:"chakra-breadcrumb__list",...x,__css:{display:"flex",alignItems:"center",...r.list},children:g})})})});K.displayName="Breadcrumb";const I=B(function(n,t){const{isCurrentPage:r,as:c,className:d,href:a,...l}=n,u=A(),x={ref:t,as:c,className:W("chakra-breadcrumb__link",d),...l};return r?e.jsx(f.span,{"aria-current":"page",__css:u.link,...x}):e.jsx(f.a,{__css:u.link,href:a,...x})});I.displayName="BreadcrumbLink";const N=B(function(n,t){const{spacing:r,...c}=n,d=A(),a=G({mx:r,...d.separator});return e.jsx(f.span,{ref:t,role:"presentation",...c,__css:a})});N.displayName="BreadcrumbSeparator";const F=B(function(n,t){const{isCurrentPage:r,separator:c,isLastChild:d,spacing:a,children:l,className:u,...x}=n,o=q(l).map(p=>p.type===I?b.cloneElement(p,{isCurrentPage:r}):p.type===N?b.cloneElement(p,{spacing:a,children:p.props.children||c}):p),j=A(),g=G({display:"inline-flex",alignItems:"center",...j.item}),y=W("chakra-breadcrumb__list-item",u);return e.jsxs(f.li,{ref:t,className:y,...x,__css:g,children:[o,!d&&e.jsx(N,{spacing:a,children:c})]})});F.displayName="BreadcrumbItem";const He=Y({d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z",displayName:"ChevronLeftIcon"}),qe=Y({d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",displayName:"ChevronRightIcon"}),Ge=({currentPage:s,totalPages:n,onPageChange:t})=>{const r=()=>{s>1&&t(s-1)},c=()=>{s<n&&t(s+1)};return e.jsxs(ee,{justifyContent:"end",mt:4,mr:2,spacing:4,children:[e.jsx(D,{w:8,h:8,"aria-label":"Previous Page",icon:e.jsx(He,{}),isDisabled:s===1,onClick:r}),e.jsxs(m,{children:["Page ",s," of ",n]}),e.jsx(D,{w:8,h:8,"aria-label":"Next Page",icon:e.jsx(qe,{}),isDisabled:s===n,onClick:c})]})},Ue=({id:s,onSubmit:n,disableDefaultFocus:t,...r})=>{const c=i=>{n({accounts:i.accounts.split(",").map(o=>o.trim()).map(o=>E.Address.parse(o))})},{handleSubmit:d,register:a,setFocus:l,control:u,formState:{errors:x}}=se();return b.useEffect(()=>{t||l("accounts")},[t,l]),e.jsxs(f.form,{id:s,w:"100%",onSubmit:d(c),noValidate:!0,...r,children:[e.jsxs(P,{isInvalid:!!x.initiations,children:[e.jsx(O,{htmlFor:"initiations",children:"Initiations"}),e.jsx(te,{name:"initiations",control:u,render:({field:i})=>e.jsxs(ne,{flexDir:"column",display:"flex",...oe(i),children:[e.jsx(R,{alignItems:"flex-start",mb:"2",isDisabled:!0,variant:"withDescription",children:e.jsx(v,{textStyle:"label2",mb:"0.5",children:"Finalized trace (will be available soon)"})}),e.jsx(R,{alignItems:"flex-start",defaultChecked:!0,variant:"withDescription",children:e.jsx(v,{textStyle:"label2",mb:"0.5",children:"Transactions"})})]})})]}),e.jsxs(P,{isInvalid:!!x.accounts,isRequired:!0,children:[e.jsx(O,{htmlFor:"accounts",children:"Accounts"}),e.jsx(re,{id:"accounts",placeholder:"Accounts",...a("accounts",{required:"This is required",validate(i){return i.split(",").some(j=>!ae(j.trim()))?"Invalid account address":!0}})}),e.jsx(ie,{children:x.accounts&&x.accounts.message})]})]})},Qe=s=>{const n="add-subscription-form",{selectedWebhookId:t,network:r}=L(),{mutate:c,isPending:d}=We(t||0,r),a=ce(),{reset:l,formState:{isDirty:u}}=a,x=b.useCallback(i=>{t&&c(i.accounts,{onSuccess:()=>{s.onClose()}})},[c,s,t]);return b.useEffect(()=>{s.isOpen||setTimeout(l,200)},[l,s.isOpen]),e.jsxs(le,{scrollBehavior:"inside",...s,children:[e.jsx(de,{}),e.jsxs(ue,{children:[e.jsx(xe,{children:"Add Subscription"}),e.jsx(he,{}),e.jsx(me,{children:e.jsx(be,{...a,children:e.jsx(Ue,{id:n,onSubmit:x})})}),e.jsxs(pe,{gap:"3",children:[e.jsx(w,{flex:1,onClick:s.onClose,variant:"secondary",children:"Cancel"}),e.jsx(w,{flex:1,form:n,isDisabled:!u,isLoading:d,type:"submit",variant:"primary",children:"Create"})]})]})]})},Ye=({subscription:s,isOpen:n,onClose:t})=>{const{selectedWebhookId:r,network:c}=L(),{mutate:d,isPending:a}=Ee(r||0,c),l=b.useCallback(()=>{s&&r&&d([E.Address.parse(s.account_id)],{onSuccess:t})},[s,r,d,t]);return e.jsx(je,{isOpen:n,onClose:t,onConfirm:l,title:u=>`Delete ${u}`,description:u=>e.jsx(e.Fragment,{children:e.jsxs(m,{textStyle:"text.body2",mb:"6",color:"text.secondary",children:["This action cannot be canceled. To confirm, type ",e.jsx("b",{children:u})," in the box below."]})}),confirmValue:s.account_id,confirmButtonText:"Delete",isLoading:a})},Ke=s=>{const{selectedWebhookId:n,subscriptionsPage:t,setSubscriptionsPage:r}=L(),{data:c=[],isLoading:d}=Q(n,t),[a,l]=b.useState(),u=b.useCallback(o=>{l({key:o,action:"edit"})},[]),x=b.useCallback(o=>{l({key:o,action:"delete"})},[]),i=b.useCallback(()=>{l(null)},[]);return d?e.jsx(U,{}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{border:"1px",borderColor:"background.contentTint",borderRadius:"sm",...s,children:e.jsxs(fe,{variant:"simple",children:[e.jsx(ge,{children:e.jsxs(z,{children:[e.jsx(S,{children:"Account"}),e.jsx(S,{children:"Last Delivered LT"}),e.jsx(S,{children:"Failed Attempts"}),e.jsx(S,{children:"Failed LT"}),e.jsx(S,{children:"Failed At"})]})}),e.jsx(ye,{children:c.map(o=>e.jsxs(z,{children:[e.jsx(k,{overflow:"hidden",minW:250,children:E.Address.parse(o.account_id).toString({bounceable:!1})}),e.jsx(k,{overflow:"hidden",maxW:"200px",children:o.last_delivered_lt??"-"}),e.jsx(k,{overflow:"hidden",maxW:"200px",children:o.failed_attempts??"-"}),e.jsx(k,{overflow:"hidden",maxW:"200px",children:o.failed_lt??"-"}),e.jsx(k,{overflow:"hidden",maxW:"200px",children:e.jsxs(h,{align:"center",justify:"space-between",gap:"4",children:[o.failed_at??"-",e.jsxs(Se,{placement:"bottom-end",children:[e.jsx(ke,{icon:e.jsx(Ce,{})}),e.jsxs(we,{w:"132px",children:[e.jsxs(V,{onClick:()=>u(o),children:[e.jsx(_e,{mr:"2"}),e.jsx(m,{textStyle:"label2",fontFamily:"body",children:"Edit"})]}),e.jsxs(V,{onClick:()=>x(o),children:[e.jsx(Oe,{mr:"2"}),e.jsx(m,{textStyle:"label2",fontFamily:"body",children:"Delete"})]})]})]})]})})]},o.account_id))})]})}),e.jsx(Ge,{currentPage:t,totalPages:Math.ceil(c.length/20),onPageChange:o=>r(o)}),a&&e.jsx(Ye,{isOpen:(a==null?void 0:a.action)==="delete",subscription:a==null?void 0:a.key,onClose:i})]})},Xe=({onOpenCreate:s})=>e.jsx(h,{align:"center",justify:"center",children:e.jsxs(h,{align:"center",direction:"column",maxW:"512px",children:[e.jsx(ze,{mb:"8"}),e.jsx(C,{mb:"2",children:"Your Subscriptions will be shown here"}),e.jsx(m,{textStyle:"body2",mb:"6",color:"text.secondary",children:"Add your first Subscription"}),e.jsx(w,{onClick:s,children:"Add Subscriptions"})]})}),Ze=s=>e.jsx(ve,{w:"16px",h:"16px",color:"icon.secondary",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",...s,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.27324 3.17107C6.59298 2.90775 7.06565 2.9535 7.32897 3.27324L10.829 7.52324C11.057 7.80019 11.057 8.19986 10.829 8.4768L7.32897 12.7268C7.06565 13.0465 6.59298 13.0923 6.27324 12.829C5.9535 12.5656 5.90776 12.093 6.17107 11.7732L9.27843 8.00002L6.17107 4.2268C5.90775 3.90706 5.9535 3.43439 6.27324 3.17107Z",fill:"currentColor"})}),$e=({isOnline:s,label:n=!1})=>e.jsxs(h,{align:"center",gap:"8px",children:[e.jsx(v,{sx:{"@keyframes pulse":{"0%":{boxShadow:"0 0 8px green"},"50%":{boxShadow:"0 0 12px green"},"100%":{boxShadow:"0 0 8px green"}}},w:"10px",h:"10px",bg:s?"green.500":"red.500",borderRadius:"50%",shadow:s?"0 0 8px green":"none",animation:s?"pulse 1.5s infinite":"none"}),n&&e.jsx(m,{color:s?"green.700":"gray.700",fontSize:"sm",children:s?"Online":"Offline"})]});function Je(s){if(!s)return null;const n=parseInt(s);return isNaN(n)?null:n}const ls=()=>{const{searchParams:s}=Pe(),n=s.get("webhookId"),t=Je(n),{setSelectedWebhookId:r,network:c}=L(),{data:d=[]}=Ae(c),{data:a=[],isLoading:l}=Q(t,1),{mutate:u,isPending:x}=De(c),i=t?d.find(X=>X.id===t):null;b.useEffect(()=>(t&&r(t),()=>{r(null)}),[t,r]);const{isOpen:o,onOpen:j,onClose:g}=Ie();if(n&&!t)return e.jsx(Be,{to:"/tonapi/webhooks",replace:!0});if(!i||l)return e.jsx(Le,{h:"300px",children:e.jsx(U,{})});const y=e.jsxs(K,{mb:"3",color:"text.secondary",fontSize:14,fontWeight:700,separator:e.jsx(Ze,{color:"text.secondary"}),spacing:"8px",children:[e.jsx(F,{children:e.jsx(I,{as:Te,to:"/tonapi/webhooks",children:"Webhooks"})}),e.jsx(F,{color:"text.primary",isCurrentPage:!0,children:e.jsx(I,{href:"#",children:i.endpoint})})]}),p=a.length===0,_=i.status===Me.RTOnline;return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{breadcrumbs:y,h:"fit-content",children:[e.jsxs(h,{mb:"4",children:[e.jsxs(h,{direction:"column",gap:2,children:[e.jsx(h,{align:"center",gap:4,children:e.jsx(C,{children:"Webhook Subscriptions"})}),e.jsx(h,{children:e.jsxs(m,{textStyle:"text.body2",color:"text.secondary",fontSize:14,children:["More webhook options can be explored through the API. For details, see"," ",e.jsx(H,{color:"accent.blue",href:Fe.DOCUMENTATION_WEBHOOKS,isExternal:!0,children:"Webhooks documentation"})]})})]}),!p&&e.jsx(w,{mb:"4",ml:"auto",onClick:j,children:"Add Subscription"})]}),p?e.jsx(Xe,{onOpenCreate:j}):e.jsxs(e.Fragment,{children:[e.jsx(T,{mb:"4"}),e.jsxs(v,{mb:4,children:[e.jsxs(h,{align:"center",justify:"space-between",gap:4,children:[e.jsx(C,{children:"Status"}),e.jsxs(h,{gap:"3",children:[e.jsx($e,{isOnline:_,label:!0}),!_&&e.jsx(w,{isLoading:x,onClick:()=>i&&u(i.id),size:"sm",children:"Try Online"})]})]}),e.jsxs(h,{wrap:{base:"wrap",lg:"nowrap"},gap:"6",mt:2,mb:4,children:[e.jsx(M,{header:"Total of Accounts",value:i.subscribed_accounts}),e.jsx(M,{header:"Total of Opcodes",value:i.subscribed_msg_opcodes}),e.jsx(M,{header:"Failed Attempts",value:i.status_failed_attempts}),e.jsxs(h,{direction:"column",ml:"auto",fontSize:"14px",children:[e.jsxs(m,{textStyle:"text.body2",align:"end",textColor:"text.secondary",children:["Last online at:"," ",i.last_online_at]}),e.jsxs(m,{textStyle:"text.body2",align:"end",textColor:"text.secondary",children:["Status updated at:"," ",i.status_updated_at]}),e.jsxs(m,{textStyle:"text.body2",align:"end",mt:"1",children:["Subscribed to Mempool:"," ",i.subscribed_to_mempool?"Yes":"No"]}),e.jsxs(m,{textStyle:"text.body2",align:"end",children:["Subscribed to New Contracts:"," ",i.subscribed_to_new_contracts?"Yes":"No"]})]})]})]}),e.jsx(T,{mb:"4"}),e.jsx(C,{children:"Subscribed opcodes"}),e.jsxs(m,{textStyle:"text.body2",mt:"3",color:"text.secondary",fontSize:14,children:["To get the list of opcodes or subscribing to specific opcodes, refer to the API methods described"," ",e.jsx(H,{color:"accent.blue",href:"https://docs.tonconsole.com/tonapi/webhooks-api",isExternal:!0,children:"here"})]}),e.jsx(T,{my:"4"}),e.jsx(C,{children:"Subscribed accounts"}),e.jsx(Ke,{mt:"3"})]})]}),e.jsx(Qe,{isOpen:o,onClose:g})]})};export{ls as default};
