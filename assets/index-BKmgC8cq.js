import{r as s,q as H,j as e,F as u,b$ as Q,T as w,by as X,b as y,e2 as z,du as Y,v as q,ey as Z,ez as ee,em as te,en as G,C as R,V as O,bC as M,k as V,ev as ne,O as se,B as oe,bN as ae,eo as ie,D as re,eA as le}from"./index--6gyeIm1.js";import{F as ce,a as de,I as ue}from"./UtilsComponents-CpKHSN7E.js";import{g as J,a as W,p as v,b as pe,c as xe,A as me}from"./airdrop.store-BCJp4K4U.js";import{C as fe}from"./index-Dfsp2eQr.js";import{C as he}from"./card-Csp8xPXk.js";import"./copy-to-clipboard-Ct1_m45i.js";import"./serialize-a49E7W4J.js";const je=i=>{const[l,n]=s.useState(!1),[x,t]=s.useState(null),[m,p]=s.useState(null),[r,c]=s.useState(!1),[o,I]=s.useState(!1),[f,b]=s.useState(null),a=H(),C=s.useRef(null),_=s.useRef(null),k=i.airdropStore,g=k.airdrop$.value,$=()=>{C.current&&clearInterval(C.current)};s.useEffect(()=>(l?$():C.current=setInterval(async()=>{await k.loadAirdrop(i.id)},2e3),()=>$()),[l]),s.useEffect(()=>{g.upload_error&&(t(g.upload_error),c(!1)),(g.upload_in_progress||g.file_hash)&&c(!0)},[g]);const S=async d=>{n(!0),t(null),await z.v2.fileUpload({id:i.id,project_id:`${a}`},{file:d},{onUploadProgress:h=>{if(h.total){const T=Math.round(h.loaded/h.total*100);p(T)}}}).catch(h=>{t(h==null?void 0:h.message)}).finally(async()=>{await k.loadAirdrop(i.id),n(!1),p(null),_.current&&(_.current.value="")})},L=async()=>{n(!0),t(null);try{new URL(f)}catch{t("Incorrect file URL")}await z.v2.fileUpload({id:i.id,project_id:`${a}`},{url:f}).catch(d=>{t(d==null?void 0:d.message)}).finally(async()=>{await k.loadAirdrop(i.id),n(!1)})},A=async d=>{if(d.type!=="text/csv"&&!d.name.endsWith(".csv")){t("Invalid file type");return}if(d.size<1e3){t("Minimum 20 wallets");return}if(d.size>104857600){t("Maximum 100 MB");return}await S(d)};return e.jsxs(u,{direction:"column",gap:"16px",children:[r&&e.jsx(ce,{}),!r&&e.jsxs(u,{direction:"column",gap:"24px",children:[e.jsxs(u,{direction:"column",gap:"16px",children:[e.jsx(Q,{checked:o,onChange:()=>I(!o),children:e.jsx(w,{textStyle:"label2",children:"File size more than 100 MB"})}),o?e.jsxs(u,{direction:"column",gap:"12px",children:[e.jsxs(u,{align:"center",direction:"row",gap:"12px",children:[e.jsx(X,{autoComplete:"off",onChange:d=>b(d.target.value),placeholder:"File URL",value:f||""}),e.jsx(y,{flexShrink:0,isDisabled:!f,isLoading:l,onClick:L,children:"Upload File"})]}),!!x&&e.jsx(w,{textStyle:"body2",color:"#F53C36",children:x})]}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{align:"center",direction:"row",gap:"12px",children:[e.jsx(y,{flexShrink:0,isLoading:l,onClick:()=>{t(null),_.current.click()},children:"Upload File"}),!!m&&e.jsxs(u,{direction:"column",flex:1,gap:"4px",children:[e.jsx(u,{flex:1,overflow:"hidden",h:"8px",minH:"8px",borderRadius:"8px",bgColor:"background.contentTint",children:e.jsx(u,{w:`${m}%`,h:"8px",bgColor:"#000"})}),e.jsxs(w,{textStyle:"body3",color:"text.secondary",children:[m,"% of the file uploaded"]})]}),!m&&!!x&&e.jsx(w,{textStyle:"body2",color:"#F53C36",children:x})]}),e.jsx("input",{ref:_,type:"file",accept:".csv",style:{display:"none"},onChange:d=>{var h;(h=d.target.files)!=null&&h.length&&A(d.target.files[0])}})]})]}),e.jsx(de,{})]})]})},ge=({id:i,airdropStore:l,updateType:n,hideEnableButton:x})=>{const t=l.airdrop$.value,m=l.distributors$.value,p=J(m),[r,c]=s.useState(!1),[o,I]=s.useState(!1),[f,b]=s.useState(!1),[a,C]=s.useState(p),_=q(),[k]=G(),[g,$]=s.useState(m),[S,L]=s.useState(W(m,p)),A=s.useRef(null),d=async()=>{await l.loadDistributors(i).then(j=>{$(j),T()})};s.useEffect(()=>{(n==="ready"&&a==="ready"||n==="block"&&(a==="block"||a==="withdraw_jetton"||a==="withdraw_ton"))&&(I(!0),(async()=>await l.loadAirdrop(i))())},[a,n]),s.useEffect(()=>{(async()=>await d())()},[]),s.useEffect(()=>(A.current=setInterval(async()=>{await d()},2e3),()=>h()),[g,S,f]);const h=()=>{A.current&&clearInterval(A.current)},T=()=>{const j=J(g),F=W(g,j);L(F),a!==j&&(C(j),b(!1))},D=async()=>{if(a==="waiting"||f)return;const j=W(g,a),F=pe(g,a);if(await xe({admin:t.admin,jetton:t.jetton.address,needTon:(j==null?void 0:j.ton)||0,needJetton:(j==null?void 0:j.jetton)||0,errCb:U=>{_({title:U.title,description:U.text,position:"bottom-left",duration:5e3,status:"error",isClosable:!0})}}))try{await k.sendTransaction({validUntil:Math.floor(new Date().getTime()/1e3+120),messages:F}),x&&x(),b(!0)}catch(U){console.error(U)}};if(t.status==="claim_active"||a==="withdraw_complete")return null;if(o||!g.length||a==="waiting"||!S||t.status==="need_deploy"&&a==="ready")return e.jsx(R,{children:e.jsx(O,{})});if(t.status==="claim_stopped")return e.jsxs(e.Fragment,{children:[e.jsx(y,{isLoading:f,onClick:()=>c(!0),variant:"secondary",children:"Complete Airdrop"}),e.jsx(fe,{isOpen:r,onClose:()=>c(!1),onConfirm:()=>{c(!1),D()},title:"Complete Airdrop?",description:"This action cannot be canceled.",confirmButtonText:"Complete Airdrop"})]});if(t.status==="blocked")return e.jsxs(u,{wrap:"wrap",direction:"row",gap:"16px",children:[a==="withdraw_jetton"&&e.jsxs(y,{isLoading:f,onClick:D,children:["Withdraw ",t.jetton.symbol]}),e.jsx(y,{isDisabled:a==="withdraw_jetton",isLoading:a==="withdraw_ton"&&f,onClick:D,children:"Withdraw TON"})]});let P="Deploy",B=`You need ${v(M.fromNano(S.ton))} TON on your wallet`;return a==="topup"&&(P="Top Up",B=`You need ${v(M.fromNano(S.ton))} TON and ${v(S.jetton/10**parseFloat(t.jetton.decimals))} ${t.jetton.symbol} on your wallet`),e.jsxs(u,{align:"center",direction:"row",gap:"16px",children:[e.jsx(y,{isLoading:f,onClick:D,children:P}),e.jsx(w,{textStyle:"body2",color:"text.secondary",children:B})]})},be=i=>{const l=i.airdropStore.airdrop$.value,n=q(),x=Z(),t=ee(),{open:m}=te(),[p]=G(),r=()=>{n({title:"Connect Admin Wallet",description:"Please reconnect with admin wallet",position:"bottom-left",duration:5e3,status:"error",isClosable:!0})},c=async()=>{t&&t.account.address!==l.admin&&await p.disconnect(),m()};return s.useEffect(()=>{x&&t&&t.account.address!==l.admin&&r()},[t,x]),!(t!=null&&t.account.address)||t.account.address!==l.admin?e.jsx(y,{flex:1,alignSelf:"flex-start",onClick:c,variant:"primary",children:"Connect Admin Wallet"}):e.jsx(ge,{...i})},N=Y(be),E=i=>e.jsx(he,{flex:"1",minW:"260px",bg:"background.contentTint",children:e.jsxs(u,{direction:"column",px:"16px",py:"12px",children:[e.jsx(w,{textStyle:"label2",color:"text.secondary",children:i.title}),e.jsx(V,{children:i.text})]})}),ye=({airdrop:i,distributors:l})=>{if(!l.length)return e.jsx(R,{children:e.jsx(O,{})});const n=l.reduce((p,r)=>p+((r==null?void 0:r.completed_claims)||0),0),x=l.reduce((p,r)=>p+parseFloat((r==null?void 0:r.claimed_amount)||"0"),0),t=l.reduce((p,r)=>p+parseFloat((r==null?void 0:r.jetton_balance)||"0"),0),m=l.reduce((p,r)=>p+parseFloat(r.accumulated_commission||"0"),0);return e.jsxs(u,{align:"center",wrap:"wrap",direction:"row",gap:"16px",children:[e.jsx(E,{title:"Number of claims",text:`${v(n)}`}),e.jsx(E,{title:"Claimed Jettons",text:`${v(x/10**parseFloat(i.jetton.decimals))}`}),e.jsx(E,{title:"Remaining Jettons",text:`${v(t/10**parseFloat(i.jetton.decimals))} ${i.jetton.symbol}`}),e.jsx(E,{title:"Profit",text:`${v(M.fromNano(m))} TON`})]})},we=Y(ye),$e=({airdropsStore:i,...l})=>{const{id:n}=ne(),[x,t]=s.useState(!1),[m,p]=s.useState(!0),r=H(),c=s.useMemo(()=>new me({projectId:r,airdrops:i.airdrops$.value}),[n]),o=c.airdrop$.value,I=c.distributors$.value;s.useEffect(()=>(n&&c.loadAirdrop(n),()=>{c.clearAirdrop()}),[n,c]);const f=async C=>{t(!0),await c.switchClaim(n,C),t(!1)};if(!i.airdrops$.isResolved||!c.airdrop$.isResolved||!n)return e.jsx(R,{h:"300px",children:e.jsx(O,{})});if(!o)return e.jsx(R,{h:"300px",children:e.jsx(w,{children:"Airdrop not found"})});let b="Upload the file with recipients",a="PREPARATION";return o.status==="need_deploy"&&(b="Create and top up distribution smart contracts by clicking the Deploy button."),o.status==="claim_active"&&(b="Airdrop is ready, you can pause claims or complete the distribution.",a="CLAIM ENABLED"),o.status==="claim_stopped"&&(b="Enable users to claim by clicking the Enable Claim button.",a="CLAIM DISABLED"),o.status==="blocked"&&(b="Distribution completed. You can withdraw the accumulated profit and remaining tokens using the Withdraw button.",a="FINISHED"),e.jsxs(se,{display:"flex",flexDirection:"column",px:"0",...l,children:[e.jsxs(u,{align:"flex-start",justify:"space-between",mb:"5",px:"6",children:[e.jsxs(oe,{children:[e.jsxs(u,{align:"center",direction:"row",gap:"8px",children:[e.jsx(V,{mb:"1",children:o.name}),e.jsx(ae,{textStyle:"label3",color:"accent.blue",bgColor:"color-mix(in srgb, currentColor 12%, transparent)",children:a})]}),e.jsx(w,{textStyle:"body2",color:"text.secondary",children:b})]}),e.jsx(ie,{})]}),e.jsx(re,{mb:"3"}),e.jsxs(u,{align:"flex-start",direction:"row",gap:"16px",px:"6",children:[e.jsxs(u,{direction:"column",gap:"24px",minW:"520px",maxW:"520px",children:[e.jsx(ue,{airdrop:o,id:n,distributors:I}),o.status==="need_file"&&e.jsx(je,{id:n,airdropStore:c}),o.status==="need_deploy"&&e.jsx(N,{id:n,updateType:"ready",airdropStore:c}),(o.status==="claim_active"||o.status==="claim_stopped")&&e.jsxs(u,{direction:"row",gap:"16px",children:[m&&e.jsx(y,{isLoading:x,onClick:()=>f(o.status==="claim_active"?"disable":"enable"),variant:o.status==="claim_active"?"secondary":void 0,children:o.status==="claim_active"?"Disable Claim":"Enable Claim"}),e.jsx(N,{id:n,updateType:"block",hideEnableButton:()=>p(!1),airdropStore:c})]})]}),o.status!=="need_file"&&o.status!=="need_deploy"&&e.jsxs(u,{direction:"column",gap:"16px",children:[e.jsx(we,{airdrop:o,distributors:c.distributors$.value}),o.status==="blocked"&&e.jsx(N,{id:n,airdropStore:c}),e.jsxs(u,{wrap:"wrap",direction:"row",gap:"16px",children:[e.jsx(y,{onClick:()=>{window.open(`https://tonkeeper.github.io/airdrop-reference-dapp/?airdropId=${n}&testnet=${le}`)},variant:"secondary",children:"Test claim"}),e.jsx(y,{onClick:()=>{window.open("https://docs.tonconsole.com/tonconsole/jettons/airdrop","_blank")},children:"Documentation"})]})]})]})]})};export{$e as default};
