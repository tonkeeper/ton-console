import{y as Y,cm as ee,cn as se,j as e,aK as O,aL as ne,I as te,T as u,q as U,aN as oe,co as A,B as y,F as I,b as C,cp as re,l as H,o as R,b7 as ae,cq as ie,cr as ce,a$ as L,r as h,bu as le,ay as V,az as _,aA as N,aB as z,aC as E,aD as W,b1 as q,by as Z,bz as de,b3 as $,cs as me,ct as ue,cu as xe,cv as he,cw as je,cx as pe,b4 as Q,cy as fe,i as Ce,cz as be,cA as ge,b8 as ye,a4 as ve,O as M,k as Ie,a2 as Pe,ax as we,c1 as Se,D as T,C as B,aM as Me,c2 as De,bw as ke,cB as Fe}from"./index--6gyeIm1.js";import{C as G}from"./index-Dfsp2eQr.js";import{A as Re}from"./avatar-B4IMPcy9.js";const K=Y(function(r,t){const{getBodyProps:n}=ee(),a=se();return e.jsx(O.div,{...n(r,t),className:ne("chakra-popover__body",r.className),__css:a.body})});K.displayName="PopoverBody";const Te=s=>e.jsxs(te,{w:"16px",h:"16px",color:"icon.secondary",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",...s,children:[e.jsx("g",{clipPath:"url(#clip0_4669_41302)",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 2C7.11838 2 6.38903 2.65193 6.26772 3.5H9.73228C9.61097 2.65193 8.88162 2 8 2ZM8 0.5C6.28919 0.5 4.88713 1.82189 4.75947 3.5H2.75H1.25C0.835786 3.5 0.5 3.83579 0.5 4.25C0.5 4.66421 0.835786 5 1.25 5H2V10.75L2 10.7814C1.99999 11.4548 1.99998 12.0055 2.03655 12.4531C2.0744 12.9163 2.15514 13.3347 2.35423 13.7255C2.66582 14.337 3.163 14.8342 3.77453 15.1458C4.16527 15.3449 4.58367 15.4256 5.04693 15.4634C5.49448 15.5 6.04518 15.5 6.71853 15.5H6.75H9.25H9.28144C9.95479 15.5 10.5055 15.5 10.9531 15.4634C11.4163 15.4256 11.8347 15.3449 12.2255 15.1458C12.837 14.8342 13.3342 14.337 13.6458 13.7255C13.8449 13.3347 13.9256 12.9163 13.9634 12.4531C14 12.0055 14 11.4548 14 10.7815V10.75V5H14.75C15.1642 5 15.5 4.66421 15.5 4.25C15.5 3.83579 15.1642 3.5 14.75 3.5H13.25H11.2405C11.1129 1.82189 9.71081 0.5 8 0.5ZM3.5 5V10.75C3.5 11.4624 3.50058 11.9517 3.53157 12.3309C3.56184 12.7014 3.61735 12.9004 3.69074 13.0445C3.85852 13.3738 4.12623 13.6415 4.45552 13.8093C4.59956 13.8827 4.79858 13.9382 5.16908 13.9684C5.54833 13.9994 6.03756 14 6.75 14H9.25C9.96244 14 10.4517 13.9994 10.8309 13.9684C11.2014 13.9382 11.4004 13.8827 11.5445 13.8093C11.8738 13.6415 12.1415 13.3738 12.3093 13.0445C12.3827 12.9004 12.4382 12.7014 12.4684 12.3309C12.4994 11.9517 12.5 11.4624 12.5 10.75V5H3.5ZM7 7.25C7 6.83579 6.66421 6.5 6.25 6.5C5.83579 6.5 5.5 6.83579 5.5 7.25V11.75C5.5 12.1642 5.83579 12.5 6.25 12.5C6.66421 12.5 7 12.1642 7 11.75V7.25ZM10.5 7.25C10.5 6.83579 10.1642 6.5 9.75 6.5C9.33579 6.5 9 6.83579 9 7.25V11.75C9 12.1642 9.33579 12.5 9.75 12.5C10.1642 12.5 10.5 12.1642 10.5 11.75V7.25Z",fill:"currentColor"})}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_4669_41302",children:e.jsx("rect",{width:"16",height:"16",fill:"currentColor"})})})]});async function Be(s){const t=await(await fetch(s)).blob(),n=new File([t],"image.jpg",{type:t.type}),a=new DataTransfer;return a.items.add(n),a.files}const Oe=s=>{const{projectName:r,isOpen:t,onClose:n,onConfirm:a}=s;return e.jsx(G,{isOpen:t,onClose:n,onConfirm:a,title:o=>`Delete ${o}`,description:o=>e.jsx(e.Fragment,{children:e.jsxs(u,{textStyle:"text.body2",mb:"6",color:"text.secondary",children:["This action cannot be canceled. To confirm, type ",e.jsx("b",{children:o})," in the box below."]})}),confirmValue:r,confirmButtonText:"Delete"})},P=s=>[s.first_name,s.last_name].filter(Boolean).join(" ")||"User",Ue=({isOpen:s,onClose:r,participant:t,projectId:n})=>{const a=ie(n),o=()=>{a.mutate(t.id,{onSuccess:r})};return e.jsx(G,{isOpen:s,onClose:r,onConfirm:o,title:"Confirm you want to remove this user?",description:e.jsxs(u,{children:["Once removed, ",e.jsx("b",{children:P(t)})," will no longer have direct access to this project."]}),confirmButtonText:"Remove"})},Ae=({participant:s,projectId:r,isCurrentUser:t,...n})=>{const{isOpen:a,onOpen:o,onClose:i}=H(),l=P(s);return e.jsxs(I,{align:"center",gap:2,h:12,fontWeight:600,borderRadius:8,_hover:{bg:"background.contentTint"},...n,children:[e.jsx(Re,{ml:2,name:l,size:"sm",src:s.avatar}),e.jsxs(y,{fontWeight:600,children:[l,t&&e.jsx(R,{color:"text.secondary",ml:1,children:"(you)"}),!t&&e.jsxs(R,{color:"text.secondary",fontSize:14,ml:1,children:["#",s.id]})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{"aria-label":"Remove",icon:e.jsx(Te,{}),ml:"auto",onClick:o,p:3}),e.jsx(Ue,{isOpen:a,onClose:i,participant:s,projectId:r})]})]})},He=({onAddParticipant:s,...r})=>{const t=U(),{data:n}=oe(),{data:a=[]}=A(t),o=[...a].sort((i,l)=>{const d=i.id===(n==null?void 0:n.id),j=l.id===(n==null?void 0:n.id);if(d)return-1;if(j)return 1;const p=P(i).toLowerCase(),c=P(l).toLowerCase();return p.localeCompare(c)});return e.jsxs(y,{...r,children:[e.jsxs(I,{align:"center",justify:"space-between",mb:4,children:[e.jsx(u,{textStyle:"label1",children:"Team Access"}),e.jsx(C,{leftIcon:e.jsx(re,{}),onClick:s,size:"sm",variant:"secondary",children:e.jsx(y,{as:"span",display:{base:"none",sm:"inline"},children:"Add user"})})]}),o.length>0&&t&&e.jsx(y,{children:o.map(i=>e.jsx(Ae,{isCurrentUser:i.id===(n==null?void 0:n.id),participant:i,projectId:t},i.id))})]})},Le=({onClose:s,...r})=>{const t="add-project-participant-form",n=U(),{data:a=[]}=A(n),o=ce(n),{handleSubmit:i,register:l,formState:d,reset:j}=L(),p=h.useRef(null),c=()=>{s(),j()},v=b=>{o.mutate(b,{onSuccess:c})},{ref:w}=le({mask:Number,scale:0,normalizeZeros:!0,signed:!1,min:0,max:Number.MAX_SAFE_INTEGER}),{ref:f,...m}=l("userId",{required:"This is required",validate:b=>a.find(S=>S.id===b)?"User already exists":!0,valueAsNumber:!0});return e.jsxs(V,{onClose:c,scrollBehavior:"inside",...r,children:[e.jsx(_,{}),e.jsxs(N,{ref:p,maxW:"380px",children:[e.jsxs(z,{textAlign:"center",children:["Add user",e.jsx(y,{color:"text.secondary",fontSize:14,fontWeight:400,lineHeight:"20px",children:"Users with the same permissions as you, including the ability to manage all project users"})]}),e.jsx(E,{}),e.jsx(W,{py:1,children:e.jsx(O.form,{w:"100%",onSubmit:i(v),noValidate:!0,id:t,children:e.jsxs(q,{mb:0,isInvalid:!!d.errors.userId,isRequired:!0,children:[e.jsx(Z,{ref:de(w,f),autoComplete:"off",autoFocus:!0,id:"userId",min:0,placeholder:"User ID",...m}),e.jsx($,{children:d.errors.userId&&d.errors.userId.message}),e.jsxs(me,{textStyle:"body2",alignItems:"center",gap:"1",display:"flex",ml:"auto",color:"text.secondary",children:["Where to find User ID?",e.jsxs(ue,{isLazy:!0,children:[e.jsx(xe,{children:e.jsx(he,{cursor:"pointer"})}),e.jsx(je,{containerRef:p,children:e.jsx(pe,{children:e.jsx(K,{children:e.jsx("video",{autoPlay:!0,src:"/assets/videos/find-user-id.webm"})})})})]})," "]})]})})}),e.jsxs(Q,{gap:"3",children:[e.jsx(C,{flex:1,onClick:c,variant:"secondary",children:"Cancel"}),e.jsx(C,{flex:1,form:t,isLoading:o.isPending,type:"submit",variant:"primary",children:"Add"})]})]})]})},ze=()=>{var k,F;const s=fe(),r=Ce(),t=be(),n=ge(),[a,o]=h.useState(!1),[i,l]=h.useState(!1),d=H(),{register:j,handleSubmit:p,formState:c,reset:v,watch:w}=L({defaultValues:{name:"",icon:null}}),f=w("icon"),m=h.useMemo(()=>f&&f.length>0?URL.createObjectURL(f[0]):(s==null?void 0:s.imgUrl)||null,[f,s==null?void 0:s.imgUrl]);h.useEffect(()=>()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m)},[m]),h.useEffect(()=>{(async()=>{let x=null;s!=null&&s.imgUrl&&(x=await Be(s.imgUrl)),v({name:(s==null?void 0:s.name)||"",icon:x})})()},[s,v]);const b=h.useCallback(g=>{if(!s)return;const x={};c.dirtyFields.name&&(x.name=g.name),c.dirtyFields.icon&&g.icon&&g.icon.length>0&&(x.icon=g.icon[0]),Object.keys(x).length!==0&&t.mutate({projectId:s.id,...x})},[c.dirtyFields,s,t]),S=()=>{d.onClose()},D=(s==null?void 0:s.id.toString())||"",{onCopy:X,hasCopied:J}=ye(D);return e.jsxs(ve,{align:"stretch",spacing:"4",children:[e.jsxs(M,{h:"fit-content",children:[e.jsxs(I,{align:"center",justify:"space-between",wrap:"wrap",gap:"3",mb:"4",children:[e.jsx(Ie,{children:"Project Details"}),e.jsxs(Pe,{px:"3",py:"1.5",bg:"background.contentTint",borderRadius:"md",spacing:"2",children:[e.jsx(u,{textStyle:"body3",color:"text.secondary",children:"Project ID:"}),e.jsx(u,{textStyle:"body3",fontFamily:"mono",fontWeight:"medium",children:D}),e.jsx(we,{"aria-label":J?"Copied!":"Copy ID",icon:e.jsx(Se,{}),onClick:X,size:"xs",variant:"ghost"})]})]}),e.jsx(T,{w:"auto",mx:"-6",mb:"5"}),e.jsxs("form",{onSubmit:p(b),children:[e.jsxs(I,{direction:{base:"column",md:"row"},gap:"5",children:[e.jsxs(B,{as:"button",pos:"relative",overflow:"hidden",w:"72px",minW:"72px",h:"72px",bg:"background.contentTint",borderRadius:"lg",_hover:{"& > .edit-overlay":{opacity:1}},cursor:"pointer",onClick:d.onOpen,type:"button",children:[m?e.jsx(Me,{w:"100%",h:"100%",objectFit:"cover",alt:(s==null?void 0:s.name)||"Project icon",src:m}):e.jsx(u,{color:"text.primary",fontSize:"xl",fontWeight:"medium",children:((k=s==null?void 0:s.name)==null?void 0:k[0])||"P"}),e.jsx(B,{className:"edit-overlay",pos:"absolute",bg:"blackAlpha.600",opacity:"0",transition:"opacity 0.2s",inset:"0",children:e.jsx(De,{color:"white"})})]}),e.jsxs(q,{flex:"1",isInvalid:!!c.errors.name,isRequired:!0,children:[e.jsx(ke,{htmlFor:"name",children:"Name"}),e.jsx(Z,{autoComplete:"off",id:"name",placeholder:"Project name",...j("name",{required:"This is required",minLength:{value:3,message:"Minimum length should be 3"},maxLength:{value:64,message:"Maximum length is 64"}})}),e.jsx($,{children:(F=c.errors.name)==null?void 0:F.message})]})]}),e.jsx(C,{w:"100%",mt:"5",isDisabled:!c.isDirty||n.isPending,isLoading:t.isPending,type:"submit",children:"Save"})]})]}),e.jsx(M,{h:"fit-content",children:e.jsx(He,{onAddParticipant:()=>l(!0)})}),e.jsxs(M,{h:"fit-content",children:[e.jsx(u,{textStyle:"label1",mb:"4",color:"accent.red",children:"Danger Zone"}),e.jsx(T,{w:"auto",mx:"-6",mb:"4"}),e.jsx(u,{textStyle:"body2",mb:"4",color:"text.secondary",children:"Permanently delete this project and all associated data. This action cannot be undone."}),e.jsx(C,{w:"100%",isLoading:n.isPending,onClick:()=>o(!0),variant:"primary",children:"Delete Project"}),e.jsx(Oe,{isOpen:a,onClose:()=>o(!1),projectName:(s==null?void 0:s.name)||"",onConfirm:()=>{s&&n.mutate(s.id,{onSuccess:()=>{o(!1),r(null)}})}})]}),e.jsxs(V,{isOpen:d.isOpen,onClose:d.onClose,children:[e.jsx(_,{}),e.jsxs(N,{children:[e.jsx(z,{children:"Project Icon"}),e.jsx(E,{}),e.jsx(W,{children:e.jsx(Fe,{...j("icon")})}),e.jsx(Q,{children:e.jsx(C,{w:"100%",onClick:S,children:"Done"})})]})]}),e.jsx(Le,{isOpen:i,onClose:()=>l(!1)})]})};export{ze as default};
