import{r as s,W as H,j as t,F as u,bK as Q,T as y,b9 as V,b as w,df as z,cc as G,aZ as Y,dG as X,dH as tt,dv as et,dw as K,C as R,G as O,bM as nt,bd as N,_ as st,k as Z,dE as ot,O as at,B as it,bn as rt,dx as lt,D as ct,dI as dt}from"./index-BCN26Ft_.js";import{F as ut,a as pt,I as xt}from"./UtilsComponents-BC8nCbT5.js";import{g as J,a as W,p as v,b as mt,c as ft,A as ht}from"./airdrop.store-CbRzrxif.js";import"./copy-to-clipboard-Ct1_m45i.js";const jt=i=>{const[l,n]=s.useState(!1),[x,e]=s.useState(null),[m,p]=s.useState(null),[r,c]=s.useState(!1),[o,I]=s.useState(!1),[f,b]=s.useState(null),a=H(),C=s.useRef(null),_=s.useRef(null),k=i.airdropStore,g=k.airdrop$.value,T=()=>{C.current&&clearInterval(C.current)};s.useEffect(()=>(l?T():C.current=setInterval(async()=>{await k.loadAirdrop(i.id)},2e3),()=>T()),[l]),s.useEffect(()=>{g.upload_error&&(e(g.upload_error),c(!1)),(g.upload_in_progress||g.file_hash)&&c(!0)},[g]);const S=async d=>{n(!0),e(null),await z.v2.fileUpload({id:i.id,project_id:`${a}`},{file:d},{onUploadProgress:h=>{if(h.total){const $=Math.round(h.loaded/h.total*100);p($)}}}).catch(h=>{e(h==null?void 0:h.message)}).finally(async()=>{await k.loadAirdrop(i.id),n(!1),p(null),_.current&&(_.current.value="")})},L=async()=>{n(!0),e(null);try{new URL(f)}catch{e("Incorrect file URL")}await z.v2.fileUpload({id:i.id,project_id:`${a}`},{url:f}).catch(d=>{e(d==null?void 0:d.message)}).finally(async()=>{await k.loadAirdrop(i.id),n(!1)})},A=async d=>{if(d.type!=="text/csv"&&!d.name.endsWith(".csv")){e("Invalid file type");return}if(d.size<1e3){e("Minimum 20 wallets");return}if(d.size>104857600){e("Maximum 100 MB");return}await S(d)};return t.jsxs(u,{direction:"column",gap:"16px",children:[r&&t.jsx(ut,{}),!r&&t.jsxs(u,{direction:"column",gap:"24px",children:[t.jsxs(u,{direction:"column",gap:"16px",children:[t.jsx(Q,{checked:o,onChange:()=>I(!o),children:t.jsx(y,{textStyle:"label2",children:"File size more than 100 MB"})}),o?t.jsxs(u,{direction:"column",gap:"12px",children:[t.jsxs(u,{align:"center",direction:"row",gap:"12px",children:[t.jsx(V,{autoComplete:"off",onChange:d=>b(d.target.value),placeholder:"File URL",value:f||""}),t.jsx(w,{flexShrink:0,isDisabled:!f,isLoading:l,onClick:L,children:"Upload File"})]}),!!x&&t.jsx(y,{textStyle:"body2",color:"#F53C36",children:x})]}):t.jsxs(t.Fragment,{children:[t.jsxs(u,{align:"center",direction:"row",gap:"12px",children:[t.jsx(w,{flexShrink:0,isLoading:l,onClick:()=>{e(null),_.current.click()},children:"Upload File"}),!!m&&t.jsxs(u,{direction:"column",flex:1,gap:"4px",children:[t.jsx(u,{flex:1,overflow:"hidden",h:"8px",minH:"8px",borderRadius:"8px",bgColor:"background.contentTint",children:t.jsx(u,{w:`${m}%`,h:"8px",bgColor:"#000"})}),t.jsxs(y,{textStyle:"body3",color:"text.secondary",children:[m,"% of the file uploaded"]})]}),!m&&!!x&&t.jsx(y,{textStyle:"body2",color:"#F53C36",children:x})]}),t.jsx("input",{ref:_,type:"file",accept:".csv",style:{display:"none"},onChange:d=>{var h;(h=d.target.files)!=null&&h.length&&A(d.target.files[0])}})]})]}),t.jsx(pt,{})]})]})},gt=({id:i,airdropStore:l,updateType:n,hideEnableButton:x})=>{const e=l.airdrop$.value,m=l.distributors$.value,p=J(m),[r,c]=s.useState(!1),[o,I]=s.useState(!1),[f,b]=s.useState(!1),[a,C]=s.useState(p),_=Y(),[k]=K(),[g,T]=s.useState(m),[S,L]=s.useState(W(m,p)),A=s.useRef(null),d=async()=>{await l.loadDistributors(i).then(j=>{T(j),$()})};s.useEffect(()=>{(n==="ready"&&a==="ready"||n==="block"&&(a==="block"||a==="withdraw_jetton"||a==="withdraw_ton"))&&(I(!0),(async()=>await l.loadAirdrop(i))())},[a,n]),s.useEffect(()=>{(async()=>await d())()},[]),s.useEffect(()=>(A.current=setInterval(async()=>{await d()},2e3),()=>h()),[g,S,f]);const h=()=>{A.current&&clearInterval(A.current)},$=()=>{const j=J(g),F=W(g,j);L(F),a!==j&&(C(j),b(!1))},D=async()=>{if(a==="waiting"||f)return;const j=W(g,a),F=mt(g,a);if(await ft({admin:e.admin,jetton:e.jetton.address,needTon:(j==null?void 0:j.ton)||0,needJetton:(j==null?void 0:j.jetton)||0,errCb:U=>{_({title:U.title,description:U.text,position:"bottom-left",duration:5e3,status:"error",isClosable:!0})}}))try{await k.sendTransaction({validUntil:Math.floor(new Date().getTime()/1e3+120),messages:F}),x&&x(),b(!0)}catch(U){console.error(U)}};if(e.status==="claim_active"||a==="withdraw_complete")return null;if(o||!g.length||a==="waiting"||!S||e.status==="need_deploy"&&a==="ready")return t.jsx(R,{children:t.jsx(O,{})});if(e.status==="claim_stopped")return t.jsxs(t.Fragment,{children:[t.jsx(w,{isLoading:f,onClick:()=>c(!0),variant:"secondary",children:"Complete Airdrop"}),t.jsx(nt,{isOpen:r,onClose:()=>c(!1),onConfirm:()=>{c(!1),D()},title:"Complete Airdrop?",description:"This action cannot be canceled.",confirmButtonText:"Complete Airdrop"})]});if(e.status==="blocked")return t.jsxs(u,{wrap:"wrap",direction:"row",gap:"16px",children:[a==="withdraw_jetton"&&t.jsxs(w,{isLoading:f,onClick:D,children:["Withdraw ",e.jetton.symbol]}),t.jsx(w,{isDisabled:a==="withdraw_jetton",isLoading:a==="withdraw_ton"&&f,onClick:D,children:"Withdraw TON"})]});let P="Deploy",B=`You need ${v(N.fromNano(S.ton))} TON on your wallet`;return a==="topup"&&(P="Top Up",B=`You need ${v(N.fromNano(S.ton))} TON and ${v(S.jetton/10**parseFloat(e.jetton.decimals))} ${e.jetton.symbol} on your wallet`),t.jsxs(u,{align:"center",direction:"row",gap:"16px",children:[t.jsx(w,{isLoading:f,onClick:D,children:P}),t.jsx(y,{textStyle:"body2",color:"text.secondary",children:B})]})},bt=i=>{const l=i.airdropStore.airdrop$.value,n=Y(),x=X(),e=tt(),{open:m}=et(),[p]=K(),r=()=>{n({title:"Connect Admin Wallet",description:"Please reconnect with admin wallet",position:"bottom-left",duration:5e3,status:"error",isClosable:!0})},c=async()=>{e&&e.account.address!==l.admin&&await p.disconnect(),m()};return s.useEffect(()=>{x&&e&&e.account.address!==l.admin&&r()},[e,x]),!(e!=null&&e.account.address)||e.account.address!==l.admin?t.jsx(w,{flex:1,alignSelf:"flex-start",onClick:c,variant:"primary",children:"Connect Admin Wallet"}):t.jsx(gt,{...i})},M=G(bt),E=i=>t.jsx(st,{flex:"1",minW:"260px",bg:"background.contentTint",children:t.jsxs(u,{direction:"column",px:"16px",py:"12px",children:[t.jsx(y,{textStyle:"label2",color:"text.secondary",children:i.title}),t.jsx(Z,{children:i.text})]})}),wt=({airdrop:i,distributors:l})=>{if(!l.length)return t.jsx(R,{children:t.jsx(O,{})});const n=l.reduce((p,r)=>p+((r==null?void 0:r.completed_claims)||0),0),x=l.reduce((p,r)=>p+parseFloat((r==null?void 0:r.claimed_amount)||"0"),0),e=l.reduce((p,r)=>p+parseFloat((r==null?void 0:r.jetton_balance)||"0"),0),m=l.reduce((p,r)=>p+parseFloat(r.accumulated_commission||"0"),0);return t.jsxs(u,{align:"center",wrap:"wrap",direction:"row",gap:"16px",children:[t.jsx(E,{title:"Number of claims",text:`${v(n)}`}),t.jsx(E,{title:"Claimed Jettons",text:`${v(x/10**parseFloat(i.jetton.decimals))}`}),t.jsx(E,{title:"Remaining Jettons",text:`${v(e/10**parseFloat(i.jetton.decimals))} ${i.jetton.symbol}`}),t.jsx(E,{title:"Profit",text:`${v(N.fromNano(m))} TON`})]})},yt=G(wt),kt=({airdropsStore:i,...l})=>{const{id:n}=ot(),[x,e]=s.useState(!1),[m,p]=s.useState(!0),r=H(),c=s.useMemo(()=>new ht({projectId:r,airdrops:i.airdrops$.value}),[n]),o=c.airdrop$.value,I=c.distributors$.value;s.useEffect(()=>(n&&c.loadAirdrop(n),()=>{c.clearAirdrop()}),[n,c]);const f=async C=>{e(!0),await c.switchClaim(n,C),e(!1)};if(!i.airdrops$.isResolved||!c.airdrop$.isResolved||!n)return t.jsx(R,{h:"300px",children:t.jsx(O,{})});if(!o)return t.jsx(R,{h:"300px",children:t.jsx(y,{children:"Airdrop not found"})});let b="Upload the file with recipients",a="PREPARATION";return o.status==="need_deploy"&&(b="Create and top up distribution smart contracts by clicking the Deploy button."),o.status==="claim_active"&&(b="Airdrop is ready, you can pause claims or complete the distribution.",a="CLAIM ENABLED"),o.status==="claim_stopped"&&(b="Enable users to claim by clicking the Enable Claim button.",a="CLAIM DISABLED"),o.status==="blocked"&&(b="Distribution completed. You can withdraw the accumulated profit and remaining tokens using the Withdraw button.",a="FINISHED"),t.jsxs(at,{display:"flex",flexDirection:"column",px:"0",...l,children:[t.jsxs(u,{align:"flex-start",justify:"space-between",mb:"5",px:"6",children:[t.jsxs(it,{children:[t.jsxs(u,{align:"center",direction:"row",gap:"8px",children:[t.jsx(Z,{mb:"1",children:o.name}),t.jsx(rt,{textStyle:"label3",color:"accent.blue",bgColor:"color-mix(in srgb, currentColor 12%, transparent)",children:a})]}),t.jsx(y,{textStyle:"body2",color:"text.secondary",children:b})]}),t.jsx(lt,{})]}),t.jsx(ct,{mb:"3"}),t.jsxs(u,{align:"flex-start",direction:"row",gap:"16px",px:"6",children:[t.jsxs(u,{direction:"column",gap:"24px",minW:"520px",maxW:"520px",children:[t.jsx(xt,{airdrop:o,id:n,distributors:I}),o.status==="need_file"&&t.jsx(jt,{id:n,airdropStore:c}),o.status==="need_deploy"&&t.jsx(M,{id:n,updateType:"ready",airdropStore:c}),(o.status==="claim_active"||o.status==="claim_stopped")&&t.jsxs(u,{direction:"row",gap:"16px",children:[m&&t.jsx(w,{isLoading:x,onClick:()=>f(o.status==="claim_active"?"disable":"enable"),variant:o.status==="claim_active"?"secondary":void 0,children:o.status==="claim_active"?"Disable Claim":"Enable Claim"}),t.jsx(M,{id:n,updateType:"block",hideEnableButton:()=>p(!1),airdropStore:c})]})]}),o.status!=="need_file"&&o.status!=="need_deploy"&&t.jsxs(u,{direction:"column",gap:"16px",children:[t.jsx(yt,{airdrop:o,distributors:c.distributors$.value}),o.status==="blocked"&&t.jsx(M,{id:n,airdropStore:c}),t.jsxs(u,{wrap:"wrap",direction:"row",gap:"16px",children:[t.jsx(w,{onClick:()=>{window.open(`https://tonkeeper.github.io/airdrop-reference-dapp/?airdropId=${n}&testnet=${dt}`)},variant:"secondary",children:"Test claim"}),t.jsx(w,{onClick:()=>{window.open("https://docs.tonconsole.com/tonconsole/jettons/airdrop","_blank")},children:"Documentation"})]})]})]})]})};export{kt as default};
