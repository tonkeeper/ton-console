import{W as L,an as le,Z as V,ao as A,bB as ce,bC as de,bD as ue,bE as xe,b3 as me,r as d,b4 as he,j as e,ae as P,ax as y,b7 as R,b9 as W,az as q,bF as je,bG as be,bH as pe,bI as _,B as m,o as w,D as ye,F as v,b6 as fe,ba as ge,bJ as ve,bK as Ie,T as I,bL as F,av as z,aA as G,aB as U,aC as Y,aD as J,aE as $,aF as Z,bj as X,aG as K,b,bM as Se,s as ke,v as Ce,w as O,x as f,y as we,z as g,bf as Pe,a0 as Le,aJ as Ee,bN as Me,N as Te,Q as Re,V as qe,R as De,U as Q,bO as Ve,l as ee,C as D,k as Ae,G as Be,O as Ne}from"./index-BCN26Ft_.js";import{D as We}from"./DeleteIcon24-Bd3bueMl.js";import{c as _e}from"./copy-to-clipboard-Ct1_m45i.js";import{a as se}from"./queries-B6tpSeut.js";import{T as Oe}from"./table-container-B5le7CdA.js";import{C as Qe}from"./CreateIcon96-DLe490jy.js";import"./usd-currency-amount-OKdR9Ymz.js";const He=["api-keys"],E=s=>[...He,s];function ie(s){return{name:s.name,value:s.token,creationDate:new Date(s.date_create),limitRps:s.limit_rps,origins:s.origins||void 0,id:s.id,capabilities:s.capabilities??[]}}function Fe(){const s=L();return le({queryKey:E(s),queryFn:async()=>{if(!s)throw new Error("No project selected");const{data:t,error:i}=await xe({query:{project_id:s}});if(i)throw i;return t.items.map(ie)},enabled:!!s})}function ze(){const s=V(),t=L();return A({mutationFn:async i=>{const r=t;if(!r)throw new Error("No project selected");const{data:a,error:l}=await ce({query:{project_id:r},body:{name:i.name,limit_rps:i.limitRps??void 0,origins:i.origins,capabilities:i.capabilities}});if(l)throw l;return a.token?ie(a.token):null},onSuccess:()=>{s.invalidateQueries({queryKey:E(t)})}})}function Ge(){const s=V(),t=L();return A({mutationFn:async i=>{const r=t;if(!r)throw new Error("No project selected");const{error:a}=await de({path:{id:i.id},query:{project_id:r},body:{name:i.name,limit_rps:i.limitRps??void 0,origins:i.origins,capabilities:i.capabilities}});if(a)throw a;return i},onSuccess:()=>{s.invalidateQueries({queryKey:E(t)})}})}function Ue(){const s=V(),t=L();return A({mutationFn:async i=>{const r=t;if(!r)throw new Error("No project selected");const{error:a}=await ue({path:{id:i},query:{project_id:r}});if(a)throw a;return i},onSuccess:()=>{s.invalidateQueries({queryKey:E(t)})}})}const te=({id:s,onSubmit:t,disableDefaultFocus:i,maxLimit:r,...a})=>{const l=c=>{const k=c.useIPLimit?Number(c.ipLimitValue):void 0,C=c.useIPLimit?c.originsValue.split(`
`).filter(oe=>oe!==""):void 0,ae=!c.useIPLimit&&c.availableWebhook?[F.WEBHOOKS]:[];t({name:c.name,limitRps:k,origins:C,capabilities:ae})},{handleSubmit:o,register:u,setFocus:x,control:n,watch:h,getFieldState:p,formState:{errors:j}}=me();d.useEffect(()=>{i||x("name")},[i,x]);const M=h("useIPLimit"),{isDirty:B}=p("useIPLimit");d.useEffect(()=>{B&&x("ipLimitValue")},[M,B]);const{ref:re}=he({mask:Number,scale:1,signed:!1,radix:".",mapToRadix:[","],min:0,max:r}),N=j,S=N.ipLimitValue,T=N.originsValue;return e.jsxs(P.form,{id:s,w:"100%",onSubmit:o(l),noValidate:!0,...a,children:[e.jsxs(y,{mb:"30px",isInvalid:!!j.name,isRequired:!0,children:[e.jsx(R,{htmlFor:"name",children:"Name"}),e.jsx(W,{autoComplete:"off",id:"name",placeholder:"Name",...u("name",{required:"This is required",minLength:{value:3,message:"Minimum length should be 3"},maxLength:{value:64,message:"Maximum length is 64"}})}),e.jsx(q,{children:j.name&&j.name.message})]}),e.jsx(y,{isInvalid:!!j.useIPLimit,isRequired:!0,children:e.jsx(je,{name:"useIPLimit",control:n,render:({field:c})=>e.jsxs(be,{...pe(c),children:[e.jsxs(_,{alignItems:"flex-start",mb:"6",value:"false",variant:"withDescription",children:[e.jsxs(m,{textStyle:"label2",mb:"0.5",children:["Unlimited:"," ",e.jsx(w,{color:"text.secondary",textStyle:"body2",children:"Suitable for backend and scripts"})]}),e.jsx(m,{textStyle:"body2",color:"text.secondary",children:"This key has no inherent limitations and is determined solely by your plan. It is recommended to utilize this key exclusively in back-end services and avoid exposing it in client-side code."})]}),e.jsxs(_,{alignItems:"flex-start",value:"true",variant:"withDescription",children:[e.jsxs(m,{textStyle:"label2",mb:"0.5",children:["Limited by IP:"," ",e.jsx(w,{color:"text.secondary",textStyle:"body2",children:"Suitable for frontend"})]}),e.jsx(m,{textStyle:"body2",color:"text.secondary",children:"This key is subject to additional restrictions based on the number of requests allowed per device (per IP). These keys can be safely published or utilized in the client side of your software."})]})]})})}),e.jsx(ye,{}),M&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{isInvalid:!!S,isRequired:!0,children:[e.jsxs(v,{align:"center",children:[e.jsx(R,{sx:{mb:"0 !important"},mr:"1.5",htmlFor:"ipLimitValue",children:e.jsx(w,{textStyle:"label2",children:"Request Per Second"})}),e.jsxs(m,{textStyle:"body2",mr:"4",color:"text.secondary",children:["min - 0.1, max - ",r]}),e.jsx(W,{w:"70px",autoComplete:"off",id:"ipLimitValue",placeholder:"1",...(()=>{const{ref:c,...k}=u("ipLimitValue",{required:"This is required",validate(C){if(!fe(C.toString()))return"Limit should be valid number";if(C<.1)return"Limit must be greater then 0.1"}});return{ref:ge(c,re),...k}})()})]}),e.jsx(q,{children:S&&S.message})]}),e.jsxs(y,{isInvalid:!!T,children:[e.jsxs(v,{align:"center",children:[e.jsxs(m,{minW:"160px",children:[e.jsx(R,{sx:{mb:"0 !important"},mr:"1.5",htmlFor:"originsValue",children:e.jsx(w,{textStyle:"label2",children:"Origins"})}),e.jsxs(m,{textStyle:"body2",mr:"4",color:"text.secondary",children:["Allow requests from",e.jsx("br",{}),"these sites only"]})]}),e.jsx(ve,{minH:65,autoComplete:"off",id:"originsValue",placeholder:`http://example.com
Enter up to 20 values (each on a new line)`,rows:2,...u("originsValue",{validate(c){if(c.split(`
`).length>20)return"Maximum number of origins is 20"}})})]}),e.jsx(q,{children:T&&T.message})]})]}),!M&&e.jsx(y,{mt:"4",mb:"0",isInvalid:!!S,isRequired:!0,children:e.jsx(Ie,{size:"sm",...u("availableWebhook"),children:e.jsx(I,{textStyle:"label2",children:"Allow webhook management"})})})]})};function H(s){return(s==null?void 0:s.limitRps)!=null?{name:s==null?void 0:s.name,useIPLimit:!0,ipLimitValue:s.limitRps,originsValue:s.origins?s.origins.join(`
`):""}:{name:s==null?void 0:s.name,useIPLimit:!1,availableWebhook:(s==null?void 0:s.capabilities.includes(F.WEBHOOKS))??!1}}const ne=({isOpen:s,onClose:t})=>{const i="create-api-key-form",{mutate:r,isPending:a}=ze(),l=z(),{reset:o,formState:{isDirty:u}}=l,x=d.useCallback(p=>{r(p,{onSuccess:()=>{o(),t()}})},[r,t,o]);d.useEffect(()=>{s||setTimeout(o,200)},[o,s]);const{data:n}=se(),h=(n==null?void 0:n.rps)??1;return e.jsxs(G,{isOpen:s,onClose:t,scrollBehavior:"inside",children:[e.jsx(U,{}),e.jsxs(Y,{children:[e.jsx(J,{children:"New API key"}),e.jsx($,{}),e.jsx(Z,{children:e.jsx(X,{...l,children:e.jsx(te,{id:i,maxLimit:h,onSubmit:x})})}),e.jsxs(K,{gap:"3",children:[e.jsx(b,{flex:1,onClick:t,variant:"secondary",children:"Cancel"}),e.jsx(b,{flex:1,form:i,isDisabled:!u,isLoading:a,type:"submit",variant:"primary",children:"Create"})]})]})]})},Ye=({apiKey:s,onClose:t,...i})=>{const r="create-api-key-form",{mutate:a,isPending:l}=Ge(),o=z({defaultValues:H(s)});d.useEffect(()=>{o.reset(H(s))},[s,o]);const{reset:u,formState:{isDirty:x}}=o,n=d.useCallback(j=>{s&&a({id:s.id,...j},{onSuccess:()=>{u(),t()}})},[s,a,t,u]),{data:h}=se(),p=(h==null?void 0:h.rps)??1;return e.jsxs(G,{onClose:t,scrollBehavior:"inside",...i,children:[e.jsx(U,{}),e.jsxs(Y,{children:[e.jsx(J,{children:"Edit API Key"}),e.jsx($,{}),e.jsx(Z,{children:e.jsx(X,{...o,children:e.jsx(te,{onSubmit:n,id:r,maxLimit:p})})}),e.jsxs(K,{gap:"3",children:[e.jsx(b,{flex:1,onClick:t,variant:"secondary",children:"Cancel"}),e.jsx(b,{flex:1,form:r,isDisabled:!x,isLoading:l,type:"submit",variant:"primary",children:"Save"})]})]})]})},Je=({apiKey:s,isOpen:t,onClose:i})=>{const{mutate:r,isPending:a}=Ue(),l=d.useCallback(()=>{s&&r(s.id,{onSuccess:()=>{i()}})},[s,i,r]);return e.jsx(Se,{isOpen:t,onClose:i,onConfirm:l,title:o=>`Delete ${o}`,description:o=>e.jsx(e.Fragment,{children:e.jsxs(I,{textStyle:"text.body2",mb:"6",color:"text.secondary",children:["This action cannot be canceled. To confirm, type ",e.jsx("b",{children:o})," in the box below."]})}),confirmValue:s.name,confirmButtonText:"Delete",isLoading:a})},$e=({apiKeys:s,...t})=>{const[i,r]=d.useState(),[a,l]=d.useState();d.useEffect(()=>{if(a!==void 0){const n=setTimeout(()=>l(void 0),1500);return()=>clearTimeout(n)}},[a]);const o=d.useCallback(n=>{r({key:n,action:"edit"})},[]),u=d.useCallback(n=>{r({key:n,action:"delete"})},[]),x=d.useCallback(()=>{r(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{border:"1px",borderColor:"background.contentTint",borderRadius:"sm",...t,children:e.jsxs(ke,{variant:"simple",children:[e.jsx(Ce,{children:e.jsxs(O,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"API Key"}),e.jsx(f,{children:"Capabilities"}),e.jsx(f,{children:"Limit"}),e.jsx(f,{w:"100%",textAlign:"right",children:e.jsx(P.span,{pr:"34px",children:"Created"})})]})}),e.jsx(we,{children:s.map(n=>e.jsxs(O,{children:[e.jsx(g,{overflow:"hidden",maxW:"200px",children:e.jsx(Pe,{host:e.jsx(m,{layerStyle:"textEllipse",w:"fit-content",maxW:"100%",children:n.name}),offset:[-16,8],placement:"bottom-start",children:n.name})}),e.jsx(g,{overflow:"hidden",w:"100%",maxW:"0",children:e.jsxs(v,{align:"center",gap:"1",children:[e.jsx(P.span,{flexShrink:"1",layerStyle:"textEllipse",children:n.value}),a!==void 0&&a===n.id?e.jsx(Le,{}):e.jsx(Ee,{"aria-label":"copy",icon:e.jsx(Me,{}),onClick:()=>{l(n.id),_e(n.value)}})]})}),e.jsx(g,{children:n.capabilities.join(", ")||"-"}),e.jsx(g,{children:n.limitRps===void 0?"Unlimited":`IP - ${n.limitRps} RPS`}),e.jsx(g,{children:e.jsxs(v,{align:"center",justify:"flex-end",gap:"4",children:[e.jsx(P.span,{color:"text.secondary",children:n.creationDate.toDateString()}),e.jsxs(Te,{placement:"bottom-end",children:[e.jsx(Re,{icon:e.jsx(qe,{})}),e.jsxs(De,{w:"132px",children:[e.jsxs(Q,{onClick:()=>o(n),children:[e.jsx(Ve,{mr:"2"}),e.jsx(I,{textStyle:"label2",fontFamily:"body",children:"Edit"})]}),e.jsxs(Q,{onClick:()=>u(n),children:[e.jsx(We,{mr:"2"}),e.jsx(I,{textStyle:"label2",fontFamily:"body",children:"Delete"})]})]})]})]})})]},n.id))})]})}),i&&e.jsx(Ye,{isOpen:(i==null?void 0:i.action)==="edit",apiKey:i==null?void 0:i.key,onClose:x}),i&&e.jsx(Je,{isOpen:(i==null?void 0:i.action)==="delete",apiKey:i==null?void 0:i.key,onClose:x})]})},Ze=()=>{const{isOpen:s,onClose:t,onOpen:i}=ee();return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsxs(v,{align:"center",direction:"column",maxW:"512px",children:[e.jsx(Qe,{mb:"8"}),e.jsx(Ae,{mb:"2",children:"Your API keys will be shown here"}),e.jsx(I,{textStyle:"body2",mb:"6",color:"text.secondary",children:"Create your first API key"}),e.jsx(b,{onClick:i,children:"Create API key"})]})}),e.jsx(ne,{isOpen:s,onClose:t})]})},Xe=()=>{const{data:s,isLoading:t,error:i}=Fe(),{isOpen:r,onOpen:a,onClose:l}=ee();return t?e.jsx(D,{h:"300px",children:e.jsx(Be,{})}):i?e.jsx(D,{h:"300px",children:e.jsx("span",{children:"Error loading API keys"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{h:"fit-content",children:!s||s.length===0?e.jsx(Ze,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{mb:"6",onClick:a,variant:"secondary",children:"Create API key"}),e.jsx($e,{apiKeys:s})]})}),e.jsx(ne,{isOpen:r,onClose:l})]})},as=()=>e.jsx(Xe,{});export{as as default};
