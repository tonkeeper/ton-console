import{l as Y,m as q,n as ee,t as P,j as e,O as L,B as g,F as j,T as m,f as te,S as h,o as E,b as k,D as U,p as N,R as ne,U as se,r as l,q as Q,s as oe,v as re,w as ie,x as ae,y as ce,z as le,A as xe,G as D,J as M,K as de,L as S,M as pe,N as ue,Q as me,C as V,V as G,W as he,X as ge,Y as ye,Z as je,_ as be,$ as fe,a0 as Se,a1 as we,a2 as H,k as Te,a3 as _e}from"./index--6gyeIm1.js";import{u as Ce}from"./queries-Dkadx4GS.js";import{u as Fe}from"./queries-bGH_afm3.js";import{e as ve}from"./explorer-CZ4ocQ7V.js";import{V as Ae}from"./VerticalDotsIcon16-RC_uRROt.js";import{S as Re}from"./select-Cj-VCuG8.js";const Pe=()=>{var d,b;const{isOpen:t,onClose:n,onOpen:s}=Y(),{data:o,isLoading:r}=q(),{data:i}=ee(),a=o?Number(P(o.usdt.amount,6)):0,c=o?Number(P(o.usdt.promo_amount,6)):0,x=o?Number(P(((d=o.ton)==null?void 0:d.amount)||0,9)):0,p=x&&i?x*i:0,u=o?Number(P(((b=o.ton)==null?void 0:b.promo_amount)||0,9)):0,f=u&&i?u*i:0,w=x+u,_=(o==null?void 0:o.total)!==void 0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(o==null?void 0:o.total):null;return e.jsxs(e.Fragment,{children:[e.jsx(L,{h:"100%",p:0,display:"flex",flexDirection:"column",flex:"1",minW:"330px",children:e.jsxs(g,{children:[e.jsxs(j,{align:"center",justify:"space-between",px:"6",py:"5",children:[e.jsxs(g,{children:[e.jsx(m,{textStyle:"body2",mb:"1",color:"text.secondary",children:"Total Balance"}),e.jsx(te,{display:"flex",alignItems:"center",gap:"2",children:r||(o==null?void 0:o.total)===void 0?e.jsx(h,{w:"200px",h:"10"}):e.jsx(E,{title:o==null?void 0:o.total.toString(),children:_})})]}),e.jsx(k,{onClick:s,size:"sm",variant:"secondary",children:"Refill"})]}),e.jsx(U,{}),e.jsxs(j,{wrap:"wrap",rowGap:"2",columnGap:"3",px:"6",pt:"3",pb:"5",children:[e.jsxs(g,{minW:"170px",children:[e.jsxs(j,{children:[e.jsx(m,{textStyle:"body2",minW:"80px",mb:"1",color:"text.secondary",children:"Balance"}),r?e.jsx(h,{w:"80px",h:"5"}):e.jsxs(m,{textStyle:"body2",title:a.toString(),children:[a.toFixed(2)," USDT"]})]}),e.jsxs(j,{children:[e.jsxs(j,{align:"center",gap:"1",minW:"80px",mb:"1",children:[e.jsx(m,{textStyle:"body2",color:"text.secondary",children:"Promo"}),e.jsx(N,{children:"Apply promo codes to get bonus balance"})]}),r?e.jsx(h,{w:"80px",h:"5"}):e.jsxs(m,{textStyle:"body2",title:c.toString(),children:[c.toFixed(2)," USDT"]})]})]}),w>0&&e.jsxs(g,{flex:"1",children:[e.jsxs(j,{children:[e.jsx(m,{textStyle:"body2",minW:"110px",mb:"1",color:"text.secondary",children:"TON Balance"}),r?e.jsx(h,{w:"150px",h:"5"}):e.jsxs(m,{textStyle:"body2",whiteSpace:"nowrap",title:x.toString(),children:[x.toFixed(2)," TON"," ",e.jsxs(E,{color:"text.secondary",children:["≈ $",p.toFixed(2)]})]})]}),e.jsxs(j,{children:[e.jsxs(j,{align:"center",gap:"1",minW:"110px",mb:"1",children:[e.jsx(m,{textStyle:"body2",color:"text.secondary",children:"TON Promo"}),e.jsx(N,{children:"Apply promo codes to get bonus balance"})]}),r?e.jsx(h,{w:"150px",h:"5"}):e.jsxs(m,{textStyle:"body2",whiteSpace:"nowrap",title:u.toString(),children:[u.toFixed(2)," TON"," ",e.jsxs(E,{color:"text.secondary",children:["≈ $",f.toFixed(2)]})]})]})]})]})]})}),e.jsx(ne,{isOpen:t,onClose:n})]})};function ke(){const{data:t,isLoading:n,error:s}=Fe(),{data:o,isLoading:r,error:i}=Ce(),a=n||r;return{data:{restApi:s?null:De(t??null),liteproxy:i?null:Ie(o??null)},isLoading:a}}function De(t){return t?{id:`tonapi-${t.id}`,plan:`REST API «${t.name}»`,interval:t.type,renewsDate:t.renewsDate,price:t.price}:null}function Ie(t){if(!t)return null;const n=t.name!=="Free"&&t.next_payment?new Date(t.next_payment):void 0;return{id:`liteproxy-${t.id}`,plan:`Liteservers «${t.name}»`,interval:"Monthly",renewsDate:n,price:new se(t.usd_price)}}const B=500,z=Math.ceil(1e3/3),Ee=["Transaction ID","Created At (ISO)","Type","Reason","Description","Signed Amount","Currency","Metadata"],Me=t=>new Promise(n=>setTimeout(n,t)),He=t=>`"${String(t??"").replace(/"/g,'""')}"`,W=t=>t.map(He).join(","),Le=t=>{const n=t.amount.toStringAmount({decimalPlaces:null,thousandSeparators:!1}),s=t.type==="charge"?"-":"+",o=t.info.reason??"",{reason:r,...i}=t.info,a=Object.keys(i).length>0?JSON.stringify(i):"";return[t.id,t.date.toISOString(),t.type,o,t.description,`${s}${n}`,t.amount.stringCurrency,a]},Ne=t=>{const n=W([...Ee]),s=t.map(o=>W(Le(o)));return[n,...s].join(`
`)},Be=(t,n)=>{const s=new Date().toISOString().replace(/:/g,"-");return`ton-console-billing-history-${t.replace(/[^a-zA-Z0-9-_]/g,"-").toLowerCase()}-${n}-${s}.csv`},ze=(t,n)=>{const s=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)};function We(){const[t,n]=l.useState(!1),[s,o]=l.useState(0),r=Q(),i=oe(),a=re(),c=l.useRef(!0);l.useEffect(()=>()=>{c.current=!1},[]);const x=l.useCallback(async()=>{if(!r||t)return;n(!0),o(0);const p=[];let u,f=0;try{for(;;){const b=Date.now();if(f){const C=b-f;C<z&&await Me(z-C)}f=Date.now();const{data:v,error:R}=await ie({path:{id:r},query:{before_tx:u,limit:B}});if(R)throw R;const T=v.history;if(!T.length)break;const I=T.map(ae);if(p.push(...I),o(C=>C+T.length),T.length<B)break;u=T[T.length-1].id}const w=Ne(p),_=(i==null?void 0:i.name)||"unknown",d=Be(_,r);ze(w,d),c.current&&a({title:"Billing history exported",status:"success",duration:4e3,isClosable:!0})}catch(w){const _=w instanceof Error?w.message:"Unknown error";c.current&&a({title:"Failed to export billing history",description:_,status:"error",duration:6e3,isClosable:!0})}finally{n(!1)}},[r,t,a]);return{isExporting:t,exportedCount:s,exportFullHistory:x}}const A=l.createContext({billingHistory:[],rowHeight:"48px"}),Oe=ce(({children:t,...n},s)=>{var p;const{rowHeight:o,isLoading:r,hasEverLoaded:i,skeletonRowCount:a}=l.useContext(A),c=l.useRef(null),x=(p=c.current)==null?void 0:p.clientWidth;return e.jsxs(le,{ref:s,sx:{borderCollapse:"separate",borderSpacing:"0"},w:"100%",variant:"withBottomBorder",...n,children:[e.jsx(xe,{children:e.jsxs(D,{sx:{th:{px:2,zIndex:2},"&::after":{content:'""',display:"block",position:"absolute",left:0,right:0,top:0,height:o,background:"white"}},pos:"sticky",zIndex:"4",top:"0",left:"0",w:"100%",h:o,children:[e.jsx(M,{pos:"relative",zIndex:1,minW:"150px",bg:"background.contentTint",borderTop:"1px",borderTopColor:"background.contentTint",borderLeft:"1px",borderLeftColor:"background.contentTint",borderTopLeftRadius:"sm",boxSizing:"content-box",children:"History"}),e.jsx(M,{pos:"relative",zIndex:1,w:"100%",minW:"320px",bg:"background.contentTint",boxSizing:"content-box",children:"Action"}),e.jsx(M,{pos:"relative",zIndex:1,w:"180px",minW:"180px",bg:"background.contentTint",borderTop:"1px",borderTopColor:"background.contentTint",borderRight:"1px",borderRightColor:"background.contentTint",borderTopRightRadius:"sm",children:"Amount"})]})}),e.jsx(de,{ref:c,sx:{tr:{minWidth:`${x||0}px`}},children:r&&i?Array.from({length:a||1}).map((u,f)=>e.jsxs(D,{h:o,children:[e.jsx(S,{px:"2",boxSizing:"content-box",children:e.jsx(h,{h:"4"})}),e.jsx(S,{px:"2",boxSizing:"content-box",children:e.jsx(h,{h:"4"})}),e.jsx(S,{px:"2",boxSizing:"content-box",children:e.jsx(h,{h:"4"})})]},f)):t})]})}),$e={TonapiMonthlyPaymentMeta:"tonapi_monthly_payment",TonapiInstantPaymentMeta:"tonapi_instant_payment",TonapiChangeTierMeta:"tonapi_change_tier",LiteproxyMonthlyPaymentMeta:"liteproxy_monthly_payment",LiteproxyChangeTierMeta:"liteproxy_change_tier",TestnetTonsPurchaseMeta:"testnet_tons_purchase",CnftIndexingPaymentMeta:"cnft_indexing_payment",MessagePackagePurchaseMeta:"message_package_purchase",ChatGptRequestPaymentMeta:"chatgpt_request_payment",PromoCodeActivationMeta:"promo_code_activation",StreamingApiPaymentMeta:"streaming_api_payment",ReplenishmentOfDepositMeta:"replenishment_of_deposit",AnalyticsRequestPaymentMeta:"analytics_request_payment",OtherMeta:"Default"};Object.fromEntries(Object.entries($e).map(([t,n])=>[n,t]));const O={tonapi_monthly_payment:t=>{var o;const s=(o=t.tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["REST API monthly payment",s&&e.jsxs(e.Fragment,{children:["— ",e.jsx("strong",{children:s})]})]})},tonapi_instant_payment:t=>{var o;const s=(o=t.tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["REST API payment",s&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:s})]})]})},tonapi_change_tier:t=>{var o;const s=(o=t.new_tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["REST API tier change",s&&e.jsxs(e.Fragment,{children:[" ",e.jsx("strong",{children:s})]})]})},liteproxy_monthly_payment:t=>{var o;const s=(o=t.tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["Liteservers monthly payment",s&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:s})]})]})},liteproxy_change_tier:t=>{var o;const s=(o=t.new_tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["Liteservers tier change",s&&e.jsxs(e.Fragment,{children:[" ","→ ",e.jsx("strong",{children:s})]})]})},testnet_tons_purchase:t=>{const n=t;return e.jsxs(e.Fragment,{children:["Testnet coins purchase",n.testnet_coins&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsxs("strong",{children:[new me(n.testnet_coins).toStringCurrencyAmount()," coins"]})]})]})},cnft_indexing_payment:t=>{const n=t;return e.jsxs(e.Fragment,{children:["NFT indexing",n.collection&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:n.collection})]}),n.count&&e.jsxs(e.Fragment,{children:[" ",e.jsxs("strong",{children:["(",n.count," items)"]})]})]})},message_package_purchase:t=>{const n=t;return e.jsxs(e.Fragment,{children:["Message package",n.count&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsxs("strong",{children:[n.count," messages"]})]})]})},chatgpt_request_payment:()=>e.jsx(e.Fragment,{children:"ChatGPT API request"}),promo_code_activation:t=>{const n=t;return e.jsxs(e.Fragment,{children:["Promo code activation",n.promo_code&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:n.promo_code})]})]})},streaming_api_payment:t=>{const n=t;if(!n.period)return e.jsx(e.Fragment,{children:"Webhooks API payment"});const s=Math.round(n.period/60),o=Math.round(s/60),r=s>=60?`${o}h`:`${s}m`;return e.jsxs(e.Fragment,{children:["Webhooks API payment — ",e.jsx("strong",{children:r})]})},replenishment_of_deposit:t=>{const{tx_hash:n}=t;return e.jsxs(e.Fragment,{children:["Refill "," ",n&&e.jsx(ue,{href:ve.transactionLink(n),isExternal:!0,children:n.slice(-8)})]})},analytics_request_payment:()=>e.jsx(e.Fragment,{children:"Analytics query"}),Default:(t,n)=>e.jsx(e.Fragment,{children:n})};function qe(t){const{info:n,description:s}=t,o=n.reason in O?n.reason:"Default",r=O[o];return r(n,s)}const Ue=({style:{top:t,...n}})=>{const{rowHeight:s}=l.useContext(A);return e.jsxs(D,{sx:{td:{px:2,py:0}},pos:"absolute",top:parseFloat(t.toString())+parseFloat(s)+"px",left:"0",display:"table-row",w:"100%",h:s,maxH:s,style:n,children:[e.jsx(S,{minW:"150px",h:s,maxH:s,borderLeft:"1px",borderLeftColor:"background.contentTint",boxSizing:"content-box",children:e.jsx(h,{w:"120px",h:"4"})}),e.jsx(S,{w:"100%",minW:"320px",h:s,maxH:s,boxSizing:"content-box",children:e.jsx(h,{w:"200px",h:"4"})}),e.jsx(S,{w:"180px",minW:"180px",h:s,maxH:s,borderRight:"1px",borderRightColor:"background.contentTint",children:e.jsx(h,{w:"100px",h:"4"})})]})},Qe={charge:"text.primary",deposit:"accent.green"},Ve={charge:"-",deposit:"+"},Ge=({historyItem:t,style:n})=>{const{rowHeight:s}=l.useContext(A);return e.jsxs(D,{sx:{td:{px:2,py:0}},pos:"absolute",top:parseFloat(n.top.toString())+parseFloat(s)+"px",left:"0",display:"table-row",w:"100%",h:s,maxH:s,children:[e.jsx(S,{minW:"150px",h:s,maxH:s,borderLeft:"1px",borderLeftColor:"background.contentTint",boxSizing:"content-box",children:pe(t.date)}),e.jsx(S,{w:"100%",minW:"320px",h:s,maxH:s,boxSizing:"content-box",children:qe(t)}),e.jsxs(S,{w:"180px",minW:"180px",h:s,maxH:s,color:Qe[t.type]??"text.accent",borderRight:"1px",borderRightColor:"background.contentTint",title:t.amount.stringAmountWithoutRound,children:[Ve[t.type],t.amount.stringCurrencyAmount]})]})},Ke=({index:t,style:n})=>{const{billingHistory:s,isLoading:o}=l.useContext(A);if(o||!s||!s[t])return e.jsx(Ue,{style:n});const r=s[t];return e.jsx(Ge,{style:n,historyItem:r},r.id)},Ze=({billingHistory:t,isLoading:n=!1,hasEverLoaded:s=!1,skeletonRowCount:o=1,hasBillingHistory:r=void 0,...i})=>{const a=r??t.length>0,c="48px";if(!s&&n)return e.jsx(V,{h:"96px",children:e.jsx(G,{})});if(!n&&!a)return e.jsx(g,{h:"96px",py:"10",color:"text.secondary",textAlign:"center",children:"No billing history yet"});const x=n&&s?o:t.length,p=Math.min(parseInt(c)*(x+1)+6,800)+"px",u=Math.min(parseInt(c)*(x+1)+6,800);return e.jsx(A.Provider,{value:{billingHistory:t,rowHeight:c,isLoading:n,hasEverLoaded:s,skeletonRowCount:o},children:e.jsx(g,{minH:p,...i,children:e.jsx(he,{height:u,width:"100%",itemCount:x,itemSize:parseInt(c),innerElementType:Oe,children:Ke})})})},Je=t=>{switch(t){case"month":return"Monthly";case"pay_as_you_go":return"Pay as you go";default:return t}},$=({subscription:t})=>{const n=ge();return e.jsxs(j,{justify:"space-between",gap:"4",py:"1",children:[e.jsx(j,{direction:"column",flex:"1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(m,{fontSize:"sm",fontWeight:"semibold",children:t.plan}),e.jsxs(m,{color:"text.secondary",fontSize:"sm",children:[Je(t.interval),t.renewsDate&&` · Renews ${ye(t.renewsDate)}`]})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{w:"150px",h:"5"}),e.jsx(h,{w:"200px",h:"4"})]})}),e.jsx(g,{gap:"1",children:t?e.jsxs(j,{align:"center",children:[e.jsx(m,{fontSize:"md",fontWeight:"semibold",children:t.price.stringCurrencyAmount}),e.jsxs(je,{placement:"bottom-end",children:[e.jsx(be,{"aria-label":"options",icon:e.jsx(Ae,{}),ml:"2"}),e.jsx(fe,{w:"132px",children:e.jsx(Se,{onClick:()=>n("/tonapi/pricing"),children:e.jsx(m,{textStyle:"label2",children:"Change plan"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{w:"80px",h:"5"}),e.jsx(g,{w:"24px"})]})})]})},Xe=({subscriptions:t,isLoading:n=!1,...s})=>{if(n)return e.jsx(V,{h:"96px",children:e.jsx(G,{})});const{restApi:o,liteproxy:r}=t||{restApi:null,liteproxy:null};if(!n&&!!!(r||o))return e.jsx(g,{h:"96px",py:"10",color:"text.secondary",textAlign:"center",children:"No active plans yet"});const a=!n&&o&&r;return e.jsxs(g,{minH:"100px",...s,children:[o&&e.jsx($,{subscription:o}),a&&e.jsx(U,{}),r&&e.jsx($,{subscription:r})]})},Ye=()=>{const{data:t,isLoading:n}=ke();return e.jsx(L,{height:"auto",p:"0",display:"flex",flexDirection:"column",flex:"1",minW:"330px",children:e.jsxs(g,{px:"6",py:"5",children:[e.jsx(m,{mb:"2",fontSize:"lg",fontWeight:"semibold",children:"Active Plans"}),e.jsx(Xe,{subscriptions:t,isLoading:n})]})})},et=10,tt=[10,20,50,100],nt=()=>{const[t,n]=l.useState(!1),[s,o]=l.useState(et),[r,i]=l.useState(1),[a,c]=l.useState([]),[x,p]=l.useState(void 0),u=Q(),{isExporting:f,exportedCount:w,exportFullHistory:_}=We(),{data:d=[],isLoading:b}=we({before_tx:x,limit:s}),v=d.length>0;l.useEffect(()=>{c([]),p(void 0),i(1)},[u]),l.useEffect(()=>{!b&&v&&d&&n(!0)},[b,v,d==null?void 0:d.length]);const R=s,T=d.length===s,I=a.length>0,C=()=>{if(d.length>0){const y=d[d.length-1].id;c(F=>[...F,x??""]),p(y),i(F=>F+1)}},K=()=>{if(a.length>0){const y=[...a],F=y.pop();c(y),p(F===""?void 0:F),i(X=>X-1)}},Z=y=>{o(y),c([]),p(void 0),i(1)},J=async()=>{await _()};return e.jsxs(g,{px:"6",py:"5",children:[e.jsxs(H,{align:"center",justify:"space-between",mb:"5",children:[e.jsx(Te,{m:"0",children:"Billing History"}),e.jsx(k,{isDisabled:!u||f,onClick:J,size:"sm",variant:"secondary",children:f?`Exporting (${w})...`:"Download CSV"})]}),e.jsx(Ze,{billingHistory:d,isLoading:b,hasEverLoaded:t,skeletonRowCount:R,hasBillingHistory:v}),t&&e.jsxs(H,{justify:"space-between",gap:"4",mt:"2",children:[e.jsx(Re,{w:"auto",maxW:"100px",isDisabled:b,onChange:y=>Z(Number(y.target.value)),size:"sm",value:s,children:tt.map(y=>e.jsxs("option",{value:y,children:[y," rows"]},y))}),e.jsxs(H,{gap:"2",children:[e.jsx(k,{isDisabled:!I||b,onClick:K,size:"sm",variant:"secondary",children:"Previous"}),e.jsxs(g,{minW:"65px",color:"text.secondary",fontSize:"sm",textAlign:"center",children:["Page ",r]}),e.jsx(k,{isDisabled:!T||b,onClick:C,size:"sm",variant:"secondary",children:"Next"})]})]})]})},lt=()=>{const t=_e(),{data:n}=q();return l.useEffect(()=>{t.refetchQueries({queryKey:["billing-history"]}),t.refetchQueries({queryKey:["rest-api-selected-tier"]}),t.refetchQueries({queryKey:["liteproxy-selected-tier"]})},[n==null?void 0:n.total,t]),e.jsxs(e.Fragment,{children:[e.jsxs(j,{align:"stretch",wrap:"wrap",gap:4,mb:4,children:[e.jsx(Pe,{}),e.jsx(Ye,{})]}),e.jsx(L,{h:"fit-content",p:"0",display:"flex",flexDirection:"column",children:e.jsx(nt,{})})]})};export{lt as default};
