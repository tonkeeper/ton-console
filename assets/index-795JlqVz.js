import{an as se,Z as _,ap as J,ao as T,b_ as M,bd as b,dA as W,d2 as xe,dC as he,b3 as me,j as e,ae as fe,dw as ae,r as m,B as ee,F as k,dD as pe,T as j,aJ as ye,bO as be,D as oe,aM as Z,bg as te,b as p,t as ie,bM as ge,aA as F,aB as D,aC as P,aD as R,aE as V,aF as q,ax as v,b9 as z,dt as B,aG as L,av as je,bj as we,bz as re,b7 as X,o as Ce,b8 as Se,bb as ke,az as le,b4 as Me,bc as ve,dE as Ee,du as Ie,dn as Oe,O as H,G as Be,k as ne,dx as _e}from"./index-BCN26Ft_.js";import{C as Je,a as Te,b as Fe,c as De}from"./LogoControl-Ctn0l0eO.js";import{L as Pe}from"./list-D2sr8y6t.js";const g={all:()=>["jetton"],info:t=>[...g.all(),"info",t],wallet:(t,a)=>[...g.all(),"wallet",t,a]};async function E(t){const a=await W.jettons.getJettonInfo(t).catch(o=>{if(o.status===404)return null;throw o});if(!a)return null;const s=await W.blockchain.execGetMethodForBlockchainAccount(t,"get_jetton_data").then(o=>o.decoded.jetton_content).then(o=>b.Cell.fromBoc(xe.from(o,"hex"))).then(async o=>{const i=o.pop();return i&&await he(i)}).then(o=>o==null?void 0:o.metadata).catch(()=>null),n={name:s==null?void 0:s.name,symbol:s==null?void 0:s.symbol,decimals:s==null?void 0:s.decimals,image:s==null?void 0:s.image,description:s==null?void 0:s.description};return{...a,metadata:{...a.metadata,...n}}}async function Re(t,a){return W.accounts.getAccountJettonBalance(a,t).catch(s=>{if(s.status===404)return null;throw s})}function Ve(t){return se({queryKey:g.info((t==null?void 0:t.toString())??null),queryFn:async()=>t?E(t):null,enabled:!!t,staleTime:5*60*1e3})}function qe(t,a){return se({queryKey:g.wallet((t==null?void 0:t.toString())??null,(a==null?void 0:a.toString())??null),queryFn:async()=>!t||!a?null:Re(t,a),enabled:!!t&&!!a,staleTime:5*60*1e3})}function ze(t){return new Promise(a=>setTimeout(a,t))}async function N(t,a,s=25,n=3e3){for(let o=0;o<s;o++){await ze(n);const i=await t();if(a(i))return}throw new Error("Blockchain change confirmation timeout (75s)")}function Le(t){const a=_(),{toast:s}=J();return T({mutationFn:async({amount:n,connectedWalletAddress:o,tonConnection:i,jettonWallet:u})=>{if(!t)throw new Error("Jetton address is not set");const{mintBody:h}=await M(async()=>{const{mintBody:x}=await import("./index-BCN26Ft_.js").then(d=>d.dO);return{mintBody:x}},[]),r=async()=>E(t).then(x=>x?BigInt(x.totalSupply):null),c=await r();if(!c)throw new Error("Jetton does not exist");const l={validUntil:Date.now()+5*60*1e3,messages:[{address:t.toString(),amount:b.toNano(.031).toString(),stateInit:void 0,payload:h(o,n,b.toNano(.02),0n).toBoc().toString("base64")}]};return await i.sendTransaction(l),await N(r,x=>x===c+n),{jettonAddress:t}},onSuccess:n=>{n.jettonAddress&&a.invalidateQueries({queryKey:g.info(n.jettonAddress.toString())}),s({title:"Success",description:"Jetton minted successfully",status:"success",duration:5e3,isClosable:!0})},onError:()=>{s({title:"Tracking lost",description:"Unknown tracking error happened",status:"warning",duration:5e3,isClosable:!0})}})}function Ne(t){const a=_(),{toast:s}=J();return T({mutationFn:async({amount:n,connectedWalletAddress:o,tonConnection:i,jettonWallet:u})=>{if(!t)throw new Error("Jetton address is not set");const{burnBody:h}=await M(async()=>{const{burnBody:d}=await import("./index-BCN26Ft_.js").then(y=>y.dO);return{burnBody:d}},[]),r=async()=>E(t).then(d=>d?BigInt(d.totalSupply):null),c=await r();if(!c)throw new Error("Jetton does not exist");const l=u.walletAddress.address,x={validUntil:Date.now()+5*60*1e3,messages:[{address:l.toString(),amount:b.toNano(.031).toString(),stateInit:void 0,payload:h(n,o).toBoc().toString("base64")}]};return await i.sendTransaction(x),await N(r,d=>d===c-n),{jettonAddress:t}},onSuccess:n=>{n.jettonAddress&&a.invalidateQueries({queryKey:g.info(n.jettonAddress.toString())}),s({title:"Success",description:"Jetton burned successfully",status:"success",duration:5e3,isClosable:!0})},onError:()=>{s({title:"Tracking lost",description:"Unknown tracking error happened",status:"warning",duration:5e3,isClosable:!0})}})}function Ke(t){const a=_(),{toast:s}=J();return T({mutationFn:async({tonConnection:n})=>{if(!t)throw new Error("Jetton address is not set");const{changeAdminBody:o}=await M(async()=>{const{changeAdminBody:r}=await import("./index-BCN26Ft_.js").then(c=>c.dO);return{changeAdminBody:r}},[]),{zeroAddress:i}=await M(async()=>{const{zeroAddress:r}=await import("./index-BCN26Ft_.js").then(c=>c.dP);return{zeroAddress:r}},[]),u=async()=>E(t).then(r=>{var c;return((c=r==null?void 0:r.admin)==null?void 0:c.address)??null}),h={validUntil:Date.now()+5*60*1e3,messages:[{address:t.toString(),amount:b.toNano(.01).toString(),stateInit:void 0,payload:o(i()).toBoc().toString("base64")}]};return await n.sendTransaction(h),await N(u,r=>(r==null?void 0:r.equals(i()))??!1),{jettonAddress:t}},onSuccess:n=>{n.jettonAddress&&a.invalidateQueries({queryKey:g.info(n.jettonAddress.toString())}),s({title:"Success",description:"Ownership revoked successfully",status:"success",duration:5e3,isClosable:!0})},onError:()=>{s({title:"Tracking lost",description:"Unknown tracking error happened",status:"warning",duration:5e3,isClosable:!0})}})}function Ue(t){const a=_(),{toast:s}=J();return T({mutationFn:async({metadata:n,tonConnection:o})=>{if(!t)throw new Error("Jetton address is not set");const{updateMetadataBody:i,buildJettonOnchainMetadata:u}=await M(async()=>{const{updateMetadataBody:l,buildJettonOnchainMetadata:x}=await import("./index-BCN26Ft_.js").then(d=>d.dO);return{updateMetadataBody:l,buildJettonOnchainMetadata:x}},[]),h=async()=>E(t).then(l=>l?l.metadata:null),r=await u(n),c={validUntil:Date.now()+5*60*1e3,messages:[{address:t.toString(),amount:b.toNano(.01).toString(),stateInit:void 0,payload:i(r).toBoc().toString("base64")}]};return await o.sendTransaction(c),await N(h,l=>l?l.name===n.name&&l.symbol===n.symbol&&l.decimals===n.decimals&&l.image===n.image&&l.description===n.description:!1),{jettonAddress:t}},onSuccess:n=>{n.jettonAddress&&a.invalidateQueries({queryKey:g.info(n.jettonAddress.toString())}),s({title:"Success",description:"Jetton edited successfully",status:"success",duration:5e3,isClosable:!0})},onError:()=>{s({title:"Tracking lost",description:"Unknown tracking error happened",status:"warning",duration:5e3,isClosable:!0})}})}const $e=({id:t,onSubmit:a,...s})=>{const n=me(),{handleSubmit:o}=n,i=u=>{a(u)};return e.jsxs(fe.form,{id:t,w:"100%",maxW:600,onSubmit:o(i),noValidate:!0,gap:4,display:"flex",flexDirection:"column",...s,children:[e.jsx(Je,{context:n}),e.jsx(Te,{context:n}),e.jsx(Fe,{context:n}),e.jsx(De,{context:n})]})},S=({label:t,children:a,value:s})=>e.jsxs(k,{gap:2,children:[e.jsx(j,{w:"88px",color:"text.secondary",children:t}),typeof s=="string"?e.jsx(j,{children:s}):s,a]}),Qe=({isOpen:t,onClose:a,onConfirm:s,jettonName:n})=>{const o=()=>{s(),a()};return e.jsx(ge,{isOpen:t,onClose:a,onConfirm:o,title:i=>`Revoke ownership of ${i}`,description:i=>e.jsx(e.Fragment,{children:e.jsxs(j,{textStyle:"text.body2",mb:"6",color:"text.secondary",children:["Are you sure you want to revoke ownership of the jetton ",e.jsx("b",{children:i})]})}),confirmValue:n,confirmButtonText:"Revoke"})},Ge=({isOpen:t,onClose:a,onMint:s,jettonSymbol:n,jettomDecimals:o})=>{const[i,u]=m.useState(""),[h,r]=m.useState(null),c=()=>{u(""),r(null),a()},l=()=>{const d=re(i,o);d<=0n?r("Amount should be greater than 0"):(s(d),c())},x=d=>{u(d.target.value),r(null)};return e.jsxs(F,{isOpen:t,onClose:c,size:"md",children:[e.jsx(D,{}),e.jsxs(P,{children:[e.jsxs(R,{textAlign:"center",children:["Mint ",n]}),e.jsx(V,{}),e.jsx(q,{py:"0",children:e.jsxs(v,{my:0,isInvalid:h!==null,children:[e.jsx(z,{autoComplete:"off",autoFocus:!0,min:0,onChange:x,onKeyDown:d=>d.key==="Enter"&&l(),placeholder:`Enter ${n} amount`,type:"number",value:i}),e.jsx(B,{color:"text.secondary",children:"Number of tokens to mint"})]})}),e.jsxs(L,{gap:"3",children:[e.jsx(p,{flex:1,onClick:c,variant:"secondary",children:"Cancel"}),e.jsx(p,{flex:1,disabled:!i,onClick:l,type:"submit",variant:"primary",children:"Mint"})]})]})]})},He=({isOpen:t,onClose:a,onSubmit:s,jettonInfo:n})=>{const o="jetton-edit-form",i=n.metadata;if(!i)throw new Error("Jetton metadata is missing");const u=je({defaultValues:{name:i.name,symbol:i.symbol,description:i.description,image:i.image}}),h=r=>{s({name:r.name,symbol:r.symbol,description:r.description,image:r.image,decimals:i.decimals}),a()};return e.jsxs(F,{isOpen:t,onClose:a,size:"lg",children:[e.jsx(D,{}),e.jsxs(P,{children:[e.jsx(R,{children:"Edit token"}),e.jsx(V,{}),e.jsx(q,{children:e.jsx(we,{...u,children:e.jsx($e,{onSubmit:h,id:o})})}),e.jsxs(L,{children:[e.jsx(p,{flex:1,onClick:a,variant:"outline",children:"Cancel"}),e.jsx(p,{flex:1,ml:3,onClick:u.handleSubmit(h),children:"Save"})]})]})]})},We=({data:t,jettonAddress:a,connectedWalletAddress:s,...n})=>{const{mintable:o,metadata:{name:i,symbol:u,image:h,decimals:r,description:c,address:l},totalSupply:x,admin:d}=t,y=t,[f]=ae(),[w,I]=m.useState(!1),[K,O]=m.useState(!1),[C,Y]=m.useState(!1),U=Le(a),$=Ke(a),A=Ue(a),ce=G=>{!a||!s||U.mutate({amount:G,connectedWalletAddress:s,tonConnection:f,jettonWallet:y})},ue=()=>{$.mutate({tonConnection:f})},de=G=>{A.mutate({metadata:G,tonConnection:f})},Q=s&&(d==null?void 0:d.address.equals(s));return e.jsxs(ee,{w:440,bgColor:"background.contentTint",...n,borderRadius:8,children:[e.jsxs(k,{gap:3,p:4,children:[e.jsx(pe,{name:i,size:"md",src:h}),e.jsxs(k,{justify:"center",direction:"column",children:[e.jsxs(k,{gap:1,children:[e.jsx(j,{textStyle:"label1",children:i}),e.jsx(j,{textStyle:"body1",color:"text.secondary",children:u})]}),e.jsx(j,{textStyle:"body2",overflow:"hidden",color:"text.secondary",textOverflow:"ellipsis",noOfLines:1,title:c,children:c})]}),Q&&e.jsx(ye,{"aria-label":"Remove",icon:e.jsx(be,{}),isLoading:A.isPending,onClick:()=>Y(!0),ml:"auto"})]}),e.jsx(oe,{}),e.jsxs(ee,{textStyle:"body2",p:4,children:[e.jsx(S,{label:"Address",value:e.jsx(Z,{variant:"flat",size:"sm",textView:te(l),text:l.toString(),iconAlign:"start",hideCopyIcon:!0})}),e.jsx(S,{label:"Owner",value:d?e.jsx(Z,{variant:"flat",size:"sm",textView:te(d.address,{bounceable:!1}),text:d.address.toString({bounceable:!1}),iconAlign:"start",hideCopyIcon:!0}):"Owner missing",children:Q&&e.jsx(p,{textStyle:"body2",color:$.isPending?void 0:"text.accent",fontWeight:400,isLoading:$.isPending,onClick:()=>I(!0),size:"sm",variant:"link",children:"Revoke Ownership"})}),e.jsx(S,{label:"Symbol",value:u}),e.jsx(S,{label:"Decimals",value:r}),e.jsx(S,{label:"Total Supply",value:`${ie(x,r)} ${u}`,children:Q&&o&&e.jsx(p,{textStyle:"body2",color:U.isPending?void 0:"text.accent",fontWeight:400,isLoading:U.isPending,onClick:()=>O(!0),size:"sm",variant:"link",children:"Mint"})})]}),e.jsx(Qe,{isOpen:w,onClose:()=>I(!1),onConfirm:ue,jettonName:i}),e.jsx(Ge,{isOpen:K,onClose:()=>O(!1),onMint:ce,jettonSymbol:u,jettomDecimals:r}),e.jsx(He,{isOpen:C,onClose:()=>Y(!1),onSubmit:de,jettonInfo:y})]})},Ze=({isOpen:t,onClose:a,onCheck:s,connectedWalletAddress:n})=>{const[o,i]=m.useState(""),[u,h]=m.useState(null),r=x=>{i(x.target.value),h(null)},c=()=>{i(""),h(null),a()},l=()=>{if(ve(o)){const x=b.Address.parse(o);n!=null&&n.equals(x)?h("This address is same as connected wallet"):(s(b.Address.parse(o)),c())}else h("Invalid address")};return e.jsxs(F,{isOpen:t,onClose:c,size:"md",children:[e.jsx(D,{}),e.jsxs(P,{children:[e.jsx(R,{textAlign:"center",children:"Check balance for another address"}),e.jsx(V,{}),e.jsx(q,{pb:"0",children:e.jsxs(v,{mb:0,isInvalid:u!==null,children:[e.jsx(X,{htmlFor:"name",children:"Enter address to check balance:"}),e.jsx(z,{autoComplete:"off",autoFocus:!0,onChange:r,onKeyDown:x=>x.key==="Enter"&&l(),placeholder:"Wallet Address",value:o}),e.jsx(le,{children:u})]})}),e.jsxs(L,{gap:"3",children:[e.jsx(p,{flex:1,onClick:c,variant:"secondary",children:"Cancel"}),e.jsx(p,{flex:1,onClick:l,type:"submit",variant:"primary",children:"Check balance"})]})]})]})},Xe=({isOpen:t,onClose:a,onBurn:s,jettonSymbol:n,jettomDecimals:o,jettonBalance:i})=>{const[u,h]=m.useState(""),[r,c]=m.useState(null),l=()=>{h(""),c(null),a()},x=()=>{const f=re(u,o);f<=0n?c("Amount should be greater than 0"):f>i?c("Insufficient balance"):(s(f),l())},d=f=>{h(f.target.value),c(null)},{ref:y}=Me({mask:Number,scale:Number(o),signed:!1,radix:".",mapToRadix:[","]});return e.jsxs(F,{isOpen:t,onClose:l,size:"md",children:[e.jsx(D,{}),e.jsxs(P,{children:[e.jsxs(R,{textAlign:"center",children:["Burn ",n]}),e.jsx(V,{}),e.jsx(q,{py:"0",children:e.jsxs(v,{my:0,isInvalid:r!==null,children:[e.jsx(z,{ref:y,autoComplete:"off",autoFocus:!0,onChange:d,onKeyDown:f=>f.key==="Enter"&&x(),placeholder:`Enter ${n} amount`,type:"number",value:u}),e.jsx(B,{color:"text.secondary",children:"Number of tokens to burn from connected wallet"}),e.jsx(le,{children:r})]})}),e.jsxs(L,{gap:"3",children:[e.jsx(p,{flex:1,onClick:l,variant:"secondary",children:"Cancel"}),e.jsx(p,{flex:1,disabled:!u,onClick:x,type:"submit",variant:"primary",children:"Burn"})]})]})]})},Ye=({connectedWalletAddress:t,jettonInfo:a,jettonAddress:s,jettonWallet:n,...o})=>{const[i]=ae(),[u,h]=m.useState(!1),[r,c]=m.useState(!1),[l,x]=m.useState(t),d=Ne(s),y=a.metadata,f=n?ie(n.balance,y.decimals):"-",w=t?(l==null?void 0:l.equals(t))??!1:!0,I=w&&(n==null?void 0:n.balance)!==0n,K=()=>{w?h(!0):x(t)},O=C=>{!s||!t||!n||d.mutate({amount:C,connectedWalletAddress:t,tonConnection:i,jettonWallet:n})};return e.jsxs(e.Fragment,{children:[e.jsx(j,{textStyle:"label1",py:5,children:"Connected Jetton wallet"}),e.jsxs(Pe,{maxW:516,...o,children:[e.jsxs(v,{children:[e.jsxs(X,{justifyContent:"space-between",display:"flex",htmlFor:"name",children:[e.jsx(Ce,{children:"Wallet Address"}),e.jsx(p,{textStyle:"body2",color:"text.accent",fontSize:14,fontWeight:400,onClick:K,variant:"link",children:w?"Check balance for another wallet":"Cancel"})]}),e.jsx(Z,{flex:"1",wordBreak:"break-all",text:(l==null?void 0:l.toString({bounceable:!1}))??"-"}),e.jsx(B,{color:"text.secondary",children:"Connected wallet public address, can be shared to receive jetton transfers"})]}),e.jsxs(v,{children:[e.jsx(X,{htmlFor:"name",children:"Wallet Balance"}),e.jsxs(Se,{children:[e.jsx(z,{pr:63,readOnly:!0,value:f}),e.jsx(ke,{w:63,children:I&&e.jsx(p,{textStyle:"label2",color:d.isPending?void 0:"text.accent",fontSize:14,isLoading:d.isPending,onClick:()=>c(!0),variant:"link",children:"Burn"})})]}),e.jsx(B,{color:"text.secondary",children:"Number of tokens in connected wallet that can be transferred to others"})]})]}),e.jsx(Ze,{isOpen:u,onClose:()=>h(!1),onCheck:C=>x(C),connectedWalletAddress:t}),n&&e.jsx(Xe,{isOpen:r,onClose:()=>c(!1),onBurn:O,jettonBalance:BigInt(n.balance),jettonSymbol:y.symbol,jettomDecimals:y.decimals})]})},nt=()=>{const{address:t}=Ee(),a=Ie(),s=m.useMemo(()=>a?b.Address.parse(a):null,[a]),n=m.useMemo(()=>t&&Oe(t)?b.Address.parse(t):null,[t]),{data:o,isLoading:i}=Ve(n),{data:u}=qe(n,s);return o===null&&i?e.jsx(H,{display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(Be,{})}):e.jsxs(H,{display:"flex",flexDirection:"column",children:[e.jsxs(k,{align:"flex-start",justify:"space-between",mb:"5",children:[e.jsx(ne,{children:"Jetton"}),e.jsx(_e,{})]}),o==null?e.jsx(H,{display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(ne,{children:"Jetton not found"})}):e.jsxs(e.Fragment,{children:[e.jsx(We,{data:o,jettonAddress:n,connectedWalletAddress:s}),e.jsx(oe,{mt:6}),e.jsx(Ye,{connectedWalletAddress:s,jettonInfo:o,jettonAddress:n,jettonWallet:u??null})]})]})};export{nt as default};
