import{l as U,m as N,n as $,t as C,j as e,O as k,B as h,F as g,T as d,f as G,S as m,o as v,b as R,D as W,p as D,r as p,q as K,s as Z,v as V,w as A,x as P,y as J,z as b,A as X,L as Y,C as z,G as H,J as ee,K as te,M as ne,N as se,Q as oe,V as re,R as ie,U as ae,W as ce,k as le,X as M,Y as xe,Z as de}from"./index-BCN26Ft_.js";import{R as pe}from"./RefillModal-peJOgeto.js";import{U as me}from"./usd-currency-amount-OKdR9Ymz.js";import{u as he}from"./queries-DS3Ag-C4.js";import{u as ue}from"./queries-B6tpSeut.js";import{e as ge}from"./explorer-Cg_jVVyy.js";import{u as je}from"./RefillModalContent-DlFbo1-1.js";import"./v-stack-DE1rRJbv.js";const ye=()=>{var w,F;const{isOpen:t,onClose:n,onOpen:s}=U(),{data:o,isLoading:r}=N(),{data:i}=$(),c=o?Number(C(o.usdt.amount,6)):0,a=o?Number(C(o.usdt.promo_amount,6)):0,l=o?Number(C(((w=o.ton)==null?void 0:w.amount)||0,9)):0,j=l&&i?l*i:0,y=o?Number(C(((F=o.ton)==null?void 0:F.promo_amount)||0,9)):0,x=y&&i?y*i:0,f=l+y,T=(o==null?void 0:o.total)!==void 0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(o==null?void 0:o.total):null;return e.jsxs(e.Fragment,{children:[e.jsx(k,{h:"100%",p:"0",display:"flex",flexDirection:"column",flex:"1",minW:"330px",children:e.jsxs(h,{children:[e.jsxs(g,{align:"center",justify:"space-between",px:"6",py:"5",children:[e.jsxs(h,{children:[e.jsx(d,{textStyle:"body2",mb:"1",color:"text.secondary",children:"Total Balance"}),e.jsx(G,{display:"flex",alignItems:"center",gap:"2",children:r||(o==null?void 0:o.total)===void 0?e.jsx(m,{w:"200px",h:"10"}):e.jsx(v,{title:o==null?void 0:o.total.toString(),children:T})})]}),e.jsx(R,{onClick:s,size:"sm",variant:"secondary",children:"Refill"})]}),e.jsx(W,{}),e.jsxs(g,{wrap:"wrap",rowGap:"2",columnGap:"3",px:"6",pt:"3",pb:"5",children:[e.jsxs(h,{minW:"170px",children:[e.jsxs(g,{children:[e.jsx(d,{textStyle:"body2",minW:"80px",mb:"1",color:"text.secondary",children:"Balance"}),r?e.jsx(m,{w:"80px",h:"5"}):e.jsxs(d,{textStyle:"body2",title:c.toString(),children:[c.toFixed(2)," USDT"]})]}),e.jsxs(g,{children:[e.jsxs(g,{align:"center",gap:"1",minW:"80px",mb:"1",children:[e.jsx(d,{textStyle:"body2",color:"text.secondary",children:"Promo"}),e.jsx(D,{children:"Apply promo codes to get bonus balance"})]}),r?e.jsx(m,{w:"80px",h:"5"}):e.jsxs(d,{textStyle:"body2",title:a.toString(),children:[a.toFixed(2)," USDT"]})]})]}),f>0&&e.jsxs(h,{flex:"1",children:[e.jsxs(g,{children:[e.jsx(d,{textStyle:"body2",minW:"110px",mb:"1",color:"text.secondary",children:"TON Balance"}),r?e.jsx(m,{w:"150px",h:"5"}):e.jsxs(d,{textStyle:"body2",whiteSpace:"nowrap",title:l.toString(),children:[l.toFixed(2)," TON"," ",e.jsxs(v,{color:"text.secondary",children:["≈ $",j.toFixed(2)]})]})]}),e.jsxs(g,{children:[e.jsxs(g,{align:"center",gap:"1",minW:"110px",mb:"1",children:[e.jsx(d,{textStyle:"body2",color:"text.secondary",children:"TON Promo"}),e.jsx(D,{children:"Apply promo codes to get bonus balance"})]}),r?e.jsx(m,{w:"150px",h:"5"}):e.jsxs(d,{textStyle:"body2",whiteSpace:"nowrap",title:y.toString(),children:[y.toFixed(2)," TON"," ",e.jsxs(v,{color:"text.secondary",children:["≈ $",x.toFixed(2)]})]})]})]})]})]})}),e.jsx(pe,{isOpen:t,onClose:n})]})};function be(){const{data:t,isLoading:n,error:s}=ue(),{data:o,isLoading:r,error:i}=he(),c=n||r;return{data:{restApi:s?null:fe(t??null),liteproxy:i?null:Se(o??null)},isLoading:c}}function fe(t){return t?{id:`tonapi-${t.id}`,plan:`REST API «${t.name}»`,interval:t.type==="monthly"?"Monthly":"Pay as you go",renewsDate:t.renewsDate,price:t.price}:null}function Se(t){if(!t)return null;const n=t.name!=="Free"&&t.next_payment?new Date(t.next_payment):void 0;return{id:`liteproxy-${t.id}`,plan:`Liteservers «${t.name}»`,interval:"Monthly",renewsDate:n,price:new me(t.usd_price)}}const _=p.createContext({billingHistory:[],rowHeight:"48px"}),Te=K(({children:t,...n},s)=>{var j;const{rowHeight:o,isLoading:r,hasEverLoaded:i,skeletonRowCount:c}=p.useContext(_),a=p.useRef(null),l=(j=a.current)==null?void 0:j.clientWidth;return e.jsxs(Z,{ref:s,sx:{borderCollapse:"separate",borderSpacing:"0"},w:"100%",variant:"withBottomBorder",...n,children:[e.jsx(V,{children:e.jsxs(A,{sx:{th:{px:2,zIndex:2},"&::after":{content:'""',display:"block",position:"absolute",left:0,right:0,top:0,height:o,background:"white"}},pos:"sticky",zIndex:"4",top:"0",left:"0",w:"100%",h:o,children:[e.jsx(P,{pos:"relative",zIndex:1,minW:"150px",bg:"background.contentTint",borderTop:"1px",borderTopColor:"background.contentTint",borderLeft:"1px",borderLeftColor:"background.contentTint",borderTopLeftRadius:"sm",boxSizing:"content-box",children:"History"}),e.jsx(P,{pos:"relative",zIndex:1,w:"100%",minW:"320px",bg:"background.contentTint",boxSizing:"content-box",children:"Action"}),e.jsx(P,{pos:"relative",zIndex:1,w:"180px",minW:"180px",bg:"background.contentTint",borderTop:"1px",borderTopColor:"background.contentTint",borderRight:"1px",borderRightColor:"background.contentTint",borderTopRightRadius:"sm",children:"Amount"})]})}),e.jsx(J,{ref:a,sx:{tr:{minWidth:`${l||0}px`}},children:r&&i?Array.from({length:c||1}).map((y,x)=>e.jsxs(A,{h:o,children:[e.jsx(b,{px:"2",boxSizing:"content-box",children:e.jsx(m,{h:"4"})}),e.jsx(b,{px:"2",boxSizing:"content-box",children:e.jsx(m,{h:"4"})}),e.jsx(b,{px:"2",boxSizing:"content-box",children:e.jsx(m,{h:"4"})})]},x)):t})]})}),_e={TonapiMonthlyPaymentMeta:"tonapi_monthly_payment",TonapiInstantPaymentMeta:"tonapi_instant_payment",TonapiChangeTierMeta:"tonapi_change_tier",LiteproxyMonthlyPaymentMeta:"liteproxy_monthly_payment",LiteproxyChangeTierMeta:"liteproxy_change_tier",TestnetTonsPurchaseMeta:"testnet_tons_purchase",CnftIndexingPaymentMeta:"cnft_indexing_payment",MessagePackagePurchaseMeta:"message_package_purchase",ChatGptRequestPaymentMeta:"chatgpt_request_payment",PromoCodeActivationMeta:"promo_code_activation",StreamingApiPaymentMeta:"streaming_api_payment",ReplenishmentOfDepositMeta:"replenishment_of_deposit",AnalyticsRequestPaymentMeta:"analytics_request_payment",OtherMeta:"Default"};Object.fromEntries(Object.entries(_e).map(([t,n])=>[n,t]));const I={tonapi_monthly_payment:t=>{var o;const s=(o=t.tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["REST API monthly payment",s&&e.jsxs(e.Fragment,{children:["— ",e.jsx("strong",{children:s})]})]})},tonapi_instant_payment:t=>{var o;const s=(o=t.tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["REST API payment",s&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:s})]})]})},tonapi_change_tier:t=>{var o;const s=(o=t.new_tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["REST API tier change",s&&e.jsxs(e.Fragment,{children:[" ",e.jsx("strong",{children:s})]})]})},liteproxy_monthly_payment:t=>{var o;const s=(o=t.tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["Liteservers monthly payment",s&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:s})]})]})},liteproxy_change_tier:t=>{var o;const s=(o=t.new_tier)==null?void 0:o.name;return e.jsxs(e.Fragment,{children:["Liteservers tier change",s&&e.jsxs(e.Fragment,{children:[" ","→ ",e.jsx("strong",{children:s})]})]})},testnet_tons_purchase:t=>{const n=t;return e.jsxs(e.Fragment,{children:["Testnet coins purchase",n.testnet_coins&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsxs("strong",{children:[n.testnet_coins," coins"]})]})]})},cnft_indexing_payment:t=>{const n=t;return e.jsxs(e.Fragment,{children:["NFT indexing",n.collection&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:n.collection})]}),n.count&&e.jsxs(e.Fragment,{children:[" ",e.jsxs("strong",{children:["(",n.count," items)"]})]})]})},message_package_purchase:t=>{const n=t;return e.jsxs(e.Fragment,{children:["Message package",n.count&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsxs("strong",{children:[n.count," messages"]})]})]})},chatgpt_request_payment:()=>e.jsx(e.Fragment,{children:"ChatGPT API request"}),promo_code_activation:t=>{const n=t;return e.jsxs(e.Fragment,{children:["Promo code activation",n.promo_code&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("strong",{children:n.promo_code})]})]})},streaming_api_payment:t=>{const n=t;if(!n.period)return e.jsx(e.Fragment,{children:"Webhooks API payment"});const s=Math.round(n.period/60),o=Math.round(s/60),r=s>=60?`${o}h`:`${s}m`;return e.jsxs(e.Fragment,{children:["Webhooks API payment — ",e.jsx("strong",{children:r})]})},replenishment_of_deposit:t=>{const{tx_hash:n}=t;return e.jsxs(e.Fragment,{children:["Refill "," ",n&&e.jsx(Y,{href:ge.transactionLink(n),isExternal:!0,children:n.slice(-8)})]})},analytics_request_payment:()=>e.jsx(e.Fragment,{children:"Analytics query"}),Default:(t,n)=>e.jsx(e.Fragment,{children:n})};function we(t){const{info:n,description:s}=t,o=n.reason in I?n.reason:"Default",r=I[o];return r(n,s)}const Fe=({style:{top:t,...n}})=>{const{rowHeight:s}=p.useContext(_);return e.jsxs(A,{sx:{td:{px:2,py:0}},pos:"absolute",top:parseFloat(t.toString())+parseFloat(s)+"px",left:"0",display:"table-row",w:"100%",h:s,maxH:s,style:n,children:[e.jsx(b,{minW:"150px",h:s,maxH:s,borderLeft:"1px",borderLeftColor:"background.contentTint",boxSizing:"content-box",children:e.jsx(m,{w:"120px",h:"4"})}),e.jsx(b,{w:"100%",minW:"320px",h:s,maxH:s,boxSizing:"content-box",children:e.jsx(m,{w:"200px",h:"4"})}),e.jsx(b,{w:"180px",minW:"180px",h:s,maxH:s,borderRight:"1px",borderRightColor:"background.contentTint",children:e.jsx(m,{w:"100px",h:"4"})})]})},Ce={charge:"text.primary",deposit:"accent.green"},Ae={charge:"-",deposit:"+"},ve=({historyItem:t,style:n})=>{const{rowHeight:s}=p.useContext(_);return e.jsxs(A,{sx:{td:{px:2,py:0}},pos:"absolute",top:parseFloat(n.top.toString())+parseFloat(s)+"px",left:"0",display:"table-row",w:"100%",h:s,maxH:s,children:[e.jsx(b,{minW:"150px",h:s,maxH:s,borderLeft:"1px",borderLeftColor:"background.contentTint",boxSizing:"content-box",children:X(t.date)}),e.jsx(b,{w:"100%",minW:"320px",h:s,maxH:s,boxSizing:"content-box",children:we(t)}),e.jsxs(b,{w:"180px",minW:"180px",h:s,maxH:s,color:Ce[t.type]??"text.accent",borderRight:"1px",borderRightColor:"background.contentTint",title:t.amount.stringAmountWithoutRound,children:[Ae[t.type],t.amount.stringCurrencyAmount]})]})},Pe=({index:t,style:n})=>{const{billingHistory:s,isLoading:o}=p.useContext(_);if(o||!s||!s[t])return e.jsx(Fe,{style:n});const r=s[t];return e.jsx(ve,{style:n,historyItem:r},r.id)},Re=({billingHistory:t,isLoading:n=!1,hasEverLoaded:s=!1,skeletonRowCount:o=1,hasBillingHistory:r=void 0,...i})=>{const c=r??t.length>0,a="48px";if(!s&&n)return e.jsx(z,{h:"96px",children:e.jsx(H,{})});if(!n&&!c)return e.jsx(h,{h:"96px",py:"10",color:"text.secondary",textAlign:"center",children:"No billing history yet"});const l=n&&s?o:t.length,j=Math.min(parseInt(a)*(l+1)+6,800)+"px",y=Math.min(parseInt(a)*(l+1)+6,800);return e.jsx(_.Provider,{value:{billingHistory:t,rowHeight:a,isLoading:n,hasEverLoaded:s,skeletonRowCount:o},children:e.jsx(h,{minH:j,...i,children:e.jsx(ee,{height:y,width:"100%",itemCount:l,itemSize:parseInt(a),innerElementType:Te,children:Pe})})})},L=({subscription:t})=>{const n=te();return e.jsxs(g,{justify:"space-between",gap:"4",py:"1",children:[e.jsx(g,{direction:"column",flex:"1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(d,{fontSize:"sm",fontWeight:"semibold",children:t.plan}),e.jsxs(d,{color:"text.secondary",fontSize:"sm",children:[t.interval,t.renewsDate&&` · Renews ${ne(t.renewsDate)}`]})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{w:"150px",h:"5"}),e.jsx(m,{w:"200px",h:"4"})]})}),e.jsx(h,{gap:"1",children:t?e.jsxs(g,{align:"center",children:[e.jsx(d,{fontSize:"md",fontWeight:"semibold",children:t.price.stringCurrencyAmount}),e.jsxs(se,{placement:"bottom-end",children:[e.jsx(oe,{"aria-label":"options",icon:e.jsx(re,{}),ml:"2"}),e.jsx(ie,{w:"132px",children:e.jsx(ae,{onClick:()=>n("/tonapi/pricing"),children:e.jsx(d,{textStyle:"label2",children:"Change plan"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{w:"80px",h:"5"}),e.jsx(h,{w:"24px"})]})})]})},ke=({subscriptions:t,isLoading:n=!1,...s})=>{if(n)return e.jsx(z,{h:"96px",children:e.jsx(H,{})});const{restApi:o,liteproxy:r}=t||{restApi:null,liteproxy:null};if(!n&&!!!(r||o))return e.jsx(h,{h:"96px",py:"10",color:"text.secondary",textAlign:"center",children:"No active plans yet"});const c=!n&&o&&r;return e.jsxs(h,{minH:"100px",...s,children:[o&&e.jsx(L,{subscription:o}),c&&e.jsx(W,{}),r&&e.jsx(L,{subscription:r})]})},De=()=>{const{data:t,isLoading:n}=be();return e.jsx(k,{height:"auto",p:"0",display:"flex",flexDirection:"column",flex:"1",minW:"330px",children:e.jsxs(h,{px:"6",py:"5",children:[e.jsx(d,{mb:"2",fontSize:"lg",fontWeight:"semibold",children:"Active Plans"}),e.jsx(ke,{subscriptions:t,isLoading:n})]})})},Me=10,Ie=[10,20,50,100],Le=()=>{const[t,n]=p.useState(!1),[s,o]=p.useState(Me),[r,i]=p.useState(1),[c,a]=p.useState([]),[l,j]=p.useState(void 0),y=ce(),{data:x=[],isLoading:f}=je({before_tx:l,limit:s}),T=x.length>0;p.useEffect(()=>{a([]),j(void 0),i(1)},[y]),p.useEffect(()=>{!f&&T&&x&&n(!0)},[f,T,x==null?void 0:x.length]);const w=s,F=x.length===s,B=c.length>0,E=()=>{if(x.length>0){const u=x[x.length-1].id;a(S=>[...S,l??""]),j(u),i(S=>S+1)}},O=()=>{if(c.length>0){const u=[...c],S=u.pop();a(u),j(S===""?void 0:S),i(Q=>Q-1)}},q=u=>{o(u),a([]),j(void 0),i(1)};return e.jsxs(h,{px:"6",py:"5",children:[e.jsx(le,{mb:"5",children:"Billing History"}),e.jsx(Re,{billingHistory:x,isLoading:f,hasEverLoaded:t,skeletonRowCount:w,hasBillingHistory:T}),t&&e.jsxs(M,{justify:"space-between",gap:"4",mt:"2",children:[e.jsx(xe,{w:"auto",maxW:"100px",isDisabled:f,onChange:u=>q(Number(u.target.value)),size:"sm",value:s,children:Ie.map(u=>e.jsxs("option",{value:u,children:[u," rows"]},u))}),e.jsxs(M,{gap:"2",children:[e.jsx(R,{isDisabled:!B||f,onClick:O,size:"sm",variant:"secondary",children:"Previous"}),e.jsxs(h,{minW:"65px",color:"text.secondary",fontSize:"sm",textAlign:"center",children:["Page ",r]}),e.jsx(R,{isDisabled:!F||f,onClick:E,size:"sm",variant:"secondary",children:"Next"})]})]})]})},Qe=()=>{const t=de(),{data:n}=N();return p.useEffect(()=>{t.refetchQueries({queryKey:["billing-history"]}),t.refetchQueries({queryKey:["rest-api-selected-tier"]}),t.refetchQueries({queryKey:["liteproxy-selected-tier"]})},[n==null?void 0:n.total,t]),e.jsxs(e.Fragment,{children:[e.jsxs(g,{align:"stretch",wrap:"wrap",gap:4,mb:4,children:[e.jsx(ye,{}),e.jsx(De,{})]}),e.jsx(k,{h:"fit-content",p:"0",display:"flex",flexDirection:"column",children:e.jsx(Le,{})})]})};export{Qe as default};
