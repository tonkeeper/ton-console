import{bt as Y,r as h,j as e,aK as N,b1 as X,bw as Q,by as G,b3 as J,X as A,ec as T,a$ as Z,ay as L,az as B,aA as _,aB as R,aC as H,aD as P,bH as ee,b4 as te,b as k,T as p,V as z,z as se,A as ne,G as M,J as u,K as oe,N as I,bM as re,L as b,bE as D,B as C,ed as ie,F as x,a5 as E,b7 as ae,c1 as le,Z as $,_ as ce,$ as K,a0 as W,c2 as de,k as U,bP as xe,ee as he,ef as me,E as V,ap as je,eg as ue,at as be,au as pe,av as fe,eh as ye,l as O,C as ke,O as v,d4 as ge,o as w,cN as Ce,bR as g}from"./index--6gyeIm1.js";import{b as We,c as Te,a as q,u as Se}from"./queries-CpxNtx4N.js";import{V as ve}from"./VerticalDotsIcon16-RC_uRROt.js";import{D as we}from"./DeleteIcon24-BKHrrW2Y.js";import{c as Ee}from"./copy-to-clipboard-Ct1_m45i.js";import{C as Ie}from"./index-Dfsp2eQr.js";import{T as Me}from"./table-container-Bd__NqqD.js";import{C as De}from"./CreateIcon96-BwWBAJzf.js";import"./time-periods-B2gFC1G6.js";const Oe=({id:n,onSubmit:a,disableDefaultFocus:o,...d})=>{const l=j=>{a({endpoint:j.endpoint})},{handleSubmit:r,register:s,setFocus:i,formState:{errors:c}}=Y();return h.useEffect(()=>{o||i("endpoint")},[o,i]),e.jsx(N.form,{id:n,w:"100%",onSubmit:r(l),noValidate:!0,...d,children:e.jsxs(X,{isInvalid:!!c.endpoint,isRequired:!0,children:[e.jsx(Q,{htmlFor:"name",children:"Webhook URL"}),e.jsx(G,{autoComplete:"off",id:"name",placeholder:"Your webhook URL",...s("endpoint",{required:"This is required",minLength:{value:3,message:"Minimum length should be 3"}})}),e.jsx(J,{children:c.endpoint&&c.endpoint.message})]})})},Fe=n=>{const a=A(),o="create-webhook-form",{network:d,setSelectedWebhookId:l}=T(),{mutate:r,isPending:s}=We(d),i=Z(),{reset:c,formState:{isDirty:j}}=i,m=h.useCallback(y=>{r(y,{onSuccess:f=>{const t=f.webhook_id||f.id;if(!t)throw new Error("Webhook was not created");l(t),a(`./view?webhookId=${t}`)}})},[r,a,l]);return h.useEffect(()=>{n.isOpen||setTimeout(c,200)},[c,n.isOpen]),e.jsxs(L,{scrollBehavior:"inside",...n,children:[e.jsx(B,{}),e.jsxs(_,{children:[e.jsx(R,{children:"New Webhook"}),e.jsx(H,{}),e.jsx(P,{children:e.jsx(ee,{...i,children:e.jsx(Oe,{id:o,onSubmit:m})})}),e.jsxs(te,{gap:"3",children:[e.jsx(k,{flex:1,onClick:n.onClose,variant:"secondary",children:"Cancel"}),e.jsx(k,{flex:1,form:o,isDisabled:!j,isLoading:s,type:"submit",variant:"primary",children:"Create"})]})]})]})},Ne=({webhook:n,isOpen:a,onClose:o})=>{const{network:d}=T(),{mutate:l,isPending:r}=Te(d),s=h.useCallback(()=>{n&&l(n.id,{onSuccess:o})},[n,l,o]);return e.jsx(Ie,{isOpen:a,onClose:o,onConfirm:s,title:i=>`Delete ${i}`,description:i=>e.jsx(e.Fragment,{children:e.jsxs(p,{textStyle:"text.body2",mb:"6",color:"text.secondary",children:["This action cannot be canceled. To confirm, type ",e.jsx("b",{children:i})," in the box below."]})}),confirmValue:n.endpoint,confirmButtonText:"Delete",isLoading:r})},Ae=n=>{const a=A(),{network:o,setSelectedWebhookId:d}=T(),{data:l=[],isLoading:r}=q(o),[s,i]=h.useState(),[c,j]=h.useState();h.useEffect(()=>{if(c!==void 0){const t=setTimeout(()=>j(void 0),1500);return()=>clearTimeout(t)}},[c]);const m=h.useCallback(t=>{d(t.id),a(`./view?webhookId=${t.id}`)},[a,d]),y=h.useCallback(t=>{i({key:t,action:"delete"})},[]),f=h.useCallback(()=>{i(null)},[]);return r?e.jsx(z,{}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{border:"1px",borderColor:"background.contentTint",borderRadius:"sm",...n,children:e.jsxs(se,{variant:"simple",children:[e.jsx(ne,{children:e.jsxs(M,{children:[e.jsx(u,{children:"ID"}),e.jsx(u,{children:"Webhook"}),e.jsx(u,{children:"Accounts"}),e.jsx(u,{children:"Opcodes"}),e.jsx(u,{children:"Mempool"}),e.jsx(u,{children:"New Contracts"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Token"})]})}),e.jsx(oe,{children:l.map(t=>e.jsx(I,{as:re,display:"contents",to:`./view?webhookId=${t.id}`,children:e.jsxs(M,{children:[e.jsx(b,{overflow:"hidden",maxW:"200px",children:e.jsx(D,{host:e.jsx(C,{layerStyle:"textEllipse",w:"fit-content",maxW:"100%",children:t.id}),offset:[-16,8],placement:"bottom-start",children:t.id})}),e.jsx(b,{overflow:"hidden",children:e.jsx(D,{host:e.jsx(C,{layerStyle:"textEllipse",w:"fit-content",maxW:"100%",children:t.endpoint}),offset:[-16,8],placement:"bottom-start",children:t.endpoint})}),e.jsx(b,{maxW:"70px",children:t.subscribed_accounts}),e.jsx(b,{maxW:"70px",children:t.subscribed_msg_opcodes}),e.jsx(b,{maxW:"70px",children:t.subscribed_to_mempool?"Yes":"No"}),e.jsx(b,{maxW:"70px",children:t.subscribed_to_new_contracts?"Yes":"No"}),e.jsx(b,{maxW:"100px",onClick:S=>S.preventDefault(),children:t.status===ie.RTOnline?"Online":"Offline"}),e.jsx(b,{w:"100px",children:e.jsxs(x,{align:"center",justify:"space-between",gap:"4",onClick:S=>S.preventDefault(),children:[e.jsxs(x,{align:"center",gap:"1",children:[e.jsx(N.span,{flexShrink:"1",w:"80px",layerStyle:"textEllipse",children:t.token}),c!==void 0&&c===t.id?e.jsx(E,{}):e.jsx(ae,{"aria-label":"copy",icon:e.jsx(le,{}),onClick:()=>{j(t.id),Ee(t.token)}})]}),e.jsxs($,{placement:"bottom-end",children:[e.jsx(ce,{icon:e.jsx(ve,{})}),e.jsxs(K,{w:"132px",children:[e.jsxs(W,{onClick:()=>m(t),children:[e.jsx(de,{mr:"2"}),e.jsx(p,{textStyle:"label2",fontFamily:"body",children:"View"})]}),e.jsxs(W,{onClick:()=>y(t),children:[e.jsx(we,{mr:"2"}),e.jsx(p,{textStyle:"label2",fontFamily:"body",children:"Delete"})]})]})]})]})})]})},t.id))})]})}),s&&e.jsx(Ne,{isOpen:(s==null?void 0:s.action)==="delete",webhook:s==null?void 0:s.key,onClose:f})]})},Le=({onOpenCreate:n})=>e.jsx(x,{align:"center",justify:"center",children:e.jsxs(x,{align:"center",direction:"column",maxW:"512px",children:[e.jsx(De,{mb:"8"}),e.jsx(U,{mb:"2",children:"Your Webhooks will be shown here"}),e.jsx(p,{textStyle:"body2",mb:"6",color:"text.secondary",children:"Create your first Webhook"}),e.jsx(k,{onClick:n,children:"Create Webhook"})]})}),Be=()=>e.jsx(x,{align:"center",justify:"center",minH:"300px",children:e.jsx(x,{align:"center",direction:"column",maxW:"512px",children:e.jsxs(xe,{alignItems:"center",justifyContent:"center",flexDir:"column",gap:"4",p:"8",textAlign:"center",bg:"background.contentTint",borderColor:"separator.common",borderRadius:"md",status:"info",variant:"subtle",children:[e.jsx(he,{pt:"2",color:"text.primary",fontSize:"lg",fontWeight:"bold",children:"Webhooks playground is temporarily unavailable"}),e.jsx(me,{maxW:"512px",color:"text.secondary",fontSize:"sm",children:"The webhooks playground is not available at the moment. However, you can manage webhooks through the API."}),e.jsx(C,{mt:"4",children:e.jsx(I,{color:"accent.blue",fontWeight:"600",href:V.DOCUMENTATION_WEBHOOKS,isExternal:!0,children:"View Webhooks API Documentation"})})]})})}),F=({data:n,metricType:a,color:o})=>{const d=n.result.filter(r=>r.metric.type===a).flatMap(r=>r.values.map(([s,i])=>({time:s*1e3,value:parseFloat(i)}))),l=r=>{const s=new Date(r);return`${s.toLocaleDateString()} ${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`};return e.jsx(je,{width:"100%",height:250,children:e.jsxs(ue,{data:d,margin:{top:0,right:0,bottom:0,left:0},children:[e.jsx(be,{dataKey:"time",type:"number",domain:["auto","auto"],tickFormatter:l}),e.jsx(pe,{}),e.jsx(fe,{labelFormatter:r=>l(Number(r))}),e.jsx(ye,{dataKey:"value",fill:o})]})})},_e=({isOpen:n,onClose:a,data:o})=>o?e.jsxs(L,{isOpen:n,onClose:a,size:"4xl",children:[e.jsx(B,{}),e.jsxs(_,{children:[e.jsx(R,{children:"Webhook Statistics"}),e.jsx(H,{}),e.jsxs(P,{children:[e.jsx(p,{textStyle:"text.label1",mb:1,color:"text.secondary",fontSize:16,children:"Failed webhook requests"}),e.jsx(F,{data:o,metricType:"failed",color:"#F53C36"}),e.jsx(p,{textStyle:"text.label1",mb:1,color:"text.secondary",fontSize:16,children:"Delivered webhook requests"}),e.jsx(F,{data:o,metricType:"delivered",color:"#2E84E5"})]})]})]}):null,Ye=()=>{const{isOpen:n,onOpen:a,onClose:o}=O(),{isOpen:d,onOpen:l,onClose:r}=O(),{network:s,setNetwork:i}=T(),{data:c=[],isLoading:j,error:m}=q(s),{data:y=null}=Se();if(j)return e.jsx(ke,{h:"300px",children:e.jsx(z,{})});if(m&&typeof m=="object"&&"status"in m&&m.status===501)return e.jsx(v,{h:"fit-content",children:e.jsx(Be,{})});if(m)return e.jsx(v,{h:"fit-content",children:e.jsx(x,{align:"center",justify:"center",minH:"300px",children:e.jsx(x,{align:"center",direction:"column",maxW:"512px",children:e.jsx(p,{textStyle:"body2",color:"text.secondary",textAlign:"center",children:"Unable to load webhooks at the moment. Please try refreshing the page."})})})});const f=c.length===0;return e.jsxs(e.Fragment,{children:[e.jsxs(v,{h:"fit-content",children:[e.jsxs(x,{mb:"3",children:[e.jsxs(x,{direction:"column",gap:2,children:[e.jsxs(x,{align:"center",gap:4,children:[e.jsx(U,{children:"Webhooks"}),e.jsxs($,{placement:"bottom",children:[e.jsx(ge,{variant:"flat","aria-label":"network",rightIcon:e.jsx(Ce,{}),textStyle:"label2",color:"text.secondary",children:e.jsx(w,{textTransform:"capitalize",children:s})}),e.jsxs(K,{w:"122px",children:[e.jsxs(W,{gap:"2",onClick:()=>i(g.MAINNET),children:[e.jsx(w,{textStyle:"label2",children:"Mainnet"}),s===g.MAINNET&&e.jsx(E,{})]}),e.jsxs(W,{gap:"2",onClick:()=>i(g.TESTNET),children:[e.jsx(w,{textStyle:"label2",children:"Testnet"}),s===g.TESTNET&&e.jsx(E,{})]})]})]})]}),e.jsx(x,{children:e.jsxs(p,{textStyle:"text.body2",color:"text.secondary",fontSize:14,children:["Webhooks are available via the API. For details, see"," ",e.jsx(I,{color:"accent.blue",href:V.DOCUMENTATION_WEBHOOKS,isExternal:!0,children:"Webhooks documentation"})]})})]}),!f&&e.jsx(k,{mb:"6",ml:"auto",onClick:a,children:"Add Webhook"})]}),f?e.jsx(Le,{onOpenCreate:a}):e.jsxs(e.Fragment,{children:[e.jsx(C,{mb:4,children:e.jsx(k,{onClick:l,variant:"secondary",children:"Statistics"})}),e.jsx(Ae,{})]})]}),e.jsx(Fe,{isOpen:n,onClose:o}),e.jsx(_e,{data:y,isOpen:d,onClose:r}),"  "]})};export{Ye as default};
