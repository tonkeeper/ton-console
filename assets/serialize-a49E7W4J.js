var w=Object.defineProperty;var P=(n,a,e)=>a in n?w(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e;var y=(n,a,e)=>P(n,typeof a!="symbol"?a+"":a,e);import{e3 as k,e4 as S,e5 as A,e6 as v,cP as E,e7 as L,aV as C,dY as b,e8 as g,e9 as m,ea as R,cV as T,eb as x}from"./index--6gyeIm1.js";var V=function(n,a,e,t){function l(r){return r instanceof e?r:new e(function(i){i(r)})}return new(e||(e=Promise))(function(r,i){function u(c){try{s(t.next(c))}catch(h){i(h)}}function f(c){try{s(t.throw(c))}catch(h){i(h)}}function s(c){c.done?r(c.value):l(c.value).then(u,f)}s((t=t.apply(n,[])).next())})},_=function(n,a){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},t,l,r,i;return i={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(s){return function(c){return f([s,c])}}function f(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(e=0)),e;)try{if(t=1,l&&(r=s[0]&2?l.return:s[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,s[1])).done)return r;switch(l=0,r&&(s=[s[0]&2,r.value]),s[0]){case 0:case 1:r=s;break;case 4:return e.label++,{value:s[1],done:!1};case 5:e.label++,l=s[1],s=[0];continue;case 7:s=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(s[0]===6||s[0]===2)){e=0;continue}if(s[0]===3&&(!r||s[1]>r[0]&&s[1]<r[3])){e.label=s[1];break}if(s[0]===6&&e.label<r[1]){e.label=r[1],r=s;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(s);break}r[2]&&e.ops.pop(),e.trys.pop();continue}s=a.call(n,e)}catch(c){s=[6,c],l=0}finally{t=r=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},z=function(n,a){S.set(n,a)},M=function(n,a,e){return V(void 0,void 0,void 0,function(){var t,l;return _(this,function(r){return t=new k(n,a,e),l=Array.from(S.values()).map(function(i){return i.storageName}).includes(t.storageName),A(l,t.storageName),z(n,t),[2,t.init()]})})};class U{constructor(a,e){y(this,"defaultValue");y(this,"value");y(this,"state","unresolved");y(this,"error",null);y(this,"persistableResolved");if(this.defaultValue=a,this.value=a,v(this,{persistableResolved:!0,state:!0,defaultValue:!1,isLoading:m,isResolved:m,clear:g,setValue:g,setStartLoading:g,setEndLoading:g,setErroredState:g,createAsyncAction:!1,error:b,value:b}),e!=null&&e.makePersistable){let t,l=!0,r=!0;typeof e.makePersistable=="string"?t=e.makePersistable:(t=e.makePersistable.storeKey,l=!e.makePersistable.notModifyStatusBefore,r=!e.makePersistable.notModifyStatusAfter),l&&(this.state="pending"),this.persistableResolved=M(this,{name:t,properties:[{key:"value",serialize:J,deserialize:$}],storage:E().localStorage}),r&&this.persistableResolved.then(()=>this.state="ready")}else this.persistableResolved=Promise.resolve()}get isLoading(){return this.state==="pending"||this.state==="refreshing"}get isResolved(){return this.state==="ready"||this.state==="refreshing"||this.state==="refetchErrored"}createAsyncAction(a,e){const t=async(...l)=>{var h;e!=null&&e.resetBeforeExecution&&this.clear();const r=l[l.length-1],i=t.pendingCallsIds.at(-1);let u=!1;r&&typeof r=="object"&&(u="silently"in r&&!!r.silently,"cancelPreviousCall"in r&&r.cancelPreviousCall&&i!==void 0&&t.shouldCancelCallsIds.push(i),"cancelAllPreviousCalls"in r&&r.cancelAllPreviousCalls&&(t.shouldCancelCallsIds=t.pendingCallsIds.slice()));const f=d=>{u||(this.state=d)},s=d=>{u||(this.error=d)};this.isResolved?f("refreshing"):f("pending"),s(null),t.error=null,t.isLoading=!0;const c=(i||0)+1;t.pendingCallsIds.push(c);try{const d=await a(...l);if(t.pendingCallsIds=t.pendingCallsIds.filter(o=>o!==c),t.shouldCancelCallsIds.includes(c)){t.shouldCancelCallsIds=t.shouldCancelCallsIds.filter(o=>o!==c);return}if(d!==void 0&&!(e!=null&&e.notMutateState)&&L(()=>this.value=d),f("ready"),e!=null&&e.successToast){const{toast:o}=C();o({title:"Successful action",status:"success",isClosable:!0,...e.successToast})}return d}catch(d){if(s(d),this.isResolved?f("refetchErrored"):f("resolveErrored"),e!=null&&e.errorToast){let o=e.errorToast;typeof e.errorToast=="function"&&(o=e.errorToast(d));const{toast:I}=C();I({title:"Unknown error",description:"Unknown api error happened. Try again later",status:"error",isClosable:!0,...o})}throw t.error=d,(h=e==null?void 0:e.onError)==null||h.call(e,d),d}finally{t.isLoading=!1}};return t.shouldCancelCallsIds=[],t.pendingCallsIds=[],t.cancelLastCall=()=>{const l=t.pendingCallsIds.at(-1);l!==void 0&&t.shouldCancelCallsIds.push(l)},t.cancelAllPendingCalls=()=>{t.shouldCancelCallsIds=t.pendingCallsIds.slice()},t.isLoading=!1,t.error=null,v(t,{isLoading:b,error:b}),t}setValue(a){this.value=a}setStartLoading(){this.isResolved?this.state="refreshing":this.state="pending"}setEndLoading(){this.state="ready"}setErroredState(a){this.error=a,this.isResolved?this.state="refetchErrored":this.state="resolveErrored"}clear(a){this.state="unresolved",this.error=null,this.value=a||this.defaultValue}}const N=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/,B=[T,x];function O(n,a){if(typeof a=="string"&&N.test(a))return new Date(a);if(a&&typeof a=="object"&&"$type"in a){const e=B.find(t=>t.name===a.$type);if(e)return new e(a)}return a}function J(n){return R(JSON.stringify(n))}function $(n){return JSON.parse(n,O)}export{U as L};
