import{s as l,aT as b,q as u,a3 as d,aU as p,ej as a,cf as y}from"./index--6gyeIm1.js";import{a as j,b as f}from"./time-periods-B2gFC1G6.js";const i={all:["webhooks"],list:(e,s)=>["webhooks",e,s],stats:e=>["webhooks","stats",e],subscriptions:(e,s,n)=>["webhooks","subscriptions",e,s,n]};function m(e,s){return e.result.filter(t=>{var r;return((r=t.metric)==null?void 0:r.type)===s}).flatMap(t=>t.values.map(([r,c])=>({time:r*1e3,value:parseFloat(c)})))}function S(e){const s=l();return b({queryKey:i.list(s==null?void 0:s.id,e),queryFn:async()=>s?(await a.webhooks.getWebhooks({project_id:s.id.toString(),network:e})).data.webhooks.toSorted((t,o)=>o.id-t.id):[],enabled:!!s,staleTime:5*60*1e3,retry:(n,t)=>t&&typeof t=="object"&&"status"in t&&t.status===501?!1:n<1})}function k(e="last_6h"){const s=u(),n=f(e),{start:t,end:o}=j(e);return b({queryKey:[...i.stats(s||void 0),e],queryFn:async()=>{if(!s)return null;const{data:r,error:c}=await y({query:{project_id:s,start:t,end:o,step:n.stepSeconds,dashboard:"tonapi_webhook"}});if(c)throw c;return r.stats},enabled:!!s,staleTime:30*1e3})}function I(e,s,n=20){const t=u();return b({queryKey:i.subscriptions(t||void 0,e||0,s),queryFn:async()=>{if(!e||!t)return[];const o=(s-1)*n;return(await a.webhooks.webhookAccountTxSubscriptions(e,{project_id:t.toString(),network:"mainnet",limit:n,offset:o})).data.account_tx_subscriptions},enabled:!!e&&!!t,staleTime:1*60*1e3})}function q(e){const s=d(),n=u();return p({mutationFn:async({endpoint:t})=>{const o=n;if(!o)throw new Error("Project not selected");return{...(await a.webhooks.createWebhook({project_id:o.toString(),network:e},{endpoint:t})).data,_projectId:o}},onSuccess:t=>{const o=t._projectId;o&&s.invalidateQueries({queryKey:i.list(o,e)})}})}function g(e){const s=d(),n=u();return p({mutationFn:async t=>{const o=n;if(!o)throw new Error("Project not selected");return await a.webhooks.deleteWebhook(t,{project_id:o.toString(),network:e}),{webhookId:t,projectId:o}},onSuccess:t=>{s.invalidateQueries({queryKey:i.list(t.projectId,e)})}})}function P(e,s){const n=d(),t=u();return p({mutationFn:async o=>{const r=t;if(!r)throw new Error("Project not selected");return await a.webhooks.webhookAccountTxSubscribe(e,{project_id:r.toString(),network:s},{accounts:o.map(c=>({account_id:c.toRawString()}))}),{webhookId:e,projectId:r}},onSuccess:o=>{n.invalidateQueries({queryKey:i.subscriptions(o.projectId,o.webhookId,1)})}})}function _(e,s){const n=d(),t=u();return p({mutationFn:async o=>{const r=t;if(!r)throw new Error("Project not selected");return await a.webhooks.webhookAccountTxUnsubscribe(e,{project_id:r.toString(),network:s},{accounts:o.map(c=>c.toRawString())}),{webhookId:e,projectId:r}},onSuccess:o=>{n.invalidateQueries({queryKey:i.subscriptions(o.projectId,o.webhookId,1)})}})}function T(e){const s=d(),n=u();return p({mutationFn:async t=>{const o=n;if(!o)throw new Error("Project not selected");return await a.webhooks.webhookBackOnline(t,{project_id:o.toString(),network:e}),{webhookId:t,projectId:o}},onSuccess:t=>{s.invalidateQueries({queryKey:i.list(t.projectId,e)})}})}export{S as a,q as b,g as c,P as d,_ as e,I as f,T as g,m,k as u};
