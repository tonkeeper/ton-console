import{dJ as G,y as L,de as J,cM as X,dO as K,r as b,aL as F,j as e,aK as f,dQ as Y,a2 as ee,ax as E,T as m,bt as se,b1 as P,bw as O,bW as te,bX as ne,bY as oe,bZ as R,B as v,by as re,ei as ae,b3 as ie,bC as A,ec as B,a$ as ce,ay as le,az as de,aA as ue,aB as xe,aC as he,aD as me,bH as be,b4 as pe,b as w,V as $,z as je,A as fe,G as z,J as S,K as ye,L as C,F as h,Z as ge,_ as Se,$ as Ce,a0 as V,c2 as ke,k,I as we,l as _e,cb as ve,C as Ie,bM as Le,ed as Be,O as Te,N as H,E as Me,D as T}from"./index--6gyeIm1.js";import{d as Ne,e as We,f as q,a as Fe,g as Ae}from"./queries-CpxNtx4N.js";import{u as De}from"./useSearchParams-C4KxjW47.js";import{V as Ee}from"./VerticalDotsIcon16-RC_uRROt.js";import{D as Pe}from"./DeleteIcon24-BKHrrW2Y.js";import{c as Q}from"./create-icon-BJ8YnfLe.js";import{C as Oe}from"./index-Dfsp2eQr.js";import{T as Re}from"./table-container-Bd__NqqD.js";import{C as ze}from"./CreateIcon96-BwWBAJzf.js";import{S as M}from"./Card-uYMgTIS2.js";import"./time-periods-B2gFC1G6.js";import"./card-Csp8xPXk.js";import"./card-header-Bk90WjMF.js";import"./card-body-B5KnP0ef.js";const[Ve,D]=G({name:"BreadcrumbStylesContext",errorMessage:`useBreadcrumbStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Breadcrumb />" `}),U=L(function(n,t){const r=J("Breadcrumb",n),c=X(n),{children:d,spacing:a="0.5rem",separator:l="/",className:u,listProps:x,...i}=c,o=K(d),j=o.length,y=o.map((p,_)=>b.cloneElement(p,{separator:l,spacing:a,isLastChild:j===_+1})),g=F("chakra-breadcrumb",u);return e.jsx(f.nav,{ref:t,"aria-label":"breadcrumb",className:g,__css:r.container,...i,children:e.jsx(Ve,{value:r,children:e.jsx(f.ol,{className:"chakra-breadcrumb__list",...x,__css:{display:"flex",alignItems:"center",...r.list},children:y})})})});U.displayName="Breadcrumb";const I=L(function(n,t){const{isCurrentPage:r,as:c,className:d,href:a,...l}=n,u=D(),x={ref:t,as:c,className:F("chakra-breadcrumb__link",d),...l};return r?e.jsx(f.span,{"aria-current":"page",__css:u.link,...x}):e.jsx(f.a,{__css:u.link,href:a,...x})});I.displayName="BreadcrumbLink";const N=L(function(n,t){const{spacing:r,...c}=n,d=D(),a=Y({mx:r,...d.separator});return e.jsx(f.span,{ref:t,role:"presentation",...c,__css:a})});N.displayName="BreadcrumbSeparator";const W=L(function(n,t){const{isCurrentPage:r,separator:c,isLastChild:d,spacing:a,children:l,className:u,...x}=n,o=K(l).map(p=>p.type===I?b.cloneElement(p,{isCurrentPage:r}):p.type===N?b.cloneElement(p,{spacing:a,children:p.props.children||c}):p),j=D(),y=Y({display:"inline-flex",alignItems:"center",...j.item}),g=F("chakra-breadcrumb__list-item",u);return e.jsxs(f.li,{ref:t,className:g,...x,__css:y,children:[o,!d&&e.jsx(N,{spacing:a,children:c})]})});W.displayName="BreadcrumbItem";const He=Q({d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z",displayName:"ChevronLeftIcon"}),Ke=Q({d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",displayName:"ChevronRightIcon"}),Ye=({currentPage:s,totalPages:n,onPageChange:t})=>{const r=()=>{s>1&&t(s-1)},c=()=>{s<n&&t(s+1)};return e.jsxs(ee,{justifyContent:"end",mt:4,mr:2,spacing:4,children:[e.jsx(E,{w:8,h:8,"aria-label":"Previous Page",icon:e.jsx(He,{}),isDisabled:s===1,onClick:r}),e.jsxs(m,{children:["Page ",s," of ",n]}),e.jsx(E,{w:8,h:8,"aria-label":"Next Page",icon:e.jsx(Ke,{}),isDisabled:s===n,onClick:c})]})},$e=({id:s,onSubmit:n,disableDefaultFocus:t,...r})=>{const c=i=>{n({accounts:i.accounts.split(",").map(o=>o.trim()).map(o=>A.Address.parse(o))})},{handleSubmit:d,register:a,setFocus:l,control:u,formState:{errors:x}}=se();return b.useEffect(()=>{t||l("accounts")},[t,l]),e.jsxs(f.form,{id:s,w:"100%",onSubmit:d(c),noValidate:!0,...r,children:[e.jsxs(P,{isInvalid:!!x.initiations,children:[e.jsx(O,{htmlFor:"initiations",children:"Initiations"}),e.jsx(te,{name:"initiations",control:u,render:({field:i})=>e.jsxs(ne,{flexDir:"column",display:"flex",...oe(i),children:[e.jsx(R,{alignItems:"flex-start",mb:"2",isDisabled:!0,variant:"withDescription",children:e.jsx(v,{textStyle:"label2",mb:"0.5",children:"Finalized trace (will be available soon)"})}),e.jsx(R,{alignItems:"flex-start",defaultChecked:!0,variant:"withDescription",children:e.jsx(v,{textStyle:"label2",mb:"0.5",children:"Transactions"})})]})})]}),e.jsxs(P,{isInvalid:!!x.accounts,isRequired:!0,children:[e.jsx(O,{htmlFor:"accounts",children:"Accounts"}),e.jsx(re,{id:"accounts",placeholder:"Accounts",...a("accounts",{required:"This is required",validate(i){return i.split(",").some(j=>!ae(j.trim()))?"Invalid account address":!0}})}),e.jsx(ie,{children:x.accounts&&x.accounts.message})]})]})},qe=s=>{const n="add-subscription-form",{selectedWebhookId:t,network:r}=B(),{mutate:c,isPending:d}=Ne(t||0,r),a=ce(),{reset:l,formState:{isDirty:u}}=a,x=b.useCallback(i=>{t&&c(i.accounts,{onSuccess:()=>{s.onClose()}})},[c,s,t]);return b.useEffect(()=>{s.isOpen||setTimeout(l,200)},[l,s.isOpen]),e.jsxs(le,{scrollBehavior:"inside",...s,children:[e.jsx(de,{}),e.jsxs(ue,{children:[e.jsx(xe,{children:"Add Subscription"}),e.jsx(he,{}),e.jsx(me,{children:e.jsx(be,{...a,children:e.jsx($e,{id:n,onSubmit:x})})}),e.jsxs(pe,{gap:"3",children:[e.jsx(w,{flex:1,onClick:s.onClose,variant:"secondary",children:"Cancel"}),e.jsx(w,{flex:1,form:n,isDisabled:!u,isLoading:d,type:"submit",variant:"primary",children:"Create"})]})]})]})},Qe=({subscription:s,isOpen:n,onClose:t})=>{const{selectedWebhookId:r,network:c}=B(),{mutate:d,isPending:a}=We(r||0,c),l=b.useCallback(()=>{s&&r&&d([A.Address.parse(s.account_id)],{onSuccess:t})},[s,r,d,t]);return e.jsx(Oe,{isOpen:n,onClose:t,onConfirm:l,title:u=>`Delete ${u}`,description:u=>e.jsx(e.Fragment,{children:e.jsxs(m,{textStyle:"text.body2",mb:"6",color:"text.secondary",children:["This action cannot be canceled. To confirm, type ",e.jsx("b",{children:u})," in the box below."]})}),confirmValue:s.account_id,confirmButtonText:"Delete",isLoading:a})},Ue=s=>{const{selectedWebhookId:n,subscriptionsPage:t,setSubscriptionsPage:r}=B(),{data:c=[],isLoading:d}=q(n,t),[a,l]=b.useState(),u=b.useCallback(o=>{l({key:o,action:"edit"})},[]),x=b.useCallback(o=>{l({key:o,action:"delete"})},[]),i=b.useCallback(()=>{l(null)},[]);return d?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{border:"1px",borderColor:"background.contentTint",borderRadius:"sm",...s,children:e.jsxs(je,{variant:"simple",children:[e.jsx(fe,{children:e.jsxs(z,{children:[e.jsx(S,{children:"Account"}),e.jsx(S,{children:"Last Delivered LT"}),e.jsx(S,{children:"Failed Attempts"}),e.jsx(S,{children:"Failed LT"}),e.jsx(S,{children:"Failed At"})]})}),e.jsx(ye,{children:c.map(o=>e.jsxs(z,{children:[e.jsx(C,{overflow:"hidden",minW:250,children:A.Address.parse(o.account_id).toString({bounceable:!1})}),e.jsx(C,{overflow:"hidden",maxW:"200px",children:o.last_delivered_lt??"-"}),e.jsx(C,{overflow:"hidden",maxW:"200px",children:o.failed_attempts??"-"}),e.jsx(C,{overflow:"hidden",maxW:"200px",children:o.failed_lt??"-"}),e.jsx(C,{overflow:"hidden",maxW:"200px",children:e.jsxs(h,{align:"center",justify:"space-between",gap:"4",children:[o.failed_at??"-",e.jsxs(ge,{placement:"bottom-end",children:[e.jsx(Se,{icon:e.jsx(Ee,{})}),e.jsxs(Ce,{w:"132px",children:[e.jsxs(V,{onClick:()=>u(o),children:[e.jsx(ke,{mr:"2"}),e.jsx(m,{textStyle:"label2",fontFamily:"body",children:"Edit"})]}),e.jsxs(V,{onClick:()=>x(o),children:[e.jsx(Pe,{mr:"2"}),e.jsx(m,{textStyle:"label2",fontFamily:"body",children:"Delete"})]})]})]})]})})]},o.account_id))})]})}),e.jsx(Ye,{currentPage:t,totalPages:Math.ceil(c.length/20),onPageChange:o=>r(o)}),a&&e.jsx(Qe,{isOpen:(a==null?void 0:a.action)==="delete",subscription:a==null?void 0:a.key,onClose:i})]})},Ze=({onOpenCreate:s})=>e.jsx(h,{align:"center",justify:"center",children:e.jsxs(h,{align:"center",direction:"column",maxW:"512px",children:[e.jsx(ze,{mb:"8"}),e.jsx(k,{mb:"2",children:"Your Subscriptions will be shown here"}),e.jsx(m,{textStyle:"body2",mb:"6",color:"text.secondary",children:"Add your first Subscription"}),e.jsx(w,{onClick:s,children:"Add Subscriptions"})]})}),Ge=s=>e.jsx(we,{w:"16px",h:"16px",color:"icon.secondary",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",...s,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.27324 3.17107C6.59298 2.90775 7.06565 2.9535 7.32897 3.27324L10.829 7.52324C11.057 7.80019 11.057 8.19986 10.829 8.4768L7.32897 12.7268C7.06565 13.0465 6.59298 13.0923 6.27324 12.829C5.9535 12.5656 5.90776 12.093 6.17107 11.7732L9.27843 8.00002L6.17107 4.2268C5.90775 3.90706 5.9535 3.43439 6.27324 3.17107Z",fill:"currentColor"})}),Je=({isOnline:s,label:n=!1})=>e.jsxs(h,{align:"center",gap:"8px",children:[e.jsx(v,{sx:{"@keyframes pulse":{"0%":{boxShadow:"0 0 8px green"},"50%":{boxShadow:"0 0 12px green"},"100%":{boxShadow:"0 0 8px green"}}},w:"10px",h:"10px",bg:s?"green.500":"red.500",borderRadius:"50%",shadow:s?"0 0 8px green":"none",animation:s?"pulse 1.5s infinite":"none"}),n&&e.jsx(m,{color:s?"green.700":"gray.700",fontSize:"sm",children:s?"Online":"Offline"})]});function Xe(s){if(!s)return null;const n=parseInt(s);return isNaN(n)?null:n}const ms=()=>{const{searchParams:s}=De(),n=s.get("webhookId"),t=Xe(n),{setSelectedWebhookId:r,network:c}=B(),{data:d=[]}=Fe(c),{data:a=[],isLoading:l}=q(t,1),{mutate:u,isPending:x}=Ae(c),i=t?d.find(Z=>Z.id===t):null;b.useEffect(()=>(t&&r(t),()=>{r(null)}),[t,r]);const{isOpen:o,onOpen:j,onClose:y}=_e();if(n&&!t)return e.jsx(ve,{to:"/tonapi/webhooks",replace:!0});if(!i||l)return e.jsx(Ie,{h:"300px",children:e.jsx($,{})});const g=e.jsxs(U,{mb:"3",color:"text.secondary",fontSize:14,fontWeight:700,separator:e.jsx(Ge,{color:"text.secondary"}),spacing:"8px",children:[e.jsx(W,{children:e.jsx(I,{as:Le,to:"/tonapi/webhooks",children:"Webhooks"})}),e.jsx(W,{color:"text.primary",isCurrentPage:!0,children:e.jsx(I,{href:"#",children:i.endpoint})})]}),p=a.length===0,_=i.status===Be.RTOnline;return e.jsxs(e.Fragment,{children:[e.jsxs(Te,{breadcrumbs:g,h:"fit-content",children:[e.jsxs(h,{mb:"4",children:[e.jsxs(h,{direction:"column",gap:2,children:[e.jsx(h,{align:"center",gap:4,children:e.jsx(k,{children:"Webhook Subscriptions"})}),e.jsx(h,{children:e.jsxs(m,{textStyle:"text.body2",color:"text.secondary",fontSize:14,children:["More webhook options can be explored through the API. For details, see"," ",e.jsx(H,{color:"accent.blue",href:Me.DOCUMENTATION_WEBHOOKS,isExternal:!0,children:"Webhooks documentation"})]})})]}),!p&&e.jsx(w,{mb:"4",ml:"auto",onClick:j,children:"Add Subscription"})]}),p?e.jsx(Ze,{onOpenCreate:j}):e.jsxs(e.Fragment,{children:[e.jsx(T,{mb:"4"}),e.jsxs(v,{mb:4,children:[e.jsxs(h,{align:"center",justify:"space-between",gap:4,children:[e.jsx(k,{children:"Status"}),e.jsxs(h,{gap:"3",children:[e.jsx(Je,{isOnline:_,label:!0}),!_&&e.jsx(w,{isLoading:x,onClick:()=>i&&u(i.id),size:"sm",children:"Try Online"})]})]}),e.jsxs(h,{wrap:{base:"wrap",lg:"nowrap"},gap:"6",mt:2,mb:4,children:[e.jsx(M,{header:"Total of Accounts",value:i.subscribed_accounts}),e.jsx(M,{header:"Total of Opcodes",value:i.subscribed_msg_opcodes}),e.jsx(M,{header:"Failed Attempts",value:i.status_failed_attempts}),e.jsxs(h,{direction:"column",ml:"auto",fontSize:"14px",children:[e.jsxs(m,{textStyle:"text.body2",align:"end",textColor:"text.secondary",children:["Last online at:"," ",i.last_online_at]}),e.jsxs(m,{textStyle:"text.body2",align:"end",textColor:"text.secondary",children:["Status updated at:"," ",i.status_updated_at]}),e.jsxs(m,{textStyle:"text.body2",align:"end",mt:"1",children:["Subscribed to Mempool:"," ",i.subscribed_to_mempool?"Yes":"No"]}),e.jsxs(m,{textStyle:"text.body2",align:"end",children:["Subscribed to New Contracts:"," ",i.subscribed_to_new_contracts?"Yes":"No"]})]})]})]}),e.jsx(T,{mb:"4"}),e.jsx(k,{children:"Subscribed opcodes"}),e.jsxs(m,{textStyle:"text.body2",mt:"3",color:"text.secondary",fontSize:14,children:["To get the list of opcodes or subscribing to specific opcodes, refer to the API methods described"," ",e.jsx(H,{color:"accent.blue",href:"https://docs.tonconsole.com/tonapi/webhooks-api",isExternal:!0,children:"here"})]}),e.jsx(T,{my:"4"}),e.jsx(k,{children:"Subscribed accounts"}),e.jsx(Ue,{mt:"3"})]})]}),e.jsx(qe,{isOpen:o,onClose:y})]})};export{ms as default};
