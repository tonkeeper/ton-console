import{r as j,cO as ge,bm as te,j as e,T as F,B as L,S as fe,cC as Ce,cP as Ie,cQ as ve,bt as Se,a$ as we,bu as re,bv as ke,aK as Te,b1 as W,bw as E,bx as ae,by as U,bz as Fe,bA as ie,cR as Oe,b3 as V,cS as Me,aI as Be,cT as B,cU as De,o as l,cV as Re,cW as Le,cX as le,cY as ce,cZ as de,aA as q,aC as $,aB as Y,k as _,aD as Z,F as u,ba as Pe,b4 as G,b as g,ay as Q,az as X,bN as Ae,C as P,V as xe,c_ as ze,c$ as A,G as pe,L as M,l as D,b8 as se,bF as He,M as R,b9 as oe,c1 as We,d0 as Ee,bE as Ve,Z as K,b6 as Ne,$ as J,a0 as ee,d1 as Ue,d2 as qe,d3 as $e,W as Ye,d4 as he,cN as ue,d5 as _e,b$ as ne,a5 as me,b7 as je,d6 as Ze,d7 as Ge,d8 as Qe,d9 as Xe,da as Ke,db as Je,cF as en,dc as nn,O as tn,dd as sn}from"./index--6gyeIm1.js";import{I as on}from"./InvoicesProjectInfo-CTmJCLit.js";import{t as rn}from"./ton-mask-eMbmeoGa.js";import{S as an}from"./select-Cj-VCuG8.js";import{C as ln}from"./card-Csp8xPXk.js";import{C as cn}from"./card-body-B5KnP0ef.js";import{V as dn}from"./VerticalDotsIcon16-RC_uRROt.js";const xn=pn(2);function pn(n){return{mask:Number,scale:n,signed:!1,thousandsSeparator:"",padFractionalZeros:!1,normalizeZeros:!0,radix:".",mapToRadix:[".",","],min:0}}const hn=({children:n,skeletonVariant:t,showSkeletonOnUpdate:o,leftSign:r,currency:s=Ce.TON,amount:a,skeletonWidth:c,precision:i,reverse:x,amountLoading:h,contentUnderSkeleton:f,thousandSeparators:C,...w})=>{const k=r===void 0?"":r,m=i===void 0?2:i,p=C===void 0?!0:C,[y,d]=j.useState("30px"),{data:I,isLoading:S}=ge(s),z=T=>{const O=Ie();if(T&&O){const H=O.getComputedStyle(T).lineHeight;d(ve(H,"8"))}},b=j.useMemo(()=>{if(a===void 0||!I)return;const T=x?new te(a).div(I):I.multipliedBy(a),O={decimalSeparator:".",groupSeparator:p?" ":"",groupSize:3};return{fiendly:T.decimalPlaces(m,te.ROUND_CEIL).toFormat(O),full:T.toString()}},[a,I,x,m,p]);return e.jsxs(F,{ref:z,as:L,alignItems:"center",display:"flex",title:b==null?void 0:b.full,...w,children:[h||S&&o?e.jsx(fe,{display:"inline-block",w:c||"40px",h:y,variant:t}):(b==null?void 0:b.fiendly)!==void 0?k+b.fiendly+(f||""):"",b!==void 0&&n]})},N={...xn,max:60*24*90},un=({onSubmit:n,defaultValues:t,disableDefaultFocus:o,...r})=>{const{amount:s,...a}=t||{},c=Se();let{handleSubmit:i,register:x,formState:h,setFocus:f}=we({defaultValues:{amount:s==null?void 0:s.stringAmount,...a}});c&&({handleSubmit:i,register:x,formState:h,setFocus:f}=c),j.useEffect(()=>{o||f("amount")},[o,f]);const{ref:C}=re({...rn,scale:3,min:0,max:1e5}),{ref:w,...k}=x("amount",{required:"This is required",validate(p){if(!ke(p))return"Amount should be valid number";if(Number(p)<.001)return"Amount must be grater or equal to 0.001"}}),m=p=>{const{amount:y,currency:d,...I}=p;n({amount:Re.fromDecimals(y,d,Le[d]),lifeTimeSeconds:Math.floor(I.lifeTimeMinutes*60),currency:d,...I})};return e.jsxs(Te.form,{w:"100%",onSubmit:i(m),noValidate:!0,...r,children:[e.jsxs(W,{mb:"8",isInvalid:!!h.errors.amount,isRequired:!0,children:[e.jsx(E,{htmlFor:"amount",children:"Amount"}),e.jsxs(ae,{children:[e.jsx(U,{ref:Fe(C,w),pr:"60px",autoComplete:"off",id:"name",placeholder:"10",...k}),e.jsx(ie,{textStyle:"body2",w:"95px",color:"text.secondary",children:e.jsx(an,{textAlign:"end",variant:"filled",...x("currency"),children:Object.entries(Oe).map(([p,y])=>e.jsx("option",{value:y,children:y},p))})})]}),e.jsx(V,{children:h.errors.amount&&h.errors.amount.message})]}),e.jsxs(W,{mb:"4",isInvalid:!!h.errors.lifeTimeMinutes,isRequired:!0,children:[e.jsx(E,{htmlFor:"lifeTimeMinutes",children:"Duration"}),e.jsx(Me,{...x("lifeTimeMinutes",{required:"This is required",validate:p=>{if(p<=0)return"Value must be grater than 0";if(p>N.max)return`Value must be less or equal to ${N.max}`}}),defaultValue:"1440",children:e.jsxs(Be,{gap:"2",gridTemplate:"repeat(2, 1fr) / repeat(3, 1fr)",children:[e.jsx(B,{value:"60",children:"Hour"}),e.jsx(B,{value:"360",children:"6 hours"}),e.jsx(B,{value:"1440",children:"Day"}),e.jsx(B,{value:"10080",children:"Week"}),e.jsx(B,{value:"43200",children:"Month"}),e.jsx(De,{placeholder:"Minutes",mask:N,rightElement:e.jsx(l,{textStyle:"body2",color:"text.secondary",children:"min"})})]})}),e.jsx(V,{children:h.errors.lifeTimeMinutes&&h.errors.lifeTimeMinutes.message})]}),e.jsxs(W,{mb:"4",isInvalid:!!h.errors.description,children:[e.jsxs(E,{htmlFor:"description",children:["Description ",e.jsx(l,{color:"text.tertiary",children:"(Optional)"})]}),e.jsx(U,{autoComplete:"off",id:"description",placeholder:"Few words about the invoice",...x("description",{maxLength:{value:255,message:"Max length is 255 characters"}})}),e.jsx(V,{pos:"static",children:h.errors.description&&h.errors.description.message}),e.jsx(F,{textStyle:"body3",mt:h.errors.description?"0":"2",color:"text.secondary",children:"Only the administrator can see this description."})]})]})},ye=({onClose:n,invoice:t})=>{const o=le(Date.now()),r=ce(Math.floor((t.validUntil.getTime()-o)/1e3)),s=de(r*1e3);return e.jsxs(q,{children:[e.jsx($,{}),e.jsxs(Y,{children:[e.jsx(_,{mb:"1",children:"Invoice"}),e.jsxs(F,{textStyle:"body2",color:"text.secondary",children:[e.jsxs(l,{children:["ID ",t.id]}),t.description&&e.jsxs(l,{children:[" · ",t.description]})]})]}),e.jsxs(Z,{children:[e.jsx(ln,{mb:"4",children:e.jsxs(cn,{textStyle:"body2",px:"6",py:"5",children:[e.jsxs(u,{justify:"space-between",mb:"3",children:[e.jsx(l,{color:"text.secondary",children:"Life time"}),e.jsx(l,{color:"text.primary",fontFamily:"mono",children:r!==0?s:"Expired"})]}),e.jsxs(u,{justify:"space-between",children:[e.jsx(l,{color:"text.secondary",children:"Amount"}),e.jsx(l,{color:"text.primary",children:t.amount.toStringCurrencyAmount({decimalPlaces:null})})]}),e.jsx(u,{justify:"flex-end",children:e.jsx(hn,{color:"text.secondary",textStyle:"body2",leftSign:"$",currency:t.currency,amount:t.amount.amount})})]})}),t.status==="pending"&&r!==0&&e.jsxs(e.Fragment,{children:[e.jsx(F,{textStyle:"label2",mb:"2",children:"Link for payment"}),e.jsx(Pe,{text:t.paymentLink})]})]}),e.jsx(G,{gap:"3",children:e.jsx(g,{flex:1,onClick:n,variant:"secondary",children:"Done"})})]})},mn=({isOpen:n,onClose:t,onCreateInvoice:o,isLoading:r=!1})=>{const[s,a]=j.useState(null),c=j.useId(),i=()=>{r||(a(null),t())};return e.jsxs(Q,{isOpen:n,onClose:i,scrollBehavior:"inside",size:"md",children:[e.jsx(X,{}),s?e.jsx(ye,{onClose:i,invoice:s}):e.jsxs(q,{maxH:"calc(100% - 3rem)",my:"3",children:[e.jsx($,{}),e.jsx(Y,{children:"New Invoice"}),e.jsx(Z,{children:e.jsx(un,{id:c,onSubmit:x=>o(x).then(a)})}),e.jsxs(G,{gap:"3",children:[e.jsx(g,{flex:1,onClick:i,variant:"secondary",children:"Cancel"}),e.jsx(g,{flex:1,form:c,isLoading:r,type:"submit",variant:"primary",children:"Create"})]})]})]})},be={success:{color:"badge.success",label:"Paid"},pending:{color:"badge.warning",label:"Pending"},expired:{color:"badge.danger",label:"Expired"},cancelled:{color:"badge.secondary",label:"Canceled"}},jn=({status:n,isLoading:t,...o})=>{const r=be[n];return e.jsxs(Ae,{pos:"relative",bgColor:r.color,...o,children:[t&&e.jsx(P,{pos:"absolute",top:"0",right:"0",bottom:"0",left:"0",children:e.jsx(xe,{color:"icon.secondary",size:"xs"})}),e.jsx(l,{opacity:t?.3:1,children:r.label})]})},yn=({isOpen:n,onClose:t,invoice:o})=>e.jsxs(Q,{isOpen:n,onClose:t,scrollBehavior:"inside",size:"md",children:[e.jsx(X,{}),e.jsx(ye,{onClose:t,invoice:o})]}),bn=({invoice:n,isOpen:t,onClose:o,onCancelInvoice:r,isLoading:s=!1})=>{const a=async()=>{await r(n.id),o()};return e.jsxs(Q,{isOpen:t,onClose:o,scrollBehavior:"inside",size:"md",children:[e.jsx(X,{}),e.jsxs(q,{children:[e.jsxs(Y,{children:[e.jsx(_,{mb:"1",children:"Cancel Invoice"}),e.jsxs(F,{textStyle:"body2",color:"text.secondary",children:[e.jsxs(l,{children:["ID ",n.id]}),n.description&&e.jsxs(l,{children:[" · ",n.description]})]})]}),e.jsx($,{}),e.jsx(Z,{py:"0",children:e.jsx(F,{textStyle:"text.body2",color:"text.secondary",children:"Cancel this invoice? You cannot revert this action."})}),e.jsxs(G,{gap:"3",children:[e.jsx(g,{flex:1,onClick:o,variant:"secondary",children:"Close"}),e.jsx(g,{flex:1,isLoading:s,onClick:a,type:"submit",variant:"primary",children:"Confirm"})]})]})]})},gn=n=>{const{invoice:t,...o}=n;return e.jsxs(u,{align:"center",flexShrink:"0",minW:"fit-content",px:"3",py:"1.5",bg:"background.contentTint",borderRadius:"full",...o,children:[e.jsx(ze,{color:"accent.red"}),e.jsxs(l,{ml:"1.5",textStyle:"label3",fontFamily:"mono",children:[e.jsx(l,{color:"text.secondary",children:"Overpayment: "}),e.jsx(l,{children:t.overpayment.toStringCurrencyAmount({decimalPlaces:null})})]})]})},fn=({style:{top:n,...t}})=>{const{rawHeight:o}=j.useContext(A);return e.jsx(pe,{top:parseFloat(n.toString())+parseFloat(o)+"px",h:o,maxH:o,style:t,children:e.jsx(M,{pos:"absolute",right:"0",left:"0",border:"none",colSpan:5,children:e.jsx(P,{children:e.jsx(xe,{color:"text.secondary",size:"sm"})})})})},Cn=({invoice:n,style:t,onCancel:o,isCancelLoading:r})=>{const s=le(Date.now()),{isOpen:a,onClose:c,onOpen:i}=D(),{isOpen:x,onClose:h,onOpen:f}=D(),{onCopy:C,hasCopied:w}=se(n.id),{onCopy:k,hasCopied:m}=se(n.status==="success"?n.paidBy.toString():""),[p,y]=j.useState(!1),{rawHeight:d}=j.useContext(A),I=n.status==="pending"?Math.floor((n.validUntil.getTime()-s)/1e3):0,S=ce(I),z=S===0?"":de(S*1e3),b=n.status==="pending",T=S<300,O=n.status==="success"?He(n.paidBy,{headLength:6}):"",H=n.status==="success"?R(n.paymentDate):"";return j.useEffect(()=>{if(n.status==="pending"&&S===0){y(!0);const v=setTimeout(()=>{y(!1)},2500);return()=>clearTimeout(v)}},[S,n.status]),e.jsxs(e.Fragment,{children:[e.jsx(yn,{isOpen:a,onClose:c,invoice:n}),e.jsx(bn,{isOpen:x,onClose:h,invoice:n,onCancelInvoice:o,isLoading:r}),e.jsxs(pe,{sx:{td:{px:2,py:0}},pos:"absolute",top:parseFloat(t.top.toString())+parseFloat(d)+"px",left:"0",display:"table-row",w:"100%",h:d,maxH:d,cursor:n.status==="pending"?"pointer":"default",onClick:n.status==="pending"?i:()=>{},children:[e.jsx(M,{minW:"100px",h:d,maxH:d,borderLeft:"1px",borderLeftColor:"background.contentTint",boxSizing:"content-box",children:e.jsx(oe,{isOpen:w,label:"Copied!",children:e.jsx(g,{onClick:v=>{v.stopPropagation(),C()},variant:"flat",children:e.jsx(l,{textStyle:"body2",children:n.id})})})}),e.jsx(M,{minW:"320px",h:d,maxH:d,boxSizing:"content-box",children:e.jsxs(u,{align:"center",children:[e.jsx(jn,{isLoading:p,status:n.status}),n.status==="success"&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{textStyle:"body3",ml:"2",color:"text.secondary",children:[H," · "]}),e.jsx(oe,{isOpen:m,label:"Copied!",children:e.jsxs(g,{display:"inline-block",_hover:{svg:{opacity:1}},onClick:v=>{v.stopPropagation(),k()},size:"fit",variant:"flat",children:[e.jsx(l,{textStyle:"body3",color:"text.secondary",children:O}),e.jsx(We,{ml:"1",opacity:"0",transition:"opacity 0.15s ease-in-out"})]})})]}),n.status==="pending"&&!!S&&e.jsxs(l,{textStyle:"body3",ml:"2",children:[T&&e.jsx(Ee,{mr:"2px"}),z]}),n.status==="cancelled"&&e.jsx(l,{textStyle:"body3",ml:"2",color:"text.secondary",children:R(n.cancellationDate)}),n.status==="expired"&&e.jsx(l,{textStyle:"body3",ml:"2",color:"text.secondary",children:R(n.validUntil)})]})}),e.jsx(M,{minW:"160px",h:d,maxH:d,boxSizing:"content-box",children:n.amount.toStringCurrencyAmount({decimalPlaces:null})}),e.jsx(M,{minW:"180px",maxW:"180px",h:d,maxH:d,boxSizing:"content-box",children:R(n.creationDate)}),e.jsx(M,{w:"100%",minW:"300px",h:d,maxH:d,borderRight:"1px",borderRightColor:"background.contentTint",children:e.jsxs(u,{align:"center",justify:"space-between",gap:"2",children:[e.jsx(Ve,{host:e.jsx(l,{wordBreak:"break-all",mr:b||n.overpayment?"0":"8",maxW:"100%",width:"fit-content",noOfLines:1,children:n.description}),children:e.jsx(L,{maxW:"500px",children:n.description})}),e.jsxs(u,{gap:"2",minW:"fit-content",children:[!!n.overpayment&&e.jsx(gn,{invoice:n}),b&&e.jsxs(K,{placement:"bottom-end",children:[e.jsx(Ne,{onClick:v=>v.stopPropagation(),children:e.jsx(dn,{display:"block"})}),e.jsx(J,{w:"126px",children:e.jsx(ee,{isDisabled:r,onClick:v=>{v.stopPropagation(),f()},children:e.jsx(F,{textStyle:"label2",children:"Cancel"})})})]})]})]})})]})]})},In=({index:n,style:t})=>{const o=j.useContext(A);if(!o.invoices||n>=o.invoices.length)return e.jsx(fn,{style:t});const r=o.invoices[n];return e.jsx(Cn,{style:t,invoice:r,onCancel:o.onCancel,isCancelLoading:o.isCancelLoading},r.id)},vn=({invoices:n,isLoading:t,isEmpty:o,currentSortColumn:r,sortDirection:s="desc",onSetSortColumn:a,onToggleSortDirection:c,onCancel:i,isCancelLoading:x,onLoadMore:h,...f})=>{const C="48px",w=m=>!t&&m<n.length,k=j.useCallback(({children:m,...p})=>e.jsx(Ue,{...p,isLoading:t,isEmpty:o,currentSortColumn:r,sortDirection:s,onSetSortColumn:a,onToggleSortDirection:c,children:m}),[t,o,r,s,a,c]);return e.jsx(A.Provider,{value:{rawHeight:C,invoices:n,onCancel:i,isCancelLoading:x},children:e.jsx(L,{...f,children:e.jsx(qe,{isItemLoaded:w,itemCount:n.length+(t&&!o?1:0),loadMoreItems:h||(()=>Promise.resolve()),children:({onItemsRendered:m,ref:p})=>e.jsx($e,{children:({height:y,width:d})=>e.jsx(Ye,{height:y,width:d,itemCount:n.length+(t&&!o?1:0),onItemsRendered:m,itemSize:parseInt(C),innerElementType:k,ref:p,children:In})})})})})},Sn=({selectedStatuses:n=[],onToggle:t,onClear:o,...r})=>{const{isOpen:s,onClose:a,onOpen:c}=D();return e.jsxs(K,{closeOnSelect:!1,isOpen:s,onClose:a,onOpen:c,placement:"bottom-start",...r,children:[e.jsx(he,{px:"4",rightIcon:e.jsx(ue,{}),children:e.jsxs(u,{textStyle:"label2",gap:"2",children:["Status"," ",!!(n!=null&&n.length)&&e.jsx(P,{textStyle:"label3",w:"5",h:"5",color:"icon.contrast",borderRadius:"100%",bgColor:"text.primary",children:n.length})]})}),e.jsxs(J,{zIndex:100,w:"240px",children:[e.jsxs(u,{justify:"space-between",mb:"2",px:"1",pt:"2",color:"text.secondary",children:[e.jsx(l,{textStyle:"label2",children:"Display only"}),!!(n!=null&&n.length)&&e.jsx(g,{onClick:()=>{o(),a()},size:"fit",variant:"flat",children:e.jsx(l,{color:"text.secondary",textStyle:"body2",children:"Clear All"})})]}),Object.values(_e).map(i=>e.jsx(ee,{onClick:x=>{x.preventDefault(),t(i)},children:e.jsx(ne,{icon:e.jsx(me,{w:"12px"}),isChecked:n==null?void 0:n.includes(i),children:be[i].label})},i))]})]})},wn=({onRefresh:n,...t})=>e.jsx(je,{onClick:n,icon:e.jsx(Ze,{}),"aria-label":"refresh table",...t}),kn=({onSearch:n,...t})=>{const{ref:o,value:r,setValue:s}=re({mask:/^[a-zA-Z\d]{1,6}$/}),a=Ge(r);return j.useEffect(()=>{n(a||void 0)},[a,n]),e.jsxs(ae,{...t,children:[e.jsx(Qe,{pointerEvents:"none",children:e.jsx(Xe,{})}),e.jsx(U,{ref:o,placeholder:"Search by ID"}),!!r&&e.jsx(ie,{children:e.jsx(je,{"aria-label":"clear",icon:e.jsx(Ke,{}),onClick:()=>s("")})})]})},Tn=({isActive:n,onToggle:t,...o})=>e.jsx(ne,{h:"fit-content",isChecked:n,onChange:t,...o,children:"Overpayment"}),Fn=({selectedCurrencies:n=[],onToggle:t,onClear:o,...r})=>{const{isOpen:s,onClose:a,onOpen:c}=D();return e.jsxs(K,{closeOnSelect:!1,isOpen:s,onClose:a,onOpen:c,placement:"bottom-start",...r,children:[e.jsx(he,{px:"4",rightIcon:e.jsx(ue,{}),children:e.jsxs(u,{textStyle:"label2",gap:"2",children:["Currency"," ",!!(n!=null&&n.length)&&e.jsx(P,{textStyle:"label3",w:"5",h:"5",color:"icon.contrast",borderRadius:"100%",bgColor:"text.primary",children:n.length})]})}),e.jsxs(J,{zIndex:100,w:"240px",children:[e.jsxs(u,{justify:"space-between",mb:"2",px:"1",pt:"2",color:"text.secondary",children:[e.jsx(l,{textStyle:"label2",children:"Display only"}),!!(n!=null&&n.length)&&e.jsx(g,{onClick:()=>{o(),a()},size:"fit",variant:"flat",children:e.jsx(l,{color:"text.secondary",textStyle:"body2",children:"Clear All"})})]}),Object.values(Je).map(i=>e.jsx(ee,{onClick:x=>{x.preventDefault(),t(i)},children:e.jsx(ne,{icon:e.jsx(me,{w:"12px"}),isChecked:n==null?void 0:n.includes(i),children:i})},i))]})]})},An=()=>{var a;const{isOpen:n,onClose:t,onOpen:o}=D(),r=en(),s=nn((a=r.app)==null?void 0:a.id);return e.jsxs(tn,{display:"flex",flexDirection:"column",children:[e.jsxs(u,{align:"center",justify:"space-between",mb:"5",children:[e.jsxs(L,{children:[e.jsxs(u,{align:"center",gap:"2",mb:"1",children:[e.jsx(_,{children:"Manage"}),e.jsx(wn,{onRefresh:s.refetch})]}),e.jsx(on,{invoicesApp:r})]}),e.jsx(g,{h:"44px",ml:"auto",onClick:o,variant:"primary",children:"New Invoice"})]}),e.jsxs(u,{align:"center",gap:"4",mb:"6",children:[e.jsx(kn,{w:"264px",onSearch:s.setFilterById}),e.jsx(Sn,{selectedStatuses:s.filter.status,onToggle:s.toggleFilterByStatus,onClear:s.clearFilterByStatus}),e.jsx(sn,{period:s.filter.period,onSetPeriod:s.setFilterByPeriod,onClear:s.clearFilterByPeriod}),e.jsx(Fn,{selectedCurrencies:s.filter.currency,onToggle:s.toggleFilterByCurrency,onClear:s.clearFilterByCurrency}),e.jsx(Tn,{isActive:s.filter.overpayment,onToggle:s.toggleFilterByOverpayment})]}),e.jsx(vn,{flex:"1 1 auto",invoices:s.invoices,isLoading:s.isLoading,isEmpty:!s.invoices.length,currentSortColumn:s.sort.column,sortDirection:s.sort.direction,onSetSortColumn:s.setSortColumn,onToggleSortDirection:s.toggleSortDirection,onCancel:async c=>{await new Promise(i=>{s.cancelInvoice(c),i()})},isCancelLoading:s.isCancelingInvoice}),e.jsx(mn,{isOpen:n,onClose:t,onCreateInvoice:async c=>(await Promise.resolve(s.createInvoice(c)),t(),{id:"",amount:c.amount,currency:c.currency,validUntil:new Date(Date.now()+c.lifeTimeSeconds*1e3),description:c.description,creationDate:new Date,payTo:r.app.receiverAddress,paymentLink:"",status:"pending"}),isLoading:s.isCreatingInvoice})]})};export{An as default};
