var d=Object.defineProperty;var u=(t,e,r)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var o=(t,e,r)=>u(t,typeof e!="symbol"?e+"":e,r);import{dq as y,dy as p,dz as i,bC as h,U as n}from"./index--6gyeIm1.js";import{c as l}from"./useLocalObservable-BPr5Op9k.js";import{L as m}from"./serialize-a49E7W4J.js";class f{constructor(e){o(this,"query$",new m(null));o(this,"disposers",[]);o(this,"createQuery",this.query$.createAsyncAction(async e=>{const{data:r,error:s}=await p({query:{project_id:this.project.id,addresses:e.addresses.join(","),only_between:e.isBetweenSelectedOnly}});return{data:s?void 0:c(r),error:s||void 0}},{onError:()=>{this.query$.clear()},errorToast:e=>({title:"Error",description:e.response.data.error})}));o(this,"refetchQuery",this.query$.createAsyncAction(async()=>{const{data:e,error:r}=await i({path:{id:this.query$.value.id}});if(r)throw r;return c(e)}));o(this,"loadQuery",this.query$.createAsyncAction(async e=>{const{data:r,error:s}=await i({path:{id:e}});if(s)throw s;return this.refetchQuery.cancelAllPendingCalls(),c(r)}));this.project=e,y(this);const r=l(()=>e,(s,a)=>{a&&this.clear()});this.disposers.push(r)}destroy(){this.disposers.forEach(e=>e==null?void 0:e()),this.disposers=[]}clear(){this.query$.clear()}}function c(t){var r,s;const e={id:t.id,type:"graph",addresses:((s=(r=t.query)==null?void 0:r.addresses)==null?void 0:s.map(a=>h.Address.parse(a)))??[],creationDate:new Date(t.date_create),isBetweenSelectedOnly:t.query.only_between};return t.status==="success"?{...e,status:"success",resultUrl:`https://cosmograph.app/run/?nodeColor=color-node_color&nodeSize=size-node_value&data=${encodeURIComponent(t.url)}&meta=${encodeURIComponent(t.meta_url)}`,spentTimeMS:t.spent_time,cost:t.usd_cost?new n(t.usd_cost):new n(0)}:t.status==="executing"?{...e,status:"executing"}:{...e,status:"error",errorReason:t.error,spentTimeMS:t.spent_time,cost:t.usd_cost?new n(t.usd_cost):void 0}}export{f as A,c as m};
