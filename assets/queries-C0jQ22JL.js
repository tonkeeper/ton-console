import{W as c,an as b,Z as d,ao as p,dp as u,c1 as y}from"./index-BCN26Ft_.js";const i={all:["webhooks"],list:(t,n)=>["webhooks",t,n],stats:t=>["webhooks","stats",t],subscriptions:(t,n,s)=>["webhooks","subscriptions",t,n,s]};function w(t){const n=c();return b({queryKey:i.list(n||void 0,t),queryFn:async()=>n?(await u.webhooks.getWebhooks({project_id:n.toString(),network:t})).data.webhooks.toSorted((e,o)=>o.id-e.id):[],enabled:!!n,staleTime:5*60*1e3,retry:(s,e)=>e&&typeof e=="object"&&"status"in e&&e.status===501?!1:s<1})}function f(){const t=c();return b({queryKey:i.stats(t||void 0),queryFn:async()=>{if(!t)return null;const n=new Date,s=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),1)),e=Math.floor(s.getTime()/1e3),o=Math.floor(n.getTime()/1e3),a=(o-e)/(60*60)>500?o-500*(60*60):e,{data:l,error:j}=await y({query:{project_id:t,start:a,end:o,step:60*60,dashboard:"tonapi_webhook"}});if(j)throw j;return l.stats},enabled:!!t,staleTime:5*60*1e3})}function S(t,n,s=20){const e=c();return b({queryKey:i.subscriptions(e||void 0,t||0,n),queryFn:async()=>{if(!t||!e)return[];const o=(n-1)*s;return(await u.webhooks.webhookAccountTxSubscriptions(t,{project_id:e.toString(),network:"mainnet",limit:s,offset:o})).data.account_tx_subscriptions},enabled:!!t&&!!e,staleTime:1*60*1e3})}function k(t){const n=d(),s=c();return p({mutationFn:async({endpoint:e})=>{const o=s;if(!o)throw new Error("Project not selected");return{...(await u.webhooks.createWebhook({project_id:o.toString(),network:t},{endpoint:e})).data,_projectId:o}},onSuccess:e=>{const o=e._projectId;o&&n.invalidateQueries({queryKey:i.list(o,t)})}})}function m(t){const n=d(),s=c();return p({mutationFn:async e=>{const o=s;if(!o)throw new Error("Project not selected");return await u.webhooks.deleteWebhook(e,{project_id:o.toString(),network:t}),{webhookId:e,projectId:o}},onSuccess:e=>{n.invalidateQueries({queryKey:i.list(e.projectId,t)})}})}function I(t,n){const s=d(),e=c();return p({mutationFn:async o=>{const r=e;if(!r)throw new Error("Project not selected");return await u.webhooks.webhookAccountTxSubscribe(t,{project_id:r.toString(),network:n},{accounts:o.map(a=>({account_id:a.toRawString()}))}),{webhookId:t,projectId:r}},onSuccess:o=>{s.invalidateQueries({queryKey:i.subscriptions(o.projectId,o.webhookId,1)})}})}function q(t,n){const s=d(),e=c();return p({mutationFn:async o=>{const r=e;if(!r)throw new Error("Project not selected");return await u.webhooks.webhookAccountTxUnsubscribe(t,{project_id:r.toString(),network:n},{accounts:o.map(a=>a.toRawString())}),{webhookId:t,projectId:r}},onSuccess:o=>{s.invalidateQueries({queryKey:i.subscriptions(o.projectId,o.webhookId,1)})}})}function T(t){const n=d(),s=c();return p({mutationFn:async e=>{const o=s;if(!o)throw new Error("Project not selected");return await u.webhooks.webhookBackOnline(e,{project_id:o.toString(),network:t}),{webhookId:e,projectId:o}},onSuccess:e=>{n.invalidateQueries({queryKey:i.list(e.projectId,t)})}})}export{m as a,w as b,f as c,I as d,q as e,S as f,T as g,k as u};
