import{bi as X,W as T,an as O,bs as J,bt as A,bu as ee,bv as te,b2 as re,r as a,j as e,b8 as ne,b9 as k,bb as oe,o as se,bo as ae,bw as le,C as ie,T as f,B as u,X as ce,aY as de,aM as ue,ae as me,ax as Ce,az as xe,Z as pe,ao as he,bx as fe,by as ge,aZ as ye,av as be,aX as je,bz as Se,aK as we,aC as Te,aD as De,k as Re,aE as Ee,aF as Pe,bA as Ie,aG as Me,F as Ae,b,aj as Ue}from"./index-BCN26Ft_.js";import{V as U}from"./v-stack-DE1rRJbv.js";function Oe(r,t){const n="https://app.tonkeeper.com/transfer",o=new URL(r?`${n}/${r}`:n);if(t!=null&&t.jetton&&o.searchParams.append("jetton",t.jetton),t!=null&&t.amount){let s;typeof t.amount=="object"&&"amount"in t.amount?s=t.amount.weiAmount.toFixed(0):s=new X(t.amount).toFixed(0),o.searchParams.append("amount",s)}return t!=null&&t.text&&o.searchParams.append("text",encodeURIComponent(t.text)),t!=null&&t.exp&&o.searchParams.append("exp",t.exp instanceof Date?Math.floor(t.exp.getTime()/1e3).toString():t.exp.toString()),o.toString()}const ke="billing-history",ve=20;function _e(r={}){const{before_tx:t,limit:n=ve}=r,o=T();return O({queryKey:[ke,o,t,n],queryFn:async()=>{if(!o)throw new Error("No project selected");const{data:s,error:m}=await J({path:{id:o},query:{before_tx:t,limit:n}});if(m)throw m;return s.history.map(Be)},enabled:!!o,staleTime:30*1e3})}function Be(r){const t=new Date(r.created_at*1e3),n=Fe(r.currency,r.amount);return{id:r.id,date:t,amount:n,description:r.description,type:r.type,info:r.info}}function Fe(r,t){switch(r){case A.TON:return new re(t);case A.USDT:return new ee({weiAmount:t,currency:te.USDT,decimals:6});default:throw new Error(`Unknown currency: ${r}`)}}const Ne=6,Le=({amount:r,setAmount:t,paymentLink:n,isDepositAddressLoading:o,depositAddressError:s})=>{const m=a.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{children:[e.jsx(k,{ref:m,mb:"4",pr:"60px",fontSize:"lg",fontWeight:"medium",bg:"white",autoFocus:!0,onChange:c=>{var g;const C=c.target.value.replace(/[^\d.]/g,""),p=(g=C.split(".")[1])==null?void 0:g.length;p&&p>Ne||t(C)},placeholder:"Enter amount",value:r}),e.jsx(oe,{textStyle:"body2",w:"60px",color:"text.secondary",children:e.jsx(se,{children:"USDT"})})]}),e.jsxs(ae,{mb:"4",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",children:[n&&!o&&!s?e.jsx(le,{bgColor:"transparent",size:200,value:n}):!o&&s?e.jsx(ie,{h:"200px",children:e.jsx(f,{textStyle:"body2",color:"text.secondary",children:"Error fetching deposit address"})}):e.jsxs("svg",{width:"200",height:"200",viewBox:"0 0 128 128",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M23 75.5C25.2091 75.5 27 77.2909 27 79.5V81.7998C27 88.5204 26.9997 91.8813 28.3076 94.4482C29.4581 96.706 31.294 98.5419 33.5518 99.6924C36.1187 101 39.4796 101 46.2002 101H48.5C50.7091 101 52.5 102.791 52.5 105C52.5 107.209 50.7091 109 48.5 109C48.4493 109 48.3989 108.998 48.3486 108.996C38.887 108.983 33.8464 108.821 29.9199 106.82C26.1568 104.903 23.0971 101.843 21.1797 98.0801C19.179 94.1534 19.0164 89.1126 19.0029 79.6504C19.0011 79.6005 19 79.5504 19 79.5C19 77.2909 20.7909 75.5 23 75.5ZM105 75.5C107.209 75.5 109 77.2909 109 79.5C109 79.5504 108.998 79.6005 108.996 79.6504C108.983 89.1126 108.821 94.1534 106.82 98.0801C104.903 101.843 101.843 104.903 98.0801 106.82C94.1534 108.821 89.1126 108.983 79.6504 108.996C79.6005 108.998 79.5504 109 79.5 109C77.2909 109 75.5 107.209 75.5 105C75.5 102.791 77.2909 101 79.5 101H81.7998C88.5204 101 91.8813 101 94.4482 99.6924C96.706 98.5419 98.5419 96.706 99.6924 94.4482C101 91.8813 101 88.5204 101 81.7998V79.5C101 77.2909 102.791 75.5 105 75.5ZM48.5 19C50.7091 19 52.5 20.7909 52.5 23C52.5 25.2091 50.7091 27 48.5 27H46.2002C39.4796 27 36.1187 26.9997 33.5518 28.3076C31.294 29.4581 29.4581 31.294 28.3076 33.5518C26.9997 36.1187 27 39.4796 27 46.2002V48.5L26.9951 48.7061C26.8879 50.8194 25.14 52.5 23 52.5C20.7909 52.5 19 50.7091 19 48.5C19 48.4493 19.0011 48.3989 19.0029 48.3486C19.0164 38.887 19.1791 33.8464 21.1797 29.9199C23.0971 26.1568 26.1568 23.0971 29.9199 21.1797C33.8533 19.1755 38.9047 19.0149 48.3984 19.002C48.4322 19.0011 48.466 19 48.5 19ZM79.6006 19.002C89.095 19.0149 94.1465 19.1755 98.0801 21.1797C101.843 23.0971 104.903 26.1568 106.82 29.9199C108.821 33.8464 108.983 38.887 108.996 48.3486C108.998 48.3989 109 48.4493 109 48.5C109 50.7091 107.209 52.5 105 52.5C102.86 52.5 101.112 50.8194 101.005 48.7061L101 48.5V46.2002C101 39.4796 101 36.1187 99.6924 33.5518C98.5419 31.2939 96.706 29.4581 94.4482 28.3076C91.8813 26.9997 88.5204 27 81.7998 27H79.5C77.2909 27 75.5 25.2091 75.5 23C75.5 20.7909 77.2909 19 79.5 19C79.5336 19 79.5672 19.0011 79.6006 19.002Z",fill:"#A0A6AD"}),e.jsx("rect",{opacity:"0.32",x:"40",y:"40",width:"48",height:"48",rx:"8",fill:"#A0A6AD"})]}),e.jsx(f,{textStyle:"body2",mt:"4",color:"text.secondary",textAlign:"center",children:n?"Scan QR code for refill":"QR code for refill will appear here"})]})]})},He=({tonDepositWallet:r})=>e.jsxs(U,{spacing:"4",children:[e.jsx(u,{w:"full",p:"4",bg:"orange.50",borderRadius:"md",children:e.jsxs(ce,{align:"flex-start",spacing:"2",children:[e.jsx(u,{flexShrink:0,mt:"1",color:"accent.orange",children:e.jsx(de,{})}),e.jsxs(U,{align:"flex-start",spacing:"1",children:[e.jsx(f,{textStyle:"label1",color:"orange.900",children:"TON Balance is Deprecated"}),e.jsx(f,{textStyle:"body2",color:"orange.800",children:"This method is no longer recommended. Please use USDT refills instead."})]})]})}),r&&e.jsxs(u,{w:"full",children:[e.jsx(f,{textStyle:"body2",color:"text.secondary",children:"Deposit address for TON (legacy):"}),e.jsx(ue,{text:r})]})]}),Qe=({formId:r,register:t,errors:n,isPromoLoading:o})=>e.jsx(me.form,{id:r,noValidate:!0,children:e.jsxs(Ce,{mb:"2",isInvalid:!!n.promoCode,children:[e.jsx(k,{isDisabled:o,placeholder:"Promo Code",...t}),e.jsx(xe,{children:n.promoCode&&n.promoCode.message})]})}),Ye="deposit-address",qe="balance";function Ve(){const r=T();return O({queryKey:[Ye,r],queryFn:async()=>{if(!r)throw new Error("No project selected");const{data:t,error:n}=await ge({path:{id:r}});if(n)throw n;return t},enabled:!!r,staleTime:10*60*1e3})}function We(){const r=pe(),t=T();return he({mutationFn:async n=>{if(!t)throw new Error("No project selected");const{error:o}=await fe({path:{id:t,promo_code:n}});if(o)throw o},onSuccess:()=>{r.invalidateQueries({queryKey:[qe,t]})}})}const Ze=6,Ke={USDT:Ze},w=r=>{const{getInputProps:t,getRadioProps:n}=Ue(r),o=t(),s=n();return e.jsxs(u,{as:"label",flex:1,children:[e.jsx("input",{...o}),e.jsx(u,{...s,textStyle:"body2",alignContent:"center",flex:1,h:"44px",px:"4",py:"2",fontWeight:"medium",textAlign:"center",bg:"transparent",borderRadius:"md",_checked:{bg:"background.contentTint"},cursor:"pointer",transition:"all 0.2s",children:r.children})]})},ze=({onClose:r})=>{const{data:t,isLoading:n,error:o}=Ve(),{mutate:s,isPending:m}=We(),{data:c=[]}=_e(),C=t==null?void 0:t.usdt_deposit_wallet,p=t==null?void 0:t.ton_deposit_wallet,g={USDT:C},[d,v]=a.useState("USDT"),[h,D]=a.useState(""),[R,_]=a.useState(new Set),[y,B]=a.useState(null),E=ye(),{handleSubmit:F,register:N,formState:{errors:L},setError:H,reset:Q,setFocus:Y,watch:q}=be(),P=q("promoCode"),V=!P||P.trim()==="",I=a.useId(),{getRootProps:W,getRadioProps:j}=je({name:"refillMode",defaultValue:d,onChange:i=>{v(i),D(""),Q()}}),x=a.useMemo(()=>{if(d!=="USDT"||!C||h===""||Number(h)===0)return null;const i=g.USDT;if(!i)return null;const l=Ke.USDT,S={amount:Se(h,l).toString()},z="kQDBHOOgIgayHS0M1OWu3EgxtArqBKevZ_3Spnb8kfFJWYLZ";return S.jetton=z,S.text="TON Console: Refill",Oe(i,S)},[d,h,C]),{onCopy:Z}=we(x??""),K=()=>{x&&window.open(x,"_blank")},G=i=>{s(i.promoCode,{onSuccess:()=>{r()},onError:()=>{H("promoCode",{message:"Invalid promo code"}),setTimeout(()=>Y("promoCode"))}})},$=!!p;return a.useEffect(()=>{y===null&&c.length>0&&B(c[0].id)},[]),a.useEffect(()=>{if(y===null||c.length===0)return;const i=c.findIndex(l=>l.id===y);i!==-1&&c.slice(0,i).filter(l=>l.type==="deposit"&&!R.has(l.id)).forEach(l=>{E({title:"Refill detected",description:`${l.amount.stringCurrencyAmount} received at ${l.date.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}`,status:"success",position:"bottom-left",isClosable:!0,duration:5e3}),_(M=>new Set([...M,l.id]))})},[c,y,R,E]),e.jsxs(Te,{maxW:"400px",children:[e.jsx(De,{children:e.jsx(Re,{mb:"1",children:"Balance Refill"})}),e.jsx(Ee,{}),e.jsx(Pe,{pt:"0",pb:"0",children:o?e.jsxs(u,{color:"accent.orange",children:[e.jsx(u,{children:"Balance refill is not available right now."}),e.jsx(u,{children:"Please try again later."})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{...W(),flexWrap:"wrap",direction:"row",gap:"2",mb:"4",p:"2",border:"1px",borderColor:"separator.common",borderRadius:"lg",children:[a.createElement(w,{value:"USDT",...j({value:"USDT"}),key:"USDT"},"USDT"),$&&a.createElement(w,{value:"TON",...j({value:"TON"}),key:"TON"},"TON"),a.createElement(w,{value:"PROMO",...j({value:"PROMO"}),key:"PROMO"},"Promo")]}),d==="USDT"&&e.jsx(Le,{amount:h,setAmount:D,paymentLink:x,isDepositAddressLoading:n,depositAddressError:!!o}),d==="TON"&&e.jsx(He,{tonDepositWallet:p}),d==="PROMO"&&e.jsx(Qe,{formId:I,register:N("promoCode",{required:"This is required",maxLength:{value:30,message:"Max length is 30"}}),errors:L,isPromoLoading:m})]})}),e.jsxs(Me,{flexDir:"column",gap:"2",mt:"2",pt:"0",children:[d==="USDT"&&e.jsxs(Ae,{gap:"2",w:"full",children:[e.jsx(b,{flex:1,isDisabled:!x||n,onClick:Z,variant:"secondary",children:"Copy refill link"}),e.jsx(b,{flex:1,isDisabled:!x||n,onClick:K,children:"Refill by link"})]}),d==="PROMO"&&e.jsx(b,{w:"full",form:I,isDisabled:V,isLoading:m,onClick:F(G),type:"submit",variant:"primary",children:"Apply Promo Code"}),e.jsx(b,{w:"full",onClick:r,variant:"secondary",children:"Close"})]})]})};export{ze as R,_e as u};
