var m=Object.defineProperty;var T=(e,t,i)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var s=(e,t,i)=>T(e,typeof t!="symbol"?t+"":t,i);import{cz as x,cA as q,cB as A,cC as l,cD as n,b2 as j,cc as Q,c8 as R,r as c,j as a,O as b,F as p,k as S,b as u,bm as h,cE as P,cF as _,cG as F}from"./index-BCN26Ft_.js";import{m as f}from"./analytics-query.store-BitVLp-P.js";import{m as v}from"./analytics-graph-query.store-aBxkGm8c.js";import{u as D}from"./create-reaction-CzXnGxB7.js";class O{constructor(t){s(this,"queries$",new A([]));s(this,"pagination",{filter:{onlyRepeating:!1}});s(this,"totalQueries",0);s(this,"pageSize",30);s(this,"disposers",[]);s(this,"isItemLoaded",t=>!this.hasNextPage||t<this.queries$.value.length);s(this,"loadFirstPage",this.queries$.createAsyncAction(async()=>{this.loadNextPage.cancelAllPendingCalls(),this.totalQueries=0;const{data:t,error:i}=await l({query:{project_id:this.project.id,limit:this.pageSize,offset:this.queries$.value.length,...this.pagination.filter.onlyRepeating&&{is_repetitive:!0},type:g(this.pagination.filter.type)}});if(i)throw i;const r=t.items.map(y);return this.totalQueries=t.count,r},{resetBeforeExecution:!0}));s(this,"loadNextPage",this.queries$.createAsyncAction(async()=>{const{data:t,error:i}=await l({query:{project_id:this.project.id,limit:this.pageSize,offset:this.queries$.value.length,...this.pagination.filter.onlyRepeating&&{is_repetitive:!0},type:g(this.pagination.filter.type)}});if(i)throw i;const r=t.items.map(y);return this.totalQueries=t.count,this.queries$.value.concat(r)}));s(this,"toggleFilterByType",t=>{var r,o;((r=this.pagination.filter.type)==null?void 0:r.includes(t))?this.pagination.filter.type=(o=this.pagination.filter.type)==null?void 0:o.filter(d=>d!==t):this.pagination.filter.type=(this.pagination.filter.type||[]).concat(t)});s(this,"toggleFilterByRepeating",()=>{this.pagination.filter.onlyRepeating=!this.pagination.filter.onlyRepeating});s(this,"clearFilterByType",()=>{this.pagination.filter.type=void 0});this.project=t,x(this),this.loadFirstPage();const i=q(()=>JSON.stringify(this.pagination),()=>{this.loadFirstPage({cancelPreviousCall:!0})});this.disposers.push(i)}get hasNextPage(){return this.queries$.value.length<this.totalQueries}get tableContentLength(){return this.hasNextPage?this.queries$.value.length+1:this.queries$.value.length}destroy(){this.disposers.forEach(t=>t==null?void 0:t()),this.disposers=[]}clearState(){this.queries$.clear()}}function y(e){var t;return e.type==="graph"?v(e):e.total_repetitions&&e.total_repetitions>1||(t=e.query)!=null&&t.repeat_interval?w(e):f(e)}function w(e){return{lastQuery:f(e),lastQueryDate:new Date(e.last_repeat_date),repeatFrequencyMs:e.query.repeat_interval*1e3,totalCost:new j(e.total_cost),totalRepetitions:e.total_repetitions}}function g(e){const t={sql:n.BASE_QUERY,graph:n.GRAPH,gpt:n.CHAT_GPT_QUERY};return e!=null&&e.length?e.map(i=>t[i]):void 0}const $=()=>{const e=R(),t=D(()=>new O(e));return c.useEffect(()=>{t.loadFirstPage()},[t]),c.useEffect(()=>()=>{t.destroy()},[t]),a.jsxs(b,{display:"flex",flexDirection:"column",children:[a.jsxs(p,{align:"flex-start",justify:"space-between",gap:"3",mb:"5",children:[a.jsx(S,{children:"History"}),a.jsx(u,{as:h,ml:"auto",to:"../query",variant:"secondary",children:"New Query"}),a.jsx(u,{as:h,to:"../graph",variant:"secondary",children:"New Graph"})]}),a.jsxs(p,{align:"center",gap:"4",mb:"6",children:[a.jsx(P,{analyticsHistoryTableStore:t}),a.jsx(_,{analyticsHistoryTableStore:t})]}),a.jsx(F,{flex:"1",analyticsHistoryTableStore:t})]})},G=Q($);export{G as default};
